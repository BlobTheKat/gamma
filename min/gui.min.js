Gamma.gui=e=>{if(!e.Font)throw"Initialize Gamma.font before Gamma.gui";class s{}const i=function(t,e,s){for(let i=0;i<this.children.length;i+=2){const h=this.children[i],n=this.children[i+1],r=t.sub();3&n&&(2&n?r.translate(e-h.width,0):1&n&&r.translate(.5*(e-h.width),0)),12&n&&(8&n?r.translate(0,s-h.height):4&n&&r.translate(0,.5*(s-h.height))),h.draw?.(r)}};class h extends s{children=[];add(t,e=15){return this.children.push(t,e),this}constructor(t){super(),this.draw=t}}class n extends s{constructor(t){super(),this.texture=t}get naturalWidth(){return this.texture.width}get naturalHeight(){return this.texture.height}draw=(t,e,s)=>{t.draw(this.texture)}}class r extends s{constructor(t){super(),this.text=t}draw=(t,e,s)=>{}}e.GUI={CENTERED:15,CENTERED_X:3,CENTERED_Y:12,LEFT:1,RIGHT:2,BOTTOM:4,TOP:8,ZStack:()=>new h(i),Img:(t,e,s)=>new n(t,e,s),Text:t=>new r(t),Button:(t=null)=>new l(t)};class l{hoverOverCb=null;hoverOutCb=null;constructor(t=null){this.cb=t}onClick(t=null){return this.cb=t,this}onHover(t=null){return this.hoverOverCb=t,this}onHoverRelease(t=null){return this.hoverOutCb=t,this}}const c=({target:t})=>(256&t._field._f||(t._field._f|=256,setImmediate(t._field.recalc)),t.remove(),f=null),o=t=>{const e=t.target._field;if(38==t.keyCode||40==t.keyCode){if(e._f>>1&1^t.shiftKey)38==t.keyCode?e.upArrowCb?.():e.downArrowCb?.();else if(2048&e._f)if(e.sel0==e.sel1){let s=e.sel0,i=s,h=e.sel0pos,n=h;for(;n;)s-=e.lines[--n].length;const r=e.lines[h].slice(0,s).width;if(38==t.keyCode&&h){const t=e.lines[h-1];e.sel0=e.sel1=i-s-t.length+t.indexAt(r)}else 40==t.keyCode&&h<e.lines.length-1&&(e.sel0=e.sel1=i-s+e.lines[h].length+e.lines[h+1].indexAt(r))}else 38==t.keyCode?e.sel0=e.sel1:e.sel1=e.sel0}else if(13==t.keyCode){if(!(e._f>>2&1^t.shiftKey))return;e.enterCb?.()}else{if(9!=t.keyCode)return;e._f>>3&1^t.shiftKey?e.tabCb?.():1&e._f&&e.insert("\t")}t.preventDefault()},a=(t,e)=>{const s=document.createElement(t);return s.style="width:1px;height:1px;border:0;padding:0;opacity:0;position:absolute;inset:-9px;font-size:1px;font-family:monospace;white-space:nowrap",s.onblur=c,s.onkeydown=o,s.tabIndex=-1,s._field=e,document.documentElement.append(s),s},d=e.vec4;let f=null,u=0;const m=(t,e)=>t.insertLinePass(-1,[e.focus?d(0,.2,.4,.6):d(.2,.2,.2,.6)],0,1),g=(t,s)=>{t.shader=null,(e.t-u)%1<.5&&t.drawRect(0,s.ascend-1,.05,1,d.one)};class w{_f=0;#t=0;#e=0;get allowTabs(){return!!(1&this._f)}set allowTabs(t){this._f=-2&this._f|1&t}get shiftArrows(){return!!(2&this._f)}set shiftArrows(t){this._f=-3&this._f|2&-t}get shiftEnter(){return!!(4&this._f)}set shiftEnter(t){this._f=-5&this._f|4&-t}get shiftTab(){return!!(8&this._f)}set shiftTab(t){this._f=-9&this._f|8&-t}upArrowCb=null;downArrowCb=null;enterCb=null;tabCb=null;scrollable=null;#s;constructor(t){this.#s=a(t?"textarea":"input",this),this._f=t}get value(){return this.#s.value}set value(t){this.#s.value=t,256&this._f||(this._f|=256,setImmediate(this.recalc))}get sel0(){return this.#t}set sel0(t){t>>>=0,this.#e>=this.#t?t<=this.#e?this.#s.selectionStart=t:(this.#s.selectionStart=this.#e,this.#s.selectionEnd=t,this.#s.selectionDirection="backward"):t>this.#e?this.#s.selectionEnd=t:(this.#s.selectionStart=t,this.#s.selectionEnd=this.#e,this.#s.selectionDirection="forward"),this.#t=t}get sel1(){return this.#e}set sel1(t){t>>>=0,this.#e>=this.#t?t>=this.#t?this.#s.selectionEnd=t:(this.#s.selectionStart=t,this.#s.selectionEnd=this.#t,this.#s.selectionDirection="backward"):t<this.#t?this.#s.selectionStart=t:(this.#s.selectionStart=this.#t,this.#s.selectionEnd=t,this.#s.selectionDirection="forward"),this.#e=t}select(t,e=t){(t>>>=0)<=(e>>>=0)?(this.#s.selectionStart=t,this.#s.selectionEnd=e,this.#t>this.#e&&(this.#s.selectionDirection="forward")):(this.#s.selectionStart=e,this.#s.selectionEnd=t,this.#t<=this.#e&&(this.#s.selectionDirection="backward")),this.#t=t,this.#e=e,256&this._f||(this._f|=256,setImmediate(this.recalc))}get selStart(){return min(this.#t,this.#e)}get selEnd(){return max(this.#t,this.#e)}get isSelecting(){return!!(512&this._f)}#i=null;get transformer(){return this.#i}set transformer(t){this.#i!=(this.#i=t)&&!(256&this._f)&&(this._f|=256,setImmediate(this.recalc))}simpleTransformer(t,s="",...i){let h=i.slice();h[0]=i[0]?d.multiply(i[0],.4):d(.4),this.#i=n=>{const r=e.RichText(t);return i.length&&r.addTextPass(0,i),n?r.add(n):(r.addTextPass(0,h),r.index=!1,r.add(s)),r},256&this._f||(this._f|=256,setImmediate(this.recalc))}#h=g;#n=m;#r=null;#l=null;#c=1/0;#o=0;#a=0;#d=0;get sel0pos(){return this.#o}get sel1pos(){return this.#a}get multiline(){return!!(2048&this._f)}set multiline(t=!0){const e=this.#s,s=e.value,i=document.activeElement==e;if(t){if(2048&this._f)return;this.#r=null,this._f|=2304,this.#s=a("textarea",this)}else{if(!(2048&this._f))return;this.#l=null,this._f=-2049&this._f|256,this.#s=a("input",this)}i?this.focus=!0:(e.remove(),f==e&&(f=null),256&this._f||(this._f|=256,setImmediate(this.recalc))),this.#s.value=s,this.#s.selectionStart=this.#t,this.#s.selectionEnd=this.#e,this.#s.selectionDirection=this.#t>this.#e?"backward":"forward"}get width(){return this.#d}get line(){return this.#r}get lines(){return this.#l}get cursor(){return this.#h}set cursor(t){this.#h!=(this.#h=t)&&!(256&this._f)&&(this._f|=256,setImmediate(this.recalc))}get selector(){return this.#n}set selector(t){this.#n!=(this.#n=t)&&!(256&this._f)&&(this._f|=256,setImmediate(this.recalc))}get maxWidth(){return this.#c}set maxWidth(t){this.#c=t,256&this._f||(this._f|=256,setImmediate(this.recalc))}recalc=()=>{const t=this._f;if(!(256&t))return;const s=this.#s,i=min(this.#t,this.#e),h=max(this.#t,this.#e);this._f=-257&t,u=e.t;const n=s.value,r=this.#i?.(n,this)??e.RichText();if(i==h){const e=r.slice(i);r.trim(i),2048&t||(this.#o=this.#a=r.width),this.#h&&document.activeElement==this.#s&&r.addCb(this.#h),r.concat(e)}else{const e=r.slice(i),s=e.slice(h-i);e.trim(h-i),r.trim(i),2048&t?(this.#n?.(e,this),r.concat(e)):(this.#o=r.width,this.#n?.(e,this),r.concat(e),this.#a=r.width),r.concat(s)}if(2048&t){const t=this.#l=r.break(this.#c);let e=0;for(const{width:s}of t)s>e&&(e=s);this.#d=e;let s=i,n=0;for(;n<t.length&&s>=0;)s-=t[n++].length;for(s=h-i+s+(n?t[--n].length:0),this.#o=n;n<t.length&&s>=0;)s-=t[n++].length;this.#a=n?n-1:0}else this.#r=r,this.#d=r.width};insert(t="",e=t.length){const s=this.#s,i=s.selectionStart;s.setRangeText(t,i,s.selectionEnd,"start"),s.selectionStart=s.selectionEnd=this.#t=this.#e=i+e}get focus(){return document.activeElement==this.#s}set focus(t=!0){if(t){if(f){if(f==this.#s)return;f.replaceWith(f=this.#s)}else document.documentElement.append(f=this.#s);f.focus(),u=e.t}else f==this.#s&&(f.remove(),f=null)}lineHeight=1.3;lineAscend=.9;#f=0;get height(){return this.lineHeight*(this.#l?this.#l.length:1)}consumeInputs(s,{x:i,y:h}=s.unproject(e.cursor),n=e.keys.has(0)){if(h=this.lineAscend-h,cursorType="text",!n)return void(this._f&=-513);document.activeElement!=this.#s&&(this.focus=!0);const r=this._f>>9&1;let l=0;if(this.#r)l=this.#r.indexAt(i);else if(this.#l){let t=floor(h/this.lineHeight);for(t=t<0?0:t>=this.#l.length?this.#l.length-1:t,l=this.#l[t].indexAt(i);t;)l+=this.#l[--t].length}if(r)this.sel1=l;else{let e=0,s=l,i=l;if(this.#f<0?this.#f-(this.#f=-t)<.3?e=2:this.#f=t:this.#f>0?this.#f-(this.#f=t)>-.3&&(e=1,this.#f=-t):this.#f=t,this._f|=512,e){const t=this.#s.value,h=33-e;for(;t.charCodeAt(i++)>h;);for(;t.charCodeAt(--s)>h;);s++,i--}s==this.#t&&i==this.#e||this.select(s,i)}}get height(){return this.#l?this.#l.length*this.lineHeight:this.lineHeight}get xOffset(){return 0}get yOffset(){return-this.lineAscend}draw(t){if(this.#l)for(const e of this.#l)e.draw(t.sub()),t.translate(0,-this.lineHeight);else this.#r?.draw(t)}static#u=(document.addEventListener("input",({target:t})=>{const e=t._field;if(!e)return;const{selectionStart:s,selectionEnd:i,selectionDirection:h}=t;"backward"==h?(e.#t=i,e.#e=s):(e.#t=s,e.#e=i),256&e._f||(e._f|=256,setImmediate(e.recalc))}),document.addEventListener("selectionchange",({target:t})=>{const e=t._field;if(!e)return;const{selectionStart:s,selectionEnd:i,selectionDirection:h}=t;"backward"==h?(e.#t=i,e.#e=s):(e.#t=s,e.#e=i),256&e._f||(e._f|=256,setImmediate(e.recalc))}))}e.TextField=(t=!1)=>new w(t<<11&2048),e.TextField.cursorTimer=()=>e.t-u};