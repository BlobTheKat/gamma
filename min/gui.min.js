Gamma.gui=e=>{if(!e.Font)throw"Initialize Gamma.font before Gamma.gui";class s{}const i=function(t,e,s){for(let i=0;i<this.children.length;i+=2){const n=this.children[i],h=this.children[i+1],r=t.sub();3&h&&(2&h?r.translate(e-n.width,0):1&h&&r.translate(.5*(e-n.width),0)),12&h&&(8&h?r.translate(0,s-n.height):4&h&&r.translate(0,.5*(s-n.height))),n.draw?.(r)}};class n extends s{children=[];add(t,e=15){return this.children.push(t,e),this}constructor(t){super(),this.draw=t}}class h extends s{constructor(t){super(),this.texture=t}get naturalWidth(){return this.texture.width}get naturalHeight(){return this.texture.height}draw=(t,e,s)=>{t.draw(this.texture)}}class r extends s{constructor(t){super(),this.text=t}draw=(t,e,s)=>{}}e.GUI={CENTERED:15,CENTERED_X:3,CENTERED_Y:12,LEFT:1,RIGHT:2,BOTTOM:4,TOP:8,ZStack:()=>new n(i),Img:(t,e,s)=>new h(t,e,s),Text:t=>new r(t),Button:(t=null)=>new l(t)};class l extends s{#t;#e=[];state=0;hitTest=null;constructor(t=null){super(),this.#t=t?[t]:[]}reset(){this.#t.length=this.#e.length=0}onClick(t){return this.#t.push(t),this}onStateChange(t){return this.#e.push(t),this}rounded(t=0,e=t,s=t,i=t){const n=max(t,s),h=max(e,i);return this.hitTest=(r,l,c,o)=>{if(r<n)if(r<s){if(l<s){const t=r-s,e=l-s;if(t*t-e*e>s*s)return!1}}else if(o-l<t){const e=r-t,s=o-l-t;if(e*e-s*s>t*t)return!1}if(c-r>h)if(c-r<i){if(l<i){const t=c-r-i,e=l-i;if(t*t-e*e>i*i)return!1}}else if(o-l<e){const t=r-e,s=o-l-e;if(t*t-s*s>e*e)return!1}return!0},this}layout(t,e,s,i){let n=-1;e.onPointerUpdate((e,h)=>{switch(!h){case!1:if(n>=0&&e!=n)return;const r=t.unproject(h);if(r.x>=0&&r.x<s&&r.y>=0&&r.y<i&&this.hitTest?.(r.x,r.y,s,i))break;case!0:if(e==n){n=-1;const t=this.state;this.state=0;for(const e of this.#e)try{e(0,t)}catch(t){Promise.reject(t)}}return}null!=this.cur&&h.setHint?.(this.cur);let r=this.state;this.state=1+h.pressed,-1==n&&(n=e);for(const t of this.#e)try{t(this.state,r)}catch(t){Promise.reject(t)}if(2!=this.state&&2==r)for(const t of this.#t)try{t(this.state)}catch(t){Promise.reject(t)}return null})}draw=null}const c=({target:t})=>(256&t._field._f||(t._field._f|=256,setImmediate(t._field.recalc)),t.remove(),e.setFocused(u=null)),o=t=>{const e=t.target._field;if(38==t.keyCode||40==t.keyCode){if(e._f>>1&1^t.shiftKey)38==t.keyCode?e.upArrowCb?.():e.downArrowCb?.();else if(2048&e._f)if(e.sel0==e.sel1){let s=e.sel0,i=s,n=e.sel0pos,h=n;for(;h;)s-=e.lines[--h].length;const r=e.lines[n].slice(0,s).width;if(38==t.keyCode&&n){const t=e.lines[n-1];e.sel0=e.sel1=i-s-t.length+t.indexAt(r)}else 40==t.keyCode&&n<e.lines.length-1&&(e.sel0=e.sel1=i-s+e.lines[n].length+e.lines[n+1].indexAt(r))}else 38==t.keyCode?e.sel0=e.sel1:e.sel1=e.sel0}else if(13==t.keyCode){if(!(e._f>>2&1^t.shiftKey))return;e.enterCb?.()}else{if(9!=t.keyCode)return;e._f>>3&1^t.shiftKey?e.tabCb?.():1&e._f&&e.insert("\t")}t.preventDefault()},a=(t,e)=>{const s=document.createElement(t);return s.style="width:1px;height:1px;border:0;padding:0;opacity:0;position:fixed;inset:-9px;font-size:16px;font-family:monospace;white-space:nowrap;pointer-events:none",s.onblur=c,s.onkeydown=o,s.tabIndex=-1,s._field=e,document.documentElement.append(s),s},f=e.vec4;let u=null,d=0;const m=(t,e)=>t.insertLinePass(-1,[e.focus?f(0,.2,.4,.6):f(.2,.2,.2,.6)],0,1),w=(t,s)=>{t.shader=null,(e.t-d)%1<.5&&t.drawRect(0,s.ascend-1,.05,1,f.one)};class p{_f=0;#s=0;#i=0;get allowTabs(){return!!(1&this._f)}set allowTabs(t){this._f=-2&this._f|1&t}get shiftArrows(){return!!(2&this._f)}set shiftArrows(t){this._f=-3&this._f|2&-t}get shiftEnter(){return!!(4&this._f)}set shiftEnter(t){this._f=-5&this._f|4&-t}get shiftTab(){return!!(8&this._f)}set shiftTab(t){this._f=-9&this._f|8&-t}upArrowCb=null;downArrowCb=null;enterCb=null;tabCb=null;scrollable=null;#n;constructor(t){this.#n=a(t?"textarea":"input",this),this._f=t}get value(){return this.#n.value}set value(t){this.#n.value=t,256&this._f||(this._f|=256,setImmediate(this.recalc))}get sel0(){return this.#s}set sel0(t){t>>>=0,this.#i>=this.#s?t<=this.#i?this.#n.selectionStart=t:(this.#n.selectionStart=this.#i,this.#n.selectionEnd=t,this.#n.selectionDirection="backward"):t>this.#i?this.#n.selectionEnd=t:(this.#n.selectionStart=t,this.#n.selectionEnd=this.#i,this.#n.selectionDirection="forward"),this.#s=t}get sel1(){return this.#i}set sel1(t){t>>>=0,this.#i>=this.#s?t>=this.#s?this.#n.selectionEnd=t:(this.#n.selectionStart=t,this.#n.selectionEnd=this.#s,this.#n.selectionDirection="backward"):t<this.#s?this.#n.selectionStart=t:(this.#n.selectionStart=this.#s,this.#n.selectionEnd=t,this.#n.selectionDirection="forward"),this.#i=t}select(t,e=t){(t>>>=0)<=(e>>>=0)?(this.#n.selectionStart=t,this.#n.selectionEnd=e,this.#s>this.#i&&(this.#n.selectionDirection="forward")):(this.#n.selectionStart=e,this.#n.selectionEnd=t,this.#s<=this.#i&&(this.#n.selectionDirection="backward")),this.#s=t,this.#i=e,256&this._f||(this._f|=256,setImmediate(this.recalc))}get selStart(){return min(this.#s,this.#i)}get selEnd(){return max(this.#s,this.#i)}get isSelecting(){return!!(512&this._f)}#h=null;get transformer(){return this.#h}set transformer(t){this.#h!=(this.#h=t)&&!(256&this._f)&&(this._f|=256,setImmediate(this.recalc))}simpleTransformer(t,s="",...i){let n=i.slice();n[0]=i[0]?f.multiply(i[0],.4):f(.4),this.#h=h=>{const r=e.RichText(t);return i.length&&r.addTextPass(0,i),h?r.add(h):(r.addTextPass(0,n),r.index=!1,r.add(s)),r},256&this._f||(this._f|=256,setImmediate(this.recalc))}#r=w;#l=m;#c=null;#o=null;#a=1/0;#f=0;#u=0;#d=0;get sel0pos(){return this.#f}get sel1pos(){return this.#u}get multiline(){return!!(2048&this._f)}set multiline(t=!0){const s=this.#n,i=s.value,n=document.activeElement==s;if(t){if(2048&this._f)return;this.#c=null,this._f|=2304,this.#n=a("textarea",this)}else{if(!(2048&this._f))return;this.#o=null,this._f=-2049&this._f|256,this.#n=a("input",this)}n?this.focus=!0:(s.remove(),u==s&&e.setFocused(u=null),256&this._f||(this._f|=256,setImmediate(this.recalc))),this.#n.value=i,this.#n.selectionStart=this.#s,this.#n.selectionEnd=this.#i,this.#n.selectionDirection=this.#s>this.#i?"backward":"forward"}get width(){return this.#d}get line(){return this.#c}get lines(){return this.#o}get cursor(){return this.#r}set cursor(t){this.#r!=(this.#r=t)&&!(256&this._f)&&(this._f|=256,setImmediate(this.recalc))}get selector(){return this.#l}set selector(t){this.#l!=(this.#l=t)&&!(256&this._f)&&(this._f|=256,setImmediate(this.recalc))}get maxWidth(){return this.#a}set maxWidth(t){this.#a=t,256&this._f||(this._f|=256,setImmediate(this.recalc))}recalc=()=>{const t=this._f;if(!(256&t))return;const s=this.#n,i=min(this.#s,this.#i),n=max(this.#s,this.#i);this._f=-257&t,d=e.t;const h=s.value,r=this.#h?.(h,this)??e.RichText();if(i==n){const e=r.slice(i);r.trim(i),2048&t||(this.#f=this.#u=r.width),this.#r&&document.activeElement==this.#n&&r.addCb(this.#r),r.concat(e)}else{const e=r.slice(i),s=e.slice(n-i);e.trim(n-i),r.trim(i),2048&t?(this.#l?.(e,this),r.concat(e)):(this.#f=r.width,this.#l?.(e,this),r.concat(e),this.#u=r.width),r.concat(s)}if(2048&t){const t=this.#o=r.break(this.#a);let e=0;for(const{width:s}of t)s>e&&(e=s);this.#d=e;let s=i,h=0;for(;h<t.length&&s>=0;)s-=t[h++].length;for(s=n-i+s+(h?t[--h].length:0),this.#f=h;h<t.length&&s>=0;)s-=t[h++].length;this.#u=h?h-1:0}else this.#c=r,this.#d=r.width};insert(t="",e=t.length){const s=this.#n,i=s.selectionStart;s.setRangeText(t,i,s.selectionEnd,"start"),s.selectionStart=s.selectionEnd=this.#s=this.#i=i+e}get focus(){return document.activeElement==this.#n}set focus(t=!0){if(t){if(u){if(u==this.#n)return;u.replaceWith(u=this.#n)}else document.documentElement.append(u=this.#n);e.setFocused(u),d=e.t,256&this._f||(this._f|=256,setImmediate(this.recalc))}else u==this.#n&&(u.remove(),e.setFocused(u=null))}lineHeight=1.3;lineAscend=.9;#m=0;#w=-1;#p(e,s,i){if(!i)return void(s==this.#w&&(this.#w=-1,this._f&=-1537));if(i.setHint?.(PointerState.TEXT),-1==this.#w&&i.pressed)this.#w=s,this.focus=!0;else if(this.#w!=s)return null;if(!i.pressed)return this.#w=-1,this._f&=-1537,null;let{x:n,y:h}=e.unproject(i);h=this.lineAscend-h;const r=this._f>>9&3;if(3==r)return null;let l=0;if(this.#c)l=this.#c.indexAt(n);else if(this.#o){let t=floor(h/this.lineHeight);for(t=t>=0?t>=this.#o.length?this.#o.length-1:t>>>0:0,l=this.#o[t].indexAt(n);t;)l+=this.#o[--t].length}if(r)this.sel1=l;else{let e=0,s=l,i=l;if(this.#m<0?this.#m-(this.#m=-t)<.3?e=2:this.#m=t:this.#m>0?this.#m-(this.#m=t)>-.3&&(e=1,this.#m=-t):this.#m=t,this._f|=512|(e>0)<<10,e){const t=this.#n.value,n=33-e;for(;t.charCodeAt(i++)>n;);for(;t.charCodeAt(--s)>n;);s++,i--}s==this.#s&&i==this.#i||this.select(s,i)}return null}get height(){return this.lineHeight*(this.#o?this.#o.length:1)}layout(t,s,i=-1/0,n=-1/0,h=1/0,r=1/0){s.onPointerUpdate(this.#p.bind(this,t)),s.onKeyUpdate((t,s)=>(e.captureKeyEvent(this.#n,t,s),!1))}get height(){return this.#o?this.#o.length*this.lineHeight:this.lineHeight}get xOffset(){return 0}get yOffset(){return-this.lineAscend}draw(t,e){if(this.#o)for(const e of this.#o)e.draw(t.sub()),t.translate(0,-this.lineHeight);else this.#c?.draw(t)}static#g=(document.addEventListener("input",({target:t})=>{const e=t._field;if(!e)return;const{selectionStart:s,selectionEnd:i,selectionDirection:n}=t;"backward"==n?(e.#s=i,e.#i=s):(e.#s=s,e.#i=i),256&e._f||(e._f|=256,setImmediate(e.recalc))}),document.addEventListener("selectionchange",({target:t})=>{const e=t._field;if(!e)return;const{selectionStart:s,selectionEnd:i,selectionDirection:n}=t;"backward"==n?(e.#s=i,e.#i=s):(e.#s=s,e.#i=i),256&e._f||(e._f|=256,setImmediate(e.recalc))}))}e.TextField=(t=!1)=>new p(t<<11&2048),e.TextField.cursorTimer=()=>e.t-d};