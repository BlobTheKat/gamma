Gamma.gui=e=>{if(!e.Font)throw"Initialize Gamma.font before Gamma.gui";class i{}const s=function(t,e,i){for(let s=0;s<this.children.length;s+=2){const n=this.children[s],h=this.children[s+1],r=t.sub();3&h&&(2&h?r.translate(e-n.width,0):1&h&&r.translate(.5*(e-n.width),0)),12&h&&(8&h?r.translate(0,i-n.height):4&h&&r.translate(0,.5*(i-n.height))),n.draw?.(r)}};class n extends i{children=[];add(t,e=15){return this.children.push(t,e),this}constructor(t){super(),this.draw=t}}class h extends i{constructor(t){super(),this.texture=t}get naturalWidth(){return this.texture.width}get naturalHeight(){return this.texture.height}draw=(t,e,i)=>{t.draw(this.texture)}}class r extends i{constructor(t){super(),this.text=t}draw=(t,e,i)=>{}}e.GUI={CENTERED:15,CENTERED_X:3,CENTERED_Y:12,LEFT:1,RIGHT:2,BOTTOM:4,TOP:8,ZStack:()=>new n(s),Img:(t,e,i)=>new h(t,e,i),Text:t=>new r(t),Button:(t=null)=>new l(t)};class l{hoverOverCb=null;hoverOutCb=null;constructor(t=null){this.cb=t}onClick(t=null){return this.cb=t,this}onHover(t=null){return this.hoverOverCb=t,this}onHoverRelease(t=null){return this.hoverOutCb=t,this}}const o=({target:t})=>(256&t._field._f||(t._field._f|=256,setImmediate(t._field.recalc)),t.remove(),e.setFocused(f=null)),c=t=>{const e=t.target._field;if(38==t.keyCode||40==t.keyCode){if(e._f>>1&1^t.shiftKey)38==t.keyCode?e.upArrowCb?.():e.downArrowCb?.();else if(2048&e._f)if(e.sel0==e.sel1){let i=e.sel0,s=i,n=e.sel0pos,h=n;for(;h;)i-=e.lines[--h].length;const r=e.lines[n].slice(0,i).width;if(38==t.keyCode&&n){const t=e.lines[n-1];e.sel0=e.sel1=s-i-t.length+t.indexAt(r)}else 40==t.keyCode&&n<e.lines.length-1&&(e.sel0=e.sel1=s-i+e.lines[n].length+e.lines[n+1].indexAt(r))}else 38==t.keyCode?e.sel0=e.sel1:e.sel1=e.sel0}else if(13==t.keyCode){if(!(e._f>>2&1^t.shiftKey))return;e.enterCb?.()}else{if(9!=t.keyCode)return;e._f>>3&1^t.shiftKey?e.tabCb?.():1&e._f&&e.insert("\t")}t.preventDefault()},a=(t,e)=>{const i=document.createElement(t);return i.style="width:1px;height:1px;border:0;padding:0;opacity:0;position:fixed;inset:-9px;font-size:16px;font-family:monospace;white-space:nowrap;pointer-events:none",i.onblur=o,i.onkeydown=c,i.tabIndex=-1,i._field=e,document.documentElement.append(i),i},d=e.vec4;let f=null,u=0;const w=(t,e)=>t.insertLinePass(-1,[e.focus?d(0,.2,.4,.6):d(.2,.2,.2,.6)],0,1),m=(t,i)=>{t.shader=null,(e.t-u)%1<.5&&t.drawRect(0,i.ascend-1,.05,1,d.one)};class g{_f=0;#t=0;#e=0;get allowTabs(){return!!(1&this._f)}set allowTabs(t){this._f=-2&this._f|1&t}get shiftArrows(){return!!(2&this._f)}set shiftArrows(t){this._f=-3&this._f|2&-t}get shiftEnter(){return!!(4&this._f)}set shiftEnter(t){this._f=-5&this._f|4&-t}get shiftTab(){return!!(8&this._f)}set shiftTab(t){this._f=-9&this._f|8&-t}upArrowCb=null;downArrowCb=null;enterCb=null;tabCb=null;scrollable=null;#i;constructor(t){this.#i=a(t?"textarea":"input",this),this._f=t}get value(){return this.#i.value}set value(t){this.#i.value=t,256&this._f||(this._f|=256,setImmediate(this.recalc))}get sel0(){return this.#t}set sel0(t){t>>>=0,this.#e>=this.#t?t<=this.#e?this.#i.selectionStart=t:(this.#i.selectionStart=this.#e,this.#i.selectionEnd=t,this.#i.selectionDirection="backward"):t>this.#e?this.#i.selectionEnd=t:(this.#i.selectionStart=t,this.#i.selectionEnd=this.#e,this.#i.selectionDirection="forward"),this.#t=t}get sel1(){return this.#e}set sel1(t){t>>>=0,this.#e>=this.#t?t>=this.#t?this.#i.selectionEnd=t:(this.#i.selectionStart=t,this.#i.selectionEnd=this.#t,this.#i.selectionDirection="backward"):t<this.#t?this.#i.selectionStart=t:(this.#i.selectionStart=this.#t,this.#i.selectionEnd=t,this.#i.selectionDirection="forward"),this.#e=t}select(t,e=t){(t>>>=0)<=(e>>>=0)?(this.#i.selectionStart=t,this.#i.selectionEnd=e,this.#t>this.#e&&(this.#i.selectionDirection="forward")):(this.#i.selectionStart=e,this.#i.selectionEnd=t,this.#t<=this.#e&&(this.#i.selectionDirection="backward")),this.#t=t,this.#e=e,256&this._f||(this._f|=256,setImmediate(this.recalc))}get selStart(){return min(this.#t,this.#e)}get selEnd(){return max(this.#t,this.#e)}get isSelecting(){return!!(512&this._f)}#s=null;get transformer(){return this.#s}set transformer(t){this.#s!=(this.#s=t)&&!(256&this._f)&&(this._f|=256,setImmediate(this.recalc))}simpleTransformer(t,i="",...s){let n=s.slice();n[0]=s[0]?d.multiply(s[0],.4):d(.4),this.#s=h=>{const r=e.RichText(t);return s.length&&r.addTextPass(0,s),h?r.add(h):(r.addTextPass(0,n),r.index=!1,r.add(i)),r},256&this._f||(this._f|=256,setImmediate(this.recalc))}#n=m;#h=w;#r=null;#l=null;#o=1/0;#c=0;#a=0;#d=0;get sel0pos(){return this.#c}get sel1pos(){return this.#a}get multiline(){return!!(2048&this._f)}set multiline(t=!0){const i=this.#i,s=i.value,n=document.activeElement==i;if(t){if(2048&this._f)return;this.#r=null,this._f|=2304,this.#i=a("textarea",this)}else{if(!(2048&this._f))return;this.#l=null,this._f=-2049&this._f|256,this.#i=a("input",this)}n?this.focus=!0:(i.remove(),f==i&&e.setFocused(f=null),256&this._f||(this._f|=256,setImmediate(this.recalc))),this.#i.value=s,this.#i.selectionStart=this.#t,this.#i.selectionEnd=this.#e,this.#i.selectionDirection=this.#t>this.#e?"backward":"forward"}get width(){return this.#d}get line(){return this.#r}get lines(){return this.#l}get cursor(){return this.#n}set cursor(t){this.#n!=(this.#n=t)&&!(256&this._f)&&(this._f|=256,setImmediate(this.recalc))}get selector(){return this.#h}set selector(t){this.#h!=(this.#h=t)&&!(256&this._f)&&(this._f|=256,setImmediate(this.recalc))}get maxWidth(){return this.#o}set maxWidth(t){this.#o=t,256&this._f||(this._f|=256,setImmediate(this.recalc))}recalc=()=>{const t=this._f;if(!(256&t))return;const i=this.#i,s=min(this.#t,this.#e),n=max(this.#t,this.#e);this._f=-257&t,u=e.t;const h=i.value,r=this.#s?.(h,this)??e.RichText();if(s==n){const e=r.slice(s);r.trim(s),2048&t||(this.#c=this.#a=r.width),this.#n&&document.activeElement==this.#i&&r.addCb(this.#n),r.concat(e)}else{const e=r.slice(s),i=e.slice(n-s);e.trim(n-s),r.trim(s),2048&t?(this.#h?.(e,this),r.concat(e)):(this.#c=r.width,this.#h?.(e,this),r.concat(e),this.#a=r.width),r.concat(i)}if(2048&t){const t=this.#l=r.break(this.#o);let e=0;for(const{width:i}of t)i>e&&(e=i);this.#d=e;let i=s,h=0;for(;h<t.length&&i>=0;)i-=t[h++].length;for(i=n-s+i+(h?t[--h].length:0),this.#c=h;h<t.length&&i>=0;)i-=t[h++].length;this.#a=h?h-1:0}else this.#r=r,this.#d=r.width};insert(t="",e=t.length){const i=this.#i,s=i.selectionStart;i.setRangeText(t,s,i.selectionEnd,"start"),i.selectionStart=i.selectionEnd=this.#t=this.#e=s+e}get focus(){return document.activeElement==this.#i}set focus(t=!0){if(t){if(f){if(f==this.#i)return;f.replaceWith(f=this.#i)}else document.documentElement.append(f=this.#i);e.setFocused(f),u=e.t,256&this._f||(this._f|=256,setImmediate(this.recalc))}else f==this.#i&&(f.remove(),e.setFocused(f=null))}lineHeight=1.3;lineAscend=.9;#f=0;#u=-1;#w(e,i,s){if(!s)return void(i==this.#u&&(this.#u=-1,this._f&=-1537));if(s.setHint?.(PointerState.TEXT),-1==this.#u&&s.pressed)this.#u=i,this.focus=!0;else if(this.#u!=i)return null;if(!s.pressed)return this.#u=-1,this._f&=-1537,null;let{x:n,y:h}=e.unproject(s);h=this.lineAscend-h;const r=this._f>>9&3;if(3==r)return null;let l=0;if(this.#r)l=this.#r.indexAt(n);else if(this.#l){let t=floor(h/this.lineHeight);for(t=t>=0?t>=this.#l.length?this.#l.length-1:t>>>0:0,l=this.#l[t].indexAt(n);t;)l+=this.#l[--t].length}if(r)this.sel1=l;else{let e=0,i=l,s=l;if(this.#f<0?this.#f-(this.#f=-t)<.3?e=2:this.#f=t:this.#f>0?this.#f-(this.#f=t)>-.3&&(e=1,this.#f=-t):this.#f=t,this._f|=512|(e>0)<<10,e){const t=this.#i.value,n=33-e;for(;t.charCodeAt(s++)>n;);for(;t.charCodeAt(--i)>n;);i++,s--}i==this.#t&&s==this.#e||this.select(i,s)}return null}get height(){return this.lineHeight*(this.#l?this.#l.length:1)}layout(t,e,i=-1/0,s=-1/0,n=1/0,h=1/0){e.onPointerUpdate(this.#w.bind(this,t))}get height(){return this.#l?this.#l.length*this.lineHeight:this.lineHeight}get xOffset(){return 0}get yOffset(){return-this.lineAscend}draw(t,e){if(this.#l)for(const e of this.#l)e.draw(t.sub()),t.translate(0,-this.lineHeight);else this.#r?.draw(t)}static#m=(document.addEventListener("input",({target:t})=>{const e=t._field;if(!e)return;const{selectionStart:i,selectionEnd:s,selectionDirection:n}=t;"backward"==n?(e.#t=s,e.#e=i):(e.#t=i,e.#e=s),256&e._f||(e._f|=256,setImmediate(e.recalc))}),document.addEventListener("selectionchange",({target:t})=>{const e=t._field;if(!e)return;const{selectionStart:i,selectionEnd:s,selectionDirection:n}=t;"backward"==n?(e.#t=s,e.#e=i):(e.#t=i,e.#e=s),256&e._f||(e._f|=256,setImmediate(e.recalc))}))}e.TextField=(t=!1)=>new g(t<<11&2048),e.TextField.cursorTimer=()=>e.t-u};