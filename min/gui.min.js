Gamma.gui=e=>{if(!e.Font)throw"Initialize Gamma.font before Gamma.gui";class i{#t=NaN;#e=NaN;#i=null;_dimensions(){return vec2.zero}invalidate=()=>{this.#t=this.#e=NaN;const t=this.#i;if(this.#i=null,t)if("function"==typeof t)try{t()}catch(t){Promise.reject(t)}else for(const e of t)try{e()}catch(t){Promise.reject(t)}};addDependency(t){if("function"!=typeof t)return;const e=this.#i;e?"function"==typeof e?this.#i=[e,t]:e.push(t):this.#i=t}removeDependency(t){const e=this.#i;if(!e)return;if("function"==typeof e)return void(e===t&&(this.#i=null));let i=e.indexOf(t);if(!(i<0)){for(;i<e.length;)e[i]=e[++i];e.pop()}}get width(){let t=this.#t;if(t!=t){const e=this._dimensions();t=this.#t=e.x,this.#e=e.y}return t}get height(){let t=this.#e;if(t!=t){const e=this._dimensions();this.#t=e.x,t=this.#e=e.y}return t}}class s extends i{constructor(t){super(),this.texture=t}get width(){return this.texture.width}get height(){return this.texture.height}draw(t,e,i,s){t.drawRect(0,0,i,s,this.texture)}}class n extends i{constructor(t,e){if(super(),"string"==typeof t){const i=t;(t=RichText(e)).add(i)}this.text=t}get width(){return this.text.width}get height(){return 1}draw(t,e,i,s){this.text.draw(t)}}e.canvas.style.setProperty("--__gamma__sarea__","env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)"),e.getUIDimensons=()=>{const{0:t,1:i,2:s,3:n}=getComputedStyle(e.canvas).getPropertyValue("--__gamma__sarea__").split(" ");return{width:.0625*e.canvas.offsetWidth,height:.0625*e.canvas.offsetHeight,paddingLeft:parseFloat(n),paddingRight:parseFloat(i),paddingBottom:parseFloat(s),paddingTop:parseFloat(t)}};class h extends i{constructor(t,e,i){super(),this.child=t,this.pos=e,this.size=i}width=0;height=0;replace(t){this.child.removeDependency(this.invalidate),(this.child=t).addDependency(this.invalidate)}draw(t,e,i,s){if(!this.child.draw)return;const{width:n,height:h}=this.child;let{size:r,pos:c}=this,o=1,l=1;"function"==typeof r&&(r=r(i/n,s/h)),"number"==typeof r?o=l=r:"object"==typeof r&&r&&(o=r.x,l=r.y);const a=i-n*o,d=s-h*l;"function"==typeof c&&(c=c(a,d)),"object"==typeof c?c&&t.translate(c.x*a,c.y*d):("number"!=typeof c&&(c=.5),t.translate(c*a,c*d)),t.scale(o,l),this.child.draw(t,e,n,h)}}class r extends i{constructor(t,e,i,s){super(),this.child=t,this.child.addDependency(this.invalidate),this.transform=e,this.anchorX=i,this.anchorY=s}get width(){return this.child.width}get height(){return this.child.height}replace(t){this.child.removeDependency(this.invalidate),(this.child=t).addDependency(this.invalidate)}draw(t,e,i,s){if(!this.child.draw)return;t.translate(i*this.anchorX,s*this.anchorY),this.transform(t,i,s);const{width:n,height:h}=this.child;t.translate(-n*this.anchorX,-h*this.anchorY),this.child.draw(t,e,n,h)}}class c extends i{constructor(t,e,i,s){super(),this.texture=t,this.pos=e,this.size=i,this.tint=s}width=0;height=0;draw(t,e,i,s){if(!this.texture)return void t.drawRect(0,0,i,s,this.tint);if(!this.texture.usable)return;let{width:n,height:h}=this.texture,{size:r,pos:c}=this;"function"==typeof r&&(r=r(i/n,s/h)),"number"==typeof r?(n*=r,h*=r):"object"==typeof r&&r&&(n*=r.x,h*=r.y);let o=i-n,l=s-h;"function"==typeof c&&(c=c(o,l)),"object"==typeof c?c&&(o*=c.x,l*=c.y):("number"!=typeof c&&(c=.5),o*=c,l*=c);const a=1/i,d=1/s;t.drawRect(0,0,i,s,this.texture.super(o*a,l*d,n*a,h*d),this.tint)}}class o extends i{#s;#n=[];state=0;hitTest=null;constructor(t,e,i){super(),this.#s=t?[t]:[],this.cursor=e,this.activeCursor=i}reset(){this.#s.length=this.#n.length=0}onClick(t){return this.#s.push(t),this}onStateChange(t){return this.#n.push(t),this}setCursor(t){return this.cur=t,this}rounded(t=0,e=t,i=t,s=t){const n=max(t,i),h=max(e,s);return this.hitTest=(r,c,o,l)=>{if(r<n)if(r<i){if(c<i){const t=r-i,e=c-i;if(t*t-e*e>i*i)return!1}}else if(l-c<t){const e=r-t,i=l-c-t;if(e*e-i*i>t*t)return!1}if(o-r>h)if(o-r<s){if(c<s){const t=o-r-s,e=c-s;if(t*t-e*e>s*s)return!1}}else if(l-c<e){const t=r-e,i=l-c-e;if(t*t-i*i>e*e)return!1}return!0},this}#h=-1;#r(t,e,i,s,n){let h=null;switch(!n){case!1:if(this.#h>=0&&s!=this.#h)return;if(h=t.unproject(n),h.x>=0&&h.x<e&&h.y>=0&&h.y<i&&(this.hitTest?.(h.x,h.y,e,i)??1))break;case!0:if(s==this.#h){this.#h=-1;const t=this.state;this.state=0;for(const e of this.#n)try{e(NaN,NaN,0,t)}catch(t){Promise.reject(t)}}return}const r=n.pressed?this.activeCursor:this.cursor;null!=r&&n.setHint?.(r);let c=this.state;this.state=1+n.pressed,-1==this.#h&&(this.#h=s);for(const t of this.#n)try{t(h.x,h.y,this.state,c)}catch(t){Promise.reject(t)}if(2!=this.state&&2==c)for(const t of this.#s)try{t(h.x,h.y,this.state)}catch(t){Promise.reject(t)}return null}draw(t,e,i,s){e.onPointerUpdate(this.#r.bind(this,t,i,s))}}e.GUI={CENTERED:vec2(.5,.5),LEFT:vec2(0,.5),RIGHT:vec2(1,.5),BOTTOM:vec2(.5,0),TOP:vec2(.5,1),BOTTOM_LEFT:vec2(0,0),BOTTOM_RIGHT:vec2(1,0),TOP_LEFT:vec2(0,1),TOP_RIGHT:vec2(1,1),ZStack:(t=>{class e extends i{children=[];add(t){return this.children.push(t),t.addDependency(this.invalidate),this}remove(t){const e=this.children;if("number"==typeof t){if((t>>>=0)>=e.length)return;for(e[t].removeDependency(this.invalidate);t<e.length;)e[t]=e[++t];e.pop()}else this.children.remove(t)>=0&&t.removeDependency(this.invalidate)}}return e.prototype.draw=t,()=>new e})(function(t,e,i,s){let n=this.children.length;for(const h of this.children)h.draw?.(--n?t.sub():t,e,i,s)}),Img:t=>new s(t),Text:(t,e)=>new n(t,e),Target:(t=null,e=PointerState.POINTER,i=PointerState.POINTER)=>new o(t,e,i),Box:(t,e=.5,i=1)=>new h(t,e,i),BoxFill:(t,e=.5,i=max,s)=>t.identity?new c(t,e,i,s):new c(null,1,1,t),Transform:(t,e=Function.prototype,i=.5,s=.5)=>new r(t,e,i,s)};e.vec4(.2);const l=({target:t})=>(256&t._field._f||(t._field._f|=256,setImmediate(t._field.recalc)),t.remove(),e.setFocused(u=null)),a=t=>{const e=t.target._field;if(38==t.keyCode||40==t.keyCode){if(e._f>>1&1^t.shiftKey)38==t.keyCode?e.upArrowCb?.():e.downArrowCb?.();else if(2048&e._f)if(e.sel0==e.sel1){let i=e.sel0,s=i,n=e.sel0pos,h=n;for(;h;)i-=e.lines[--h].length;const r=e.lines[n].slice(0,i).width;if(38==t.keyCode&&n){const t=e.lines[n-1];e.sel0=e.sel1=s-i-t.length+t.indexAt(r)}else 40==t.keyCode&&n<e.lines.length-1&&(e.sel0=e.sel1=s-i+e.lines[n].length+e.lines[n+1].indexAt(r))}else 38==t.keyCode?e.sel0=e.sel1:e.sel1=e.sel0}else if(13==t.keyCode){if(!(e._f>>2&1^t.shiftKey))return;e.enterCb?.()}else{if(9!=t.keyCode)return;e._f>>3&1^t.shiftKey?e.tabCb?.():1&e._f&&e.insert("\t")}t.preventDefault()},d=(t,e)=>{const i=document.createElement(t);return i.style="width:1px;height:1px;border:0;padding:0;opacity:0;position:fixed;inset:-9px;font-size:16px;font-family:monospace;white-space:nowrap;pointer-events:none",i.onblur=l,i.onkeydown=a,i.tabIndex=-1,i._field=e,document.documentElement.append(i),i},f=e.vec4;let u=null,p=0;const w=(t,e)=>t.insertLinePass(-1,[e.focus?f(0,.2,.4,.6):f(.2,.2,.2,.6)],0,1),m=(t,i)=>{i&&(t.shader=null,(e.t-p)%1<.5&&t.drawRect(0,i.ascend-1,.05,1,f.one))};class g{_f=0;#c=0;#o=0;get allowTabs(){return!!(1&this._f)}set allowTabs(t){this._f=-2&this._f|1&t}get shiftArrows(){return!!(2&this._f)}set shiftArrows(t){this._f=-3&this._f|2&-t}get shiftEnter(){return!!(4&this._f)}set shiftEnter(t){this._f=-5&this._f|4&-t}get shiftTab(){return!!(8&this._f)}set shiftTab(t){this._f=-9&this._f|8&-t}upArrowCb=null;downArrowCb=null;enterCb=null;tabCb=null;scrollable=null;#l;constructor(t){this.#l=d(t?"textarea":"input",this),this._f=t}get value(){return this.#l.value}set value(t){this.#l.value=t,256&this._f||(this._f|=256,setImmediate(this.recalc))}get sel0(){return this.#c}set sel0(t){t>>>=0,this.#o>=this.#c?t<=this.#o?this.#l.selectionStart=t:(this.#l.selectionStart=this.#o,this.#l.selectionEnd=t,this.#l.selectionDirection="backward"):t>this.#o?this.#l.selectionEnd=t:(this.#l.selectionStart=t,this.#l.selectionEnd=this.#o,this.#l.selectionDirection="forward"),this.#c=t}get sel1(){return this.#o}set sel1(t){t>>>=0,this.#o>=this.#c?t>=this.#c?this.#l.selectionEnd=t:(this.#l.selectionStart=t,this.#l.selectionEnd=this.#c,this.#l.selectionDirection="backward"):t<this.#c?this.#l.selectionStart=t:(this.#l.selectionStart=this.#c,this.#l.selectionEnd=t,this.#l.selectionDirection="forward"),this.#o=t}select(t,e=t){(t>>>=0)<=(e>>>=0)?(this.#l.selectionStart=t,this.#l.selectionEnd=e,this.#c>this.#o&&(this.#l.selectionDirection="forward")):(this.#l.selectionStart=e,this.#l.selectionEnd=t,this.#c<=this.#o&&(this.#l.selectionDirection="backward")),this.#c=t,this.#o=e,256&this._f||(this._f|=256,setImmediate(this.recalc))}get selStart(){return min(this.#c,this.#o)}get selEnd(){return max(this.#c,this.#o)}get isSelecting(){return!!(512&this._f)}#a=null;get transformer(){return this.#a}set transformer(t){this.#a!=(this.#a=t)&&!(256&this._f)&&(this._f|=256,setImmediate(this.recalc))}simpleTransformer(t,i="",...s){let n=s.slice();n[0]=s[0]?f.multiply(s[0],.4):f(.4),this.#a=h=>{const r=e.RichText(t);return s.length&&r.setTextPass(0,s),h?r.add(h):(r.setTextPass(0,n),r.index=!1,r.add(i)),r},256&this._f||(this._f|=256,setImmediate(this.recalc))}#d=m;#f=w;#u=null;#p=null;#w=1/0;#m=0;#g=0;#t=0;get sel0pos(){return this.#m}get sel1pos(){return this.#g}get multiline(){return!!(2048&this._f)}set multiline(t=!0){const i=this.#l,s=i.value,n=document.activeElement==i;if(t){if(2048&this._f)return;this.#u=null,this._f|=2304,this.#l=d("textarea",this)}else{if(!(2048&this._f))return;this.#p=null,this._f=-2049&this._f|256,this.#l=d("input",this)}n?this.focus=!0:(i.remove(),u==i&&e.setFocused(u=null),256&this._f||(this._f|=256,setImmediate(this.recalc))),this.#l.value=s,this.#l.selectionStart=this.#c,this.#l.selectionEnd=this.#o,this.#l.selectionDirection=this.#c>this.#o?"backward":"forward"}get width(){return this.#t}get line(){return this.#u}get lines(){return this.#p}get cursor(){return this.#d}set cursor(t){this.#d!=(this.#d=t)&&!(256&this._f)&&(this._f|=256,setImmediate(this.recalc))}get selector(){return this.#f}set selector(t){this.#f!=(this.#f=t)&&!(256&this._f)&&(this._f|=256,setImmediate(this.recalc))}get maxWidth(){return this.#w}set maxWidth(t){this.#w=t,256&this._f||(this._f|=256,setImmediate(this.recalc))}recalc=()=>{const t=this._f;if(!(256&t))return;const i=this.#l,s=min(this.#c,this.#o),n=max(this.#c,this.#o);this._f=-257&t,p=e.t;const h=i.value,r=this.#a?.(h,this)??e.RichText();if(s==n){const e=r.slice(s);r.trim(s),2048&t||(this.#m=this.#g=r.width),this.#d&&document.activeElement==this.#l&&r.addCb(this.#d),r.concat(e)}else{const e=r.slice(s),i=e.slice(n-s);e.trim(n-s),r.trim(s),2048&t?(this.#f?.(e,this),r.concat(e)):(this.#m=r.width,this.#f?.(e,this),r.concat(e),this.#g=r.width),r.concat(i)}if(2048&t){const t=this.#p=r.break(this.#w);let e=0;for(const{width:i}of t)i>e&&(e=i);this.#t=e;let i=s,h=0;for(;h<t.length&&i>=0;)i-=t[h++].length;for(i=n-s+i+(h?t[--h].length:0),this.#m=h;h<t.length&&i>=0;)i-=t[h++].length;this.#g=h?h-1:0}else this.#u=r,this.#t=r.width};insert(t="",e=t.length){const i=this.#l,s=i.selectionStart;i.setRangeText(t,s,i.selectionEnd,"start"),i.selectionStart=i.selectionEnd=this.#c=this.#o=s+e}get focus(){return document.activeElement==this.#l}set focus(t=!0){if(t){if(u){if(u==this.#l)return;u.replaceWith(u=this.#l)}else document.documentElement.append(u=this.#l);e.setFocused(u),p=e.t,256&this._f||(this._f|=256,setImmediate(this.recalc))}else u==this.#l&&(u.remove(),e.setFocused(u=null))}lineHeight=1.3;lineAscend=.9;#_=0;#y=-1;#r(e,i,s){if(!s)return void(i==this.#y&&(this.#y=-1,this._f&=-1537));if(s.setHint?.(PointerState.TEXT),-1==this.#y&&s.pressed)this.#y=i,this.focus=!0;else if(this.#y!=i)return null;if(!s.pressed)return this.#y=-1,this._f&=-1537,null;let{x:n,y:h}=e.unproject(s);h=this.lineAscend-h;const r=this._f>>9&3;if(3==r)return null;let c=0;if(this.#u)c=this.#u.indexAt(n);else if(this.#p){let t=floor(h/this.lineHeight);for(t=t>=0?t>=this.#p.length?this.#p.length-1:t>>>0:0,c=this.#p[t].indexAt(n);t;)c+=this.#p[--t].length}if(r)this.sel1=c;else{let e=0,i=c,s=c;if(this.#_<0?this.#_-(this.#_=-t)<.3?e=2:this.#_=t:this.#_>0?this.#_-(this.#_=t)>-.3&&(e=1,this.#_=-t):this.#_=t,this._f|=512|(e>0)<<10,e){const t=this.#l.value,n=33-e;for(;t.charCodeAt(s++)>n;);for(;t.charCodeAt(--i)>n;);i++,s--}i==this.#c&&s==this.#o||this.select(i,s)}return null}get height(){return this.lineHeight*(this.#p?this.#p.length:1)}layout(t,i,s=-1/0,n=-1/0,h=1/0,r=1/0){i.onPointerUpdate(this.#r.bind(this,t)),i.onKeyUpdate((t,i)=>(e.captureKeyEvent(this.#l,t,i),!1))}get height(){return this.#p?this.#p.length*this.lineHeight:this.lineHeight}get xOffset(){return 0}get yOffset(){return-this.lineAscend}draw(t,e){if(this.#p)for(const e of this.#p)e.draw(t.sub()),t.translate(0,-this.lineHeight);else this.#u?.draw(t)}static#x=(document.addEventListener("input",({target:t})=>{const e=t._field;if(!e)return;const{selectionStart:i,selectionEnd:s,selectionDirection:n}=t;"backward"==n?(e.#c=s,e.#o=i):(e.#c=i,e.#o=s),256&e._f||(e._f|=256,setImmediate(e.recalc))}),document.addEventListener("selectionchange",({target:t})=>{const e=t._field;if(!e)return;const{selectionStart:i,selectionEnd:s,selectionDirection:n}=t;"backward"==n?(e.#c=s,e.#o=i):(e.#c=i,e.#o=s),256&e._f||(e._f|=256,setImmediate(e.recalc))}))}e.TextField=(t=!1)=>new g(t<<11&2048),e.TextField.cursorTimer=()=>e.t-p};