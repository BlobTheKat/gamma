Gamma.gui=e=>{if(!e.Font)throw"Initialize Gamma.font before Gamma.gui";class i{#t=NaN;#e=NaN;#i=null;_dimensions(){return vec2.zero}invalidate=()=>{this.#t=this.#e=NaN;const t=this.#i;if(this.#i=null,t)if("function"==typeof t)try{t()}catch(t){Promise.reject(t)}else for(const e of t)try{e()}catch(t){Promise.reject(t)}};addDependency(t){if("function"!=typeof t)return;const e=this.#i;e?"function"==typeof e?this.#i=[e,t]:e.push(t):this.#i=t}removeDependency(t){const e=this.#i;if(!e)return;if("function"==typeof e)return void(e===t&&(this.#i=null));let i=e.indexOf(t);if(!(i<0)){for(;i<e.length;)e[i]=e[++i];e.pop()}}get width(){let t=this.#t;if(t!=t){const e=this._dimensions();t=this.#t=e.x,this.#e=e.y}return t}get height(){let t=this.#e;if(t!=t){const e=this._dimensions();this.#t=e.x,t=this.#e=e.y}return t}}class s extends i{constructor(t){super(),this.texture=t}get width(){return this.texture.width}get height(){return this.texture.height}draw(t,e,i,s){t.drawRect(0,0,i,s,this.texture)}}class n extends i{constructor(t,e){if(super(),"string"==typeof t){const i=t;(t=RichText(e)).add(i)}this.text=t}get width(){return this.text.width}get height(){return 1}draw(t,e,i,s){this.text.draw(t)}}e.canvas.style.setProperty("--__gamma__sarea__","env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)"),e.getUIDimensons=()=>{const{0:t,1:i,2:s,3:n}=getComputedStyle(e.canvas).getPropertyValue("--__gamma__sarea__").split(" ");return{width:.0625*e.canvas.offsetWidth,height:.0625*e.canvas.offsetHeight,paddingLeft:parseFloat(n),paddingRight:parseFloat(i),paddingBottom:parseFloat(s),paddingTop:parseFloat(t)}};class r extends i{constructor(t,e,i){super(),this.child=t,this.pos=e,this.size=i}width=0;height=0;replace(t){this.child.removeDependency(this.invalidate),(this.child=t).addDependency(this.invalidate)}draw(t,e,i,s){if(!this.child.draw)return;const{width:n,height:r}=this.child;let{size:h,pos:o}=this,c=1,l=1;"function"==typeof h&&(h=h(i/n,s/r)),"number"==typeof h?c=l=h:"object"==typeof h&&h&&(c=h.x,l=h.y);const a=i-n*c,d=s-r*l;"function"==typeof o&&(o=o(a,d)),"object"==typeof o?o&&t.translate(o.x*a,o.y*d):("number"!=typeof o&&(o=.5),t.translate(o*a,o*d)),t.scale(c,l),this.child.draw(t,e,n,r)}}class h extends i{constructor(t,e,i,s){super(),this.texture=t,this.pos=e,this.size=i,this.tint=s}width=0;height=0;draw(t,e,i,s){if(!this.texture.identity)return void t.drawRect(0,0,i,s,this.texture);if(!this.texture.usable)return;let{width:n,height:r}=this.texture,{size:h,pos:o}=this;"function"==typeof h&&(h=h(i/n,s/r)),"number"==typeof h?(n*=h,r*=h):"object"==typeof h&&h&&(n*=h.x,r*=h.y);let c=i-n,l=s-r;"function"==typeof o&&(o=o(c,l)),"object"==typeof o?o&&(c*=o.x,l*=o.y):("number"!=typeof o&&(o=.5),c*=o,l*=o);const a=1/i,d=1/s;t.drawRect(0,0,i,s,this.texture.super(c*a,l*d,n*a,r*d),this.tint)}}class o extends i{#s;#n=[];state=0;hitTest=null;constructor(t,e,i){super(),this.#s=t?[t]:[],this.cursor=e,this.activeCursor=i}reset(){this.#s.length=this.#n.length=0}onClick(t){return this.#s.push(t),this}onStateChange(t){return this.#n.push(t),this}setCursor(t){return this.cur=t,this}rounded(t=0,e=t,i=t,s=t){const n=max(t,i),r=max(e,s);return this.hitTest=(h,o,c,l)=>{if(h<n)if(h<i){if(o<i){const t=h-i,e=o-i;if(t*t-e*e>i*i)return!1}}else if(l-o<t){const e=h-t,i=l-o-t;if(e*e-i*i>t*t)return!1}if(c-h>r)if(c-h<s){if(o<s){const t=c-h-s,e=o-s;if(t*t-e*e>s*s)return!1}}else if(l-o<e){const t=h-e,i=l-o-e;if(t*t-i*i>e*e)return!1}return!0},this}#r=-1;#h(t,e,i,s,n){switch(!n){case!1:if(this.#r>=0&&s!=this.#r)return;const r=t.unproject(n);if(r.x>=0&&r.x<e&&r.y>=0&&r.y<i&&(this.hitTest?.(r.x,r.y,e,i)??1))break;case!0:if(s==this.#r){this.#r=-1;const t=this.state;this.state=0;for(const e of this.#n)try{e(0,t)}catch(t){Promise.reject(t)}}return}const r=n.pressed?this.activeCursor:this.cursor;null!=r&&n.setHint?.(r);let h=this.state;this.state=1+n.pressed,-1==this.#r&&(this.#r=s);for(const t of this.#n)try{t(this.state,h)}catch(t){Promise.reject(t)}if(2!=this.state&&2==h)for(const t of this.#s)try{t(this.state)}catch(t){Promise.reject(t)}return null}draw(t,e,i,s){e.onPointerUpdate(this.#h.bind(this,t,i,s))}}e.GUI={CENTERED:vec2(.5,.5),LEFT:vec2(0,.5),RIGHT:vec2(1,.5),BOTTOM:vec2(.5,0),TOP:vec2(.5,1),BOTTOM_LEFT:vec2(0,0),BOTTOM_RIGHT:vec2(1,0),TOP_LEFT:vec2(0,1),TOP_RIGHT:vec2(1,1),ZStack:(t=>{class e extends i{children=[];add(t){return this.children.push(t),t.addDependency(this.invalidate),this}remove(t){const e=this.children;if("number"==typeof t){if((t>>>=0)>=e.length)return;for(e[t].removeDependency(this.invalidate);t<e.length;)e[t]=e[++t];e.pop()}else this.children.remove(t)>=0&&t.removeDependency(this.invalidate)}}return e.prototype.draw=t,()=>new e})(function(t,e,i,s){let n=this.children.length;for(const r of this.children)r.draw?.(--n?t.sub():t,e,i,s)}),Img:t=>new s(t),Text:(t,e)=>new n(t,e),Button:(t=null,e=PointerState.POINTER,i=PointerState.POINTER)=>new o(t,e,i),Box:(t,e=.5,i=1)=>new r(t,e,i),BoxFill:(t,e=.5,i=max,s)=>new h(t,e,i,s)};const c=({target:t})=>(256&t._field._f||(t._field._f|=256,setImmediate(t._field.recalc)),t.remove(),e.setFocused(f=null)),l=t=>{const e=t.target._field;if(38==t.keyCode||40==t.keyCode){if(e._f>>1&1^t.shiftKey)38==t.keyCode?e.upArrowCb?.():e.downArrowCb?.();else if(2048&e._f)if(e.sel0==e.sel1){let i=e.sel0,s=i,n=e.sel0pos,r=n;for(;r;)i-=e.lines[--r].length;const h=e.lines[n].slice(0,i).width;if(38==t.keyCode&&n){const t=e.lines[n-1];e.sel0=e.sel1=s-i-t.length+t.indexAt(h)}else 40==t.keyCode&&n<e.lines.length-1&&(e.sel0=e.sel1=s-i+e.lines[n].length+e.lines[n+1].indexAt(h))}else 38==t.keyCode?e.sel0=e.sel1:e.sel1=e.sel0}else if(13==t.keyCode){if(!(e._f>>2&1^t.shiftKey))return;e.enterCb?.()}else{if(9!=t.keyCode)return;e._f>>3&1^t.shiftKey?e.tabCb?.():1&e._f&&e.insert("\t")}t.preventDefault()},a=(t,e)=>{const i=document.createElement(t);return i.style="width:1px;height:1px;border:0;padding:0;opacity:0;position:fixed;inset:-9px;font-size:16px;font-family:monospace;white-space:nowrap;pointer-events:none",i.onblur=c,i.onkeydown=l,i.tabIndex=-1,i._field=e,document.documentElement.append(i),i},d=e.vec4;let f=null,u=0;const p=(t,e)=>t.insertLinePass(-1,[e.focus?d(0,.2,.4,.6):d(.2,.2,.2,.6)],0,1),w=(t,i)=>{i&&(t.shader=null,(e.t-u)%1<.5&&t.drawRect(0,i.ascend-1,.05,1,d.one))};class m{_f=0;#o=0;#c=0;get allowTabs(){return!!(1&this._f)}set allowTabs(t){this._f=-2&this._f|1&t}get shiftArrows(){return!!(2&this._f)}set shiftArrows(t){this._f=-3&this._f|2&-t}get shiftEnter(){return!!(4&this._f)}set shiftEnter(t){this._f=-5&this._f|4&-t}get shiftTab(){return!!(8&this._f)}set shiftTab(t){this._f=-9&this._f|8&-t}upArrowCb=null;downArrowCb=null;enterCb=null;tabCb=null;scrollable=null;#l;constructor(t){this.#l=a(t?"textarea":"input",this),this._f=t}get value(){return this.#l.value}set value(t){this.#l.value=t,256&this._f||(this._f|=256,setImmediate(this.recalc))}get sel0(){return this.#o}set sel0(t){t>>>=0,this.#c>=this.#o?t<=this.#c?this.#l.selectionStart=t:(this.#l.selectionStart=this.#c,this.#l.selectionEnd=t,this.#l.selectionDirection="backward"):t>this.#c?this.#l.selectionEnd=t:(this.#l.selectionStart=t,this.#l.selectionEnd=this.#c,this.#l.selectionDirection="forward"),this.#o=t}get sel1(){return this.#c}set sel1(t){t>>>=0,this.#c>=this.#o?t>=this.#o?this.#l.selectionEnd=t:(this.#l.selectionStart=t,this.#l.selectionEnd=this.#o,this.#l.selectionDirection="backward"):t<this.#o?this.#l.selectionStart=t:(this.#l.selectionStart=this.#o,this.#l.selectionEnd=t,this.#l.selectionDirection="forward"),this.#c=t}select(t,e=t){(t>>>=0)<=(e>>>=0)?(this.#l.selectionStart=t,this.#l.selectionEnd=e,this.#o>this.#c&&(this.#l.selectionDirection="forward")):(this.#l.selectionStart=e,this.#l.selectionEnd=t,this.#o<=this.#c&&(this.#l.selectionDirection="backward")),this.#o=t,this.#c=e,256&this._f||(this._f|=256,setImmediate(this.recalc))}get selStart(){return min(this.#o,this.#c)}get selEnd(){return max(this.#o,this.#c)}get isSelecting(){return!!(512&this._f)}#a=null;get transformer(){return this.#a}set transformer(t){this.#a!=(this.#a=t)&&!(256&this._f)&&(this._f|=256,setImmediate(this.recalc))}simpleTransformer(t,i="",...s){let n=s.slice();n[0]=s[0]?d.multiply(s[0],.4):d(.4),this.#a=r=>{const h=e.RichText(t);return s.length&&h.addTextPass(0,s),r?h.add(r):(h.addTextPass(0,n),h.index=!1,h.add(i)),h},256&this._f||(this._f|=256,setImmediate(this.recalc))}#d=w;#f=p;#u=null;#p=null;#w=1/0;#m=0;#g=0;#t=0;get sel0pos(){return this.#m}get sel1pos(){return this.#g}get multiline(){return!!(2048&this._f)}set multiline(t=!0){const i=this.#l,s=i.value,n=document.activeElement==i;if(t){if(2048&this._f)return;this.#u=null,this._f|=2304,this.#l=a("textarea",this)}else{if(!(2048&this._f))return;this.#p=null,this._f=-2049&this._f|256,this.#l=a("input",this)}n?this.focus=!0:(i.remove(),f==i&&e.setFocused(f=null),256&this._f||(this._f|=256,setImmediate(this.recalc))),this.#l.value=s,this.#l.selectionStart=this.#o,this.#l.selectionEnd=this.#c,this.#l.selectionDirection=this.#o>this.#c?"backward":"forward"}get width(){return this.#t}get line(){return this.#u}get lines(){return this.#p}get cursor(){return this.#d}set cursor(t){this.#d!=(this.#d=t)&&!(256&this._f)&&(this._f|=256,setImmediate(this.recalc))}get selector(){return this.#f}set selector(t){this.#f!=(this.#f=t)&&!(256&this._f)&&(this._f|=256,setImmediate(this.recalc))}get maxWidth(){return this.#w}set maxWidth(t){this.#w=t,256&this._f||(this._f|=256,setImmediate(this.recalc))}recalc=()=>{const t=this._f;if(!(256&t))return;const i=this.#l,s=min(this.#o,this.#c),n=max(this.#o,this.#c);this._f=-257&t,u=e.t;const r=i.value,h=this.#a?.(r,this)??e.RichText();if(s==n){const e=h.slice(s);h.trim(s),2048&t||(this.#m=this.#g=h.width),this.#d&&document.activeElement==this.#l&&h.addCb(this.#d),h.concat(e)}else{const e=h.slice(s),i=e.slice(n-s);e.trim(n-s),h.trim(s),2048&t?(this.#f?.(e,this),h.concat(e)):(this.#m=h.width,this.#f?.(e,this),h.concat(e),this.#g=h.width),h.concat(i)}if(2048&t){const t=this.#p=h.break(this.#w);let e=0;for(const{width:i}of t)i>e&&(e=i);this.#t=e;let i=s,r=0;for(;r<t.length&&i>=0;)i-=t[r++].length;for(i=n-s+i+(r?t[--r].length:0),this.#m=r;r<t.length&&i>=0;)i-=t[r++].length;this.#g=r?r-1:0}else this.#u=h,this.#t=h.width};insert(t="",e=t.length){const i=this.#l,s=i.selectionStart;i.setRangeText(t,s,i.selectionEnd,"start"),i.selectionStart=i.selectionEnd=this.#o=this.#c=s+e}get focus(){return document.activeElement==this.#l}set focus(t=!0){if(t){if(f){if(f==this.#l)return;f.replaceWith(f=this.#l)}else document.documentElement.append(f=this.#l);e.setFocused(f),u=e.t,256&this._f||(this._f|=256,setImmediate(this.recalc))}else f==this.#l&&(f.remove(),e.setFocused(f=null))}lineHeight=1.3;lineAscend=.9;#_=0;#y=-1;#h(e,i,s){if(!s)return void(i==this.#y&&(this.#y=-1,this._f&=-1537));if(s.setHint?.(PointerState.TEXT),-1==this.#y&&s.pressed)this.#y=i,this.focus=!0;else if(this.#y!=i)return null;if(!s.pressed)return this.#y=-1,this._f&=-1537,null;let{x:n,y:r}=e.unproject(s);r=this.lineAscend-r;const h=this._f>>9&3;if(3==h)return null;let o=0;if(this.#u)o=this.#u.indexAt(n);else if(this.#p){let t=floor(r/this.lineHeight);for(t=t>=0?t>=this.#p.length?this.#p.length-1:t>>>0:0,o=this.#p[t].indexAt(n);t;)o+=this.#p[--t].length}if(h)this.sel1=o;else{let e=0,i=o,s=o;if(this.#_<0?this.#_-(this.#_=-t)<.3?e=2:this.#_=t:this.#_>0?this.#_-(this.#_=t)>-.3&&(e=1,this.#_=-t):this.#_=t,this._f|=512|(e>0)<<10,e){const t=this.#l.value,n=33-e;for(;t.charCodeAt(s++)>n;);for(;t.charCodeAt(--i)>n;);i++,s--}i==this.#o&&s==this.#c||this.select(i,s)}return null}get height(){return this.lineHeight*(this.#p?this.#p.length:1)}layout(t,i,s=-1/0,n=-1/0,r=1/0,h=1/0){i.onPointerUpdate(this.#h.bind(this,t)),i.onKeyUpdate((t,i)=>(e.captureKeyEvent(this.#l,t,i),!1))}get height(){return this.#p?this.#p.length*this.lineHeight:this.lineHeight}get xOffset(){return 0}get yOffset(){return-this.lineAscend}draw(t,e){if(this.#p)for(const e of this.#p)e.draw(t.sub()),t.translate(0,-this.lineHeight);else this.#u?.draw(t)}static#x=(document.addEventListener("input",({target:t})=>{const e=t._field;if(!e)return;const{selectionStart:i,selectionEnd:s,selectionDirection:n}=t;"backward"==n?(e.#o=s,e.#c=i):(e.#o=i,e.#c=s),256&e._f||(e._f|=256,setImmediate(e.recalc))}),document.addEventListener("selectionchange",({target:t})=>{const e=t._field;if(!e)return;const{selectionStart:i,selectionEnd:s,selectionDirection:n}=t;"backward"==n?(e.#o=s,e.#c=i):(e.#o=i,e.#c=s),256&e._f||(e._f|=256,setImmediate(e.recalc))}))}e.TextField=(t=!1)=>new m(t<<11&2048),e.TextField.cursorTimer=()=>e.t-u};