Gamma.font=e=>{const t=e.vec4.one,s={x:0,y:1},n=e.Shader.MSDF=e.Shader("void main(){vec3 c=param0(uv).rgb;color=param2*clamp(param1.y*(max(min(c.r, c.g), min(max(c.r, c.g), c.b))-.5+param1.x)+.5,0.,1.);}",{params:[e.COLOR,e.VEC2,e.VEC4],defaults:[void 0,{x:0,y:1},t]});e.Shader.font=(t,s)=>{let n="float field(vec2 uv){vec3 c=param0(uv).rgb;return max(min(c.r, c.g), min(max(c.r, c.g), c.b)); }\n#define scale param1\n";Array.isArray(s.params)||(l.params="number"==typeof s.params?[s.params]:[]),Array.isArray(s.defaults)||(s.defaults=void 0===s.defaults?[]:[s.defaults]);for(let e=0;e<s.params.length;e++)n+=`#define value${e} param${e+2}\n`;return s.params.unshift(e.COLOR,e.VEC2),s.defaults.unshift(void 0,{x:0,y:1}),e.Shader(n+t,s)};const r=e.BreakToken=(e,t=0,s="",n=void 0)=>{if(e instanceof RegExp){let t=e.flags,s=t.indexOf("g");s>-1&&(t=t.slice(0,s)+t.slice(s+1)),t.includes("y")||(t+="y"),t!=e.flags&&(e=new RegExp(e.source,t))}else{let t="[";for(const s of e+""){const e=s.codePointAt();t+=e>=92&&e<=94||45==e?"\\"+s:s}e=new RegExp(t+"]","y")}return e.type=t,e.sep=s,e.next=n,e.sepW=e.sepA=e.sepS=0,e.sepL=null,e};r.NORMAL=0,r.NEVER_BREAK=1,r.ALWAYS_BREAK=2,r.OVERFLOW=3,r.VANISH=4,r.TRUNCATE=5,r.SQUISH=6,r.SQUISH_BREAK=7,r.WRAP_AFTER=8,r.WRAP_BEFORE=16,r.INVISIBLE=32;const o=[r(/\r\n?|\n/y,r.WRAP_AFTER|r.INVISIBLE,""),r(/[$£"+]?[\w'-]+[,.!?:;"^%€*]?/iy,r.NORMAL,"-"),r(/[ \t]+/y,r.VANISH)],i=r(/[^]/y,r.ALWAYS_BREAK),c={x:0,y:0},l={off:0,spr:-1,0:null,1:c},a=[0,0,0,l],f=(e,t,s,n=0)=>{if(e.sepL=t,e.sepA=s,e.sepS=n,!t)return e.sepW=0;let r=0;const o=1/s;for(const i of e.sep){const e=i.codePointAt(),c=(t.get(~e)??t._default)._xadv+n+(t.get(e+-1114112)??0);r+=s&&asin(c*s)*o||c}return t.then?.(()=>e.sepL==t&&(e.sepL=null,e.sepW=0)),e.sepW=r};class h extends Array{#e=null;#t=n;#s=1;#n=0;#r=1;#o=0;#i=0;#c=0;#l=a;#a=0;#f=NaN;#h=null;#u=!0;static public=class e{constructor(e){this.#p=e}sub(){const t=new e(this.#p);return t.#b=this.#b,t.#y=this.#y,t.#g=this.#g,t.#_=this.#_,t.#k=this.#k,t.#d=this.#d,t.#m=this.#m,t.#v=this.#v,t}reset(e=null){this.#b="object"==typeof e?e:null,this.#y=n,this.#g=1,this.#_=0,this.#k=0,this.#d=0,this.#v=null,this.#m=0,this.#p.#h==this&&(this.#p.#h=null)}#p;#b=null;#A=!0;get font(){return this.#b}set font(e){"object"==typeof e&&(this.#b=e),this.#p.#h==this&&(this.#p.#h=null)}#y=n;get shader(){return this.#y}set shader(e){"function"==typeof e&&(this.#y=e),this.#p.#h==this&&(this.#p.#h=null)}#g=1;get scale(){return this.#g}set scale(e){this.#g=+e,this.#p.#h==this&&(this.#p.#h=null)}scaleBy(e=1,t=!0,s=!0){if(1==e)return;const n=this.#p,r=n.length;let o=0,i=0;for(;o<r;){const r=n[o++];"number"==typeof r?(3==r||4==r&&s?(i||(i=1),n[o]*=e):1==r&&t&&(n[o]*=e),o++):"string"!=typeof r&&"function"!=typeof r||i||(i=2)}1!=i&&n.unshift(3,e),n.#s*=e,s&&(n.#n*=e),n.#f=NaN,n.#h=null}#w=0;get yOffset(){return this.#w}set yOffset(e){this.#w=+e,this.#p.#h==this&&(this.#p.#h=null)}offsetBy(e=0,t=!1){if(!e)return;const s=this.#p,n=s.length;let r=0,o=0,i=1,c=!1,l=0;for(;r<n;){const n=s[r++];if("number"==typeof n)4==n?(o||(o=1),l=s[r],s[r]=l+e*i,c=!1):t&&3==n&&(i=1/s[r],c=!0),r++;else if("string"==typeof n||"function"==typeof n){if(c){s.push(null,null);for(let e=s.length-3;e>=r;e--)s[e+2]=s[e];s[r++]=4,s[r++]=l+e*i}o||(o=2)}}1!=o&&s.unshift(4,e),s.#n+=e,s.#h=null}#_=1;get stretch(){return this.#_}set stretch(e){this.#_=+e,this.#p.#h==this&&(this.#p.#h=null)}stretchBy(e=1,t=!0,s=!1){if(1==e)return;const n=this.#p,r=n.length;let o=0,i=0;for(;o<r;){const r=n[o++];"number"==typeof r?(5==r||6==r&&s?(i||(i=1),n[o]*=e):1==r&&t&&(n[o]*=e),o++):"string"!=typeof r&&"function"!=typeof r||i||(i=2)}1!=i&&(s?n.unshift(6,e,5,e):n.unshift(5,e)),n.#r*=e,s&&(n.#o*=e),n.#f=NaN,n.#h=null}get letterWidth(){return this.#g*this.stretch}set letterWidth(e){this.stretch=e/this.#g}#k=0;get skew(){return this.#k}set skew(e){this.#k=+e,this.#p.#h==this&&(this.#p.#h=null)}skewBy(e=0){if(!e)return;const t=this.#p,s=t.length;let n=0,r=0;for(;n<s;){const s=t[n++];"number"==typeof s?(6==s&&(r||(r=1),t[n]+=e),n++):"string"!=typeof s&&"function"!=typeof s||r||(r=2)}1!=r&&t.unshift(6,e),t.#o+=e,t.#h=null}#d=0;get letterSpacing(){return this.#d}set letterSpacing(e){this.#d=+e,this.#p.#h==this&&(this.#p.#h=null)}spaceBy(e=0){if(!e)return;const t=this.#p,s=t.length;let n=0,r=0;for(;n<s;){const s=t[n++];"number"==typeof s?(7==s&&(r||(r=1),t[n]+=e),n++):"string"!=typeof s&&"function"!=typeof s||r||(r=2)}1!=r&&t.unshift(7,e),t.#i+=e,t.#f=NaN,t.#h=null}#m=0;get curve(){return this.#m}set curve(e){this.#m=+e,this.#p.#h==this&&(this.#p.#h=null)}curveBy(e=0){if(!e)return;const t=this.#p,s=t.length;let n=0,r=0;for(;n<s;){const s=t[n++];"number"==typeof s?(8==s?(r||(r=1),t[n]+=e):1!=s||r||(r=2),n++):"string"!=typeof s&&"function"!=typeof s||r||(r=2)}1!=r&&t.unshift(8,e),t.#c+=e,t.#f=NaN,t.#h=null}#v=a;addTextPass(e,t,s,n,r=0,o=-1){const i={off:r,spr:.5/o,0:null,1:c};if(n)for(let e=0;e<n.length;e++)i[e+2]=n[e];const l=this.#v,a=this.#v=[];let f=0;for(;f<l.length;f+=4){if(!(l[f]<e)){l[f]==e&&(f+=4);break}a.push(l[f],l[f+1],l[f+2],l[f+3])}for(a.push(e,+t,+s,i);f<l.length;)a.push(l[f],l[f+1],l[f+2],l[f+3]),f+=4;this.#p.#h=null}addLinePass(e,n,r,o){const i={0:t,1:s};for(let e=0;e<o.length;e++)i[e+2]=o[e];const c=this.#v,l=this.#v=[];let a=0;for(;a<c.length;a+=4){if(!(c[a]<e)){c[a]==e&&(a+=4);break}l.push(c[a],c[a+1],c[a+2],c[a+3])}for(l.push(e,i,+n,+r);a<c.length;)l.push(c[a],c[a+1],c[a+2],c[a+3]),a+=4;this.#p.#h=null}setValues(e,t){const s=this.#v=this.#v.slice();for(let n=0;n<s.length;n+=4){if(s[n]==e){let e=s[n+=3];"number"==typeof e&&(e=s[n-=2]),s[n]=e=Object.assign({},e);for(let s=t.length-1;s>=0;s--){const n=t[s];void 0!==n&&(e[s+2]=n)}break}if(s[n]>e)break}this.#p.#h=null}delPass(e){const t=this.#v,s=this.#v=[];let n=0;for(;n<t.length;n+=4){if(!(t[n]<e)){t[n]==e&&(n+=4);break}s.push(t[n],t[n+1],t[n+2],t[n+3])}for(;n<t.length;)s.push(t[n],t[n+1],t[n+2],t[n+3]),n+=4;this.#p.#h=null}insertTextPass(e,t,s,n,r=0,o=-1){const i={off:r,spr:.5/o,0:null,1:c};if(n)for(let e=0;e<n.length;e++)i[e+2]=n[e];const a=this.#p,f=a.length;let h=0,u=0;for(;h<f;){let n=a[h++];if("number"==typeof n&&n>0)h++;else if("string"==typeof n||"function"==typeof n)u||(u=2);else if(Array.isArray(n)){u||(u=1);const r=a[h-1]=[];let o=0;for(;o<n.length;o+=4){if(!(n[o]<e)){n[o]==e&&(o+=4);break}r.push(n[o],n[o+1],n[o+2],n[o+3])}for(r.push(e,+t,+s,i);o<n.length;)r.push(n[o],n[o+1],n[o+2],n[o+3]),o+=4}}1!=u&&a.unshift(e>0?[0,0,0,l,e,t,s,i]:e<0?[e,t,s,i,0,0,0,l]:[e,t,s,i]),a.#h=null}insertLinePass(e,n,r,o){const i={0:t,1:s};for(let e=0;e<o.length;e++)i[e+2]=o[e];const c=this.#p,a=c.length;let f=0,h=0;for(;f<a;){let t=c[f++];if("number"==typeof t&&t>0)f++;else if("string"==typeof t||"function"==typeof t)h||(h=2);else if(Array.isArray(t)){h||(h=1);const s=c[f-1]=[];let o=0;for(;o<t.length;o+=4){if(!(t[o]<e)){t[o]==e&&(o+=4);break}s.push(t[o],t[o+1],t[o+2],t[o+3])}for(s.push(e,i,n,r);o<t.length;)s.push(t[o],t[o+1],t[o+2],t[o+3]),o+=4}}1!=h&&c.unshift(e>0?[0,0,0,l,e,i,n,r]:e<0?[e,i,n,r,0,0,0,l]:[e,i,n,r]),c.#h=null}adjustValues(e,t){const s=this.#p,n=s.length;let r=0,o=0;for(;r<n;){const n=s[r++];if("number"==typeof n&&n>0)r++;else if("string"==typeof n||"function"==typeof n)o||(o=2);else if(Array.isArray(n)){const o=s[r-1]=n.slice();n==s.#l&&(s.#l=o);let i=0;for(;i<o.length;i+=4)if(o[i]==e){let e=o[i+=3];"number"==typeof e&&(e=o[i-=2]),o[i]=e=Object.assign({},e);for(let s=t.length-1;s>=0;s--){const n=t[s];void 0!==n&&(e[s+2]=n)}break}}}s.#h=null}removePass(e){const t=this.#p,s=t.length;let n=0;e:for(;n<s;){let s=t[n++];if("number"==typeof s&&s>0)n++;else if(Array.isArray(s)){let t=0;for(;t<s.length;t+=4){if(s[t]>e)continue e;if(s[t]==e){for(t+=4;t<s.length;)s[t-4]=s[t],s[t-3]=s[t+1],s[t-2]=s[t+2],s[t-1]=s[t+3],t+=4;s.length-=4;break}}}}}get index(){return this.#A}set index(e){this.#A=!!e,this.#p.#h==this&&(this.#p.#h=null)}advance(e=0){const t=this.#p;t.#h!=this&&this.#x(t),t.push(1,+e),t.#f=NaN}#x(e){this.#b!=e.#e&&e.push(e.#e=this.#b),this.#y!=e.#t&&e.push(2,e.#t=this.#y),this.#g!=e.#s&&e.push(3,e.#s=this.#g),this.#w!=e.#n&&e.push(4,e.#n=this.#w),this.#_!=e.#r&&e.push(5,e.#r=this.#_),this.#k!=e.#o&&e.push(6,e.#o=this.#k),this.#d!=e.#i&&e.push(7,e.#i=this.#d),this.#m!=e.#c&&e.push(8,e.#c=this.#m),this.#v!=e.#l&&(e.push(this.#v),e.#l=this.#v),this.#A!=e.#u&&(e.push(this.#A),e.#u=this.#A),e.#h=this}copy(){const e=this.#p,t=e.slice(),s=t.#h=this.sub();return s.#p=t,t.#e=e.#e,t.#t=e.#t,t.#s=e.#s,t.#n=e.#n,t.#r=e.#r,t.#o=e.#o,t.#i=e.#i,t.#c=e.#c,t.#l=e.#l,t.#u=e.#u,t.#a=e.#a,t.#f=e.#f,s}slice(t=0,s=1/0){const n=this.#p,r=new h;t<0&&(t+=n.#a)<0&&(t=0),s<0&&(s+=n.#a)<0&&(s=0);const o=new e(r);let i=0;if(s<=0){for(;i<n.length;){const e=n[i++];if("number"==typeof e){const t=n[i++];switch(e){case 1:i-=2;break;case 2:o.#y=t;break;case 3:o.#g=t;break;case 4:o.#w=t;break;case 5:o.#_=t;break;case 6:o.#k=t;break;case 7:o.#d=t;break;case 8:o.#m=t}}else{if("string"==typeof e||"function"==typeof e)break;Array.isArray(e)?"boolean"==typeof e?o.#A=e:o.#v=e:o.#b=e}}return o.#x(r),o}s=s>=t?s-t:0;let c="";for(;t>0&&i<n.length;){const e=n[i++];if("number"==typeof e){const t=n[i++];switch(e){case 2:o.#y=t;break;case 3:o.#g=t;break;case 4:o.#w=t;break;case 5:o.#_=t;break;case 6:o.#k=t;break;case 7:o.#d=t;break;case 8:o.#m=t}}else if("string"==typeof e){if(!r.#u)continue;if((t-=e.length)<0){c=e.slice(t,(s+=t)+e.length);break}}else Array.isArray(e)?o.#v=e:"object"==typeof e?o.#b=e:"boolean"==typeof e&&(o.#A=e)}for(o.#x(r),c&&(r.push(c),r.#a+=c.length);s>0&&i<n.length;){const e=n[i++];if(r.push(e),"number"==typeof e){const t=n[i++];switch(r.push(t),e){case 2:o.#y=t;break;case 3:o.#g=t;break;case 4:o.#w=t;break;case 5:o.#_=t;break;case 6:o.#k=t;break;case 7:o.#d=t;break;case 8:o.#m=t}}else if("string"==typeof e){if(!r.#u)continue;s-=e.length,r.#a+=e.length,s<0?(r[r.length-1]=e.slice(0,s),r.#a+=e.length+s):r.#a+=e.length}else Array.isArray(e)?o.#v=e:"object"==typeof e?o.#b=e:"boolean"==typeof e&&(o.#A=e)}return o}trim(e=1/0){const t=this.#p;if(e<0&&(e+=t.#a)<0&&(e=0),e>t.#a)return;let s=0;if(t.#e=null,t.#t=n,t.#s=1,t.#r=1,t.#n=0,t.#o=0,t.#i=0,t.#u=!0,t.#c=0,t.#l=a,t.#a=e<0?0:e)for(;e>0&&s<t.length;){const n=t[s++];if("number"==typeof n){const e=t[s++];switch(n){case 2:t.#t=e;break;case 3:t.#s=e;break;case 4:t.#n=e;break;case 5:t.#r=e;break;case 6:t.#o=e;break;case 7:t.#i=e;break;case 8:t.#c=e}}else if("string"==typeof n){if(!t.#u)continue;if((e-=n.length)<0){t[s-1]=n.slice(0,e);break}}else Array.isArray(n)?t.#l=n:"object"==typeof n?t.#e=n:"boolean"==typeof n&&(t.#u=n)}else for(;s<t.length;){const e=t[s++];if("number"==typeof e){const n=t[s++];switch(e){case 1:s-=2;break;case 2:t.#t=n;break;case 3:t.#s=n;break;case 4:t.#n=n;break;case 5:t.#r=n;break;case 6:t.#o=n;break;case 7:t.#i=n;break;case 8:t.#c=n}}else{if("string"==typeof e||"function"==typeof e){s--;break}Array.isArray(e)?t.#l=e:"boolean"==typeof e?t.#u=e:t.#e=e}}this.#b=t.#e,this.#y=t.#t,this.#g=t.#s,this.#w=t.#n,this.#_=t.#r,this.#k=t.#o,this.#d=t.#i,this.#m=t.#c,this.#v=t.#l,t.length=s,t.#f=NaN}concat(e){const t=this.#p,s=e.#p;t.#a+=s.#a;let r=0;this.#b=null,this.#y=n,this.#g=1,this.#w=0,this.#_=1,this.#k=0,this.#d=0,this.#m=0,this.#v=a;const o=s.length;e:for(;r<o;){const e=s[r++];if("number"==typeof e){const t=s[r++];switch(e){case 1:r-=2;break e;case 2:this.#y=t;break;case 3:this.#g=t;break;case 4:this.#w=t;break;case 5:this.#_=t;break;case 6:this.#k=t;break;case 7:this.#d=t;break;case 8:this.#m=t}}else{if("string"==typeof e||"function"==typeof e){r--;break}Array.isArray(e)?this.#v=e:"boolean"==typeof e?this.#A=e:this.#b=e}}for(this.#x(t);r<o;){const e=s[r++];if(t.push(e),"number"==typeof e){const n=s[r++];switch(t.push(n),e){case 2:this.#y=n;break;case 3:this.#g=n;break;case 4:this.#w=n;break;case 5:this.#_=n;break;case 6:this.#k=n;break;case 7:this.#d=n;break;case 8:this.#m=n}}else"string"==typeof e?t.#u&&(t.#a+=e.length):Array.isArray(e)?this.#v=e:"boolean"==typeof e?this.#A=e:"object"==typeof e&&(this.#b=e)}t.#f=NaN}get length(){return this.#p.#a}set length(e){this.trim(e)}get width(){const e=this.#p;let t=e.#f;if(t==t)return t;t=0;let s=null,n=0,r=1,o=1,i=0,c=0,l=0,a=1,f=-1,h=1;for(;n<e.length;){let u=e[n++];if("number"==typeof u){const s=e[n++];switch(u){case 1:t+=a*s,f=-1;break;case 3:a=(r=s)*o,f=-1;break;case 5:a=(o=s)*r,f=-1;break;case 4:case 6:f=-1;break;case 7:i=s;break;case 8:l=1/s,c=s}}else if("string"==typeof u){if(s)for(const e of u){const n=e.codePointAt(),r=s.get(~n)??s._default;if(!r)continue;const o=(s.get(n+1114112*f)??0)*min(a,h);f=n,h=a;const u=(r._xadv+i)*a+o;t+=c&&asin(u*c)*l||u,r._tex?.waiting&&r._tex.load()}}else if("object"==typeof u){if(!u){s=null;continue}if(Array.isArray(u))continue;s=u,u.then?.(()=>e.#f=NaN)}}return e.#f=t}add(e){const t=this.#p;t.#h!=this&&this.#x(t),t.#u&&(t.#a+=(e+="").length),t.push(e),t.#f=NaN}addCb(e,t=NaN){if("function"!=typeof e)return;const s=this.#p;s.#h!=this&&this.#x(s),t==t?s.push(e,1,t):s.push(e)}indexAt(e=0,t=.5){t--;const s=this.#p;let n=null,r=0,o=1,i=1,c=0,l=!0,a=0,f=0,h=1,u=-1,p=1,b=0,y=0;for(;r<s.length;){let g=s[r++];if("number"==typeof g){const t=s[r++];switch(g){case 1:e-=h*t,u=-1;break;case 3:h=(o=t)*i,u=-1;break;case 5:h=(i=t)*o,u=-1;break;case 4:case 6:u=-1;break;case 7:c=t;break;case 8:f=1/t,a=t}}else if("string"==typeof g)if(n)for(const s of g){const r=s.codePointAt(),o=n.get(~r)??n._default;if(!o){l&&(y=b+=s.length);continue}const i=(n.get(r+1114112*u)??0)*min(h,p);u=r,p=h;const g=(o._xadv+c)*h+i,_=a&&asin(g*a)*f||g;if(e-=_,l){if(e<=_*t)return y;y=b+=s.length}}else l&&(b+=g.length);else if("object"==typeof g){if(!g){n=null;continue}if(Array.isArray(g))continue;n=g}else"boolean"==typeof g&&(l=g)}return y}draw(e){const t=this.#p;let s=null,r=0,o=1,i=1,l=1,f=0,h=0,u=0,p=0,b=0,y=e.shader=n,g=a,_=3,k=null,d=0,m=-1,v=1;const A=2*e.pixelRatio();let w=1,x=1,q=1,N=0;e:for(;r<t.length;){let n=t[r++];if("number"==typeof n){const s=t[r++];switch(n){case 1:if(b){h&&e.skew(-h,0);const t=.5/b,n=s*b*2;e.rotate(N),e.translate(sin(n)*t,(1-cos(n))*t),e.rotate(-n),N=0,h&&e.skew(h,0)}else e.translate(s,0);m=-1;continue e;case 3:const t=s*i;i=1/s,e.scale(t),u*=o*=i,p*=o,v*=t,b*=t,o=s,k&&(w=A*o*k.rangeFactor),m=-1;continue e;case 4:u=s*i,p=u*h,m=-1;continue e;case 2:e.shader=y=s;break;case 5:l=s,m=-1;continue e;case 6:e.skew(s-h,0),h=s,p=u*s,m=-1;continue e;case 7:f=.5*s;continue e;case 8:b=s*o;continue e;default:continue e}}else{if("string"==typeof n){if(s)for(const t of n){const n=t.codePointAt(),r=s.get(~n)??s._default;if(!r)continue;const o=(s.get(n+1114112*m)??0)*min(v,l);m=n,v=l;const i=(r._xadv+f+f)*l+o,a=o-p;b&&(h&&e.skew(-h,0),e.rotate(N+(N=-asin(i*b)||0)),h&&e.skew(h,0));for(let t=0;t<_;t+=4){const s=g[t+1],n=g[t+2]+u,o=g[t+3];if("object"==typeof s){const t=b*i*(n+d);e.drawRectv(a+t,n+d,i-t-t,o,s)}else if(r._tex){o[0]=r._tex,c.x=o.off*q;const{spr:t}=o;c.y=t<0?w:t*x,e.drawRectv((r.x+f)*l+s+a,r.y+n,r.w*l,r.h,o)}}e.translate(i,0)}continue}if("function"==typeof n){const t=e.sub();N&&(t.skew(-h,0),t.rotate(N),t.skew(h,0)),n(t,k)}else if("object"==typeof n){if(!n){s=null;continue}if(Array.isArray(n)){_=(g=n).length;continue}k=n,d=k.ascend-1,s=n,w=A*o*(x=k.rangeFactor),q=1/x}}}h&&e.skew(-h,0),N&&e.rotate(N),1!=o&&e.scale(i)}break(t=1/0,s=o,n={scale:1,letterSpacing:0,curve:0}){const r=this.#p;let c=!0,l="",a=0;for(;a<r.length;){const e=r[a++];"number"!=typeof e?"boolean"==typeof e?c=e:"string"==typeof e&&c&&(l+=e):a++}const u=[];let p="number"==typeof t?t:"function"==typeof t?t(u.length,n):t[min(u.length,t.length-1)],b=new h,y=b.#h=new e(b),g=0,_="";a=0;let k=null,d=1,m=1,v=-1,A=0,w=!1;for(;a<l.length;){let o=0,c=i,x=b.length,q=A,N=y.#y,R=y.#g,P=y.#w,S=y.#_,F=y.#k,B=y.#d,L=y.#b,E=y.#m,j=y.#v,O=b.#u,W=b.#a;e:do{if(s)for(c of s)if(c.lastIndex=a,c.test(l)){if(o){c=i;break e}o=c.lastIndex-a,a=c.lastIndex,s=c.next??s;break e}++o}while(++a<l.length);const T=c.type;16&T&&(u.push(y),b.#f=w?NaN:A,w=!1,y=y.sub(),y.#p=b=new h,p="number"==typeof t?t:"function"==typeof t?t(u.length,n):t[min(u.length,t.length-1)],x=q=A=W=0,O||b.push(b.#u=!1),y.#x(b));const I=!!(32&T)&&!!b.#e;if(_){let e=_;o<_.length?(e=_.slice(0,o),_=_.slice(o),o=0):(o-=_.length,_=""),I&&b.push(null),e&&b.push(e),b.#u&&(b.#a+=e.length),I&&b.push(b.#e)}for(;o>0;){const e=r[g++];if(r.length,"number"==typeof e){const t=r[g++];switch(b.push(e,t),e){case 2:y.#y=b.#t=t;break;case 3:y.#g=b.#s=t;break;case 4:y.#w=b.#n=t;break;case 5:y.#_=b.#r=t;break;case 6:y.#k=b.#o=t;break;case 7:y.#d=b.#i=t;break;case 8:y.#m=b.#c=t}}else if("string"==typeof e){if(!b.#e){b.push(e),b.#u&&(b.#a+=e.length);continue}o-=e.length;let t=e;o<0?(t=e.slice(0,o),_=e.slice(o)):_="",I&&b.push(null),b.push(t),b.#u&&(b.#a+=t.length),I&&b.push(b.#e)}else"boolean"==typeof e?b.push(b.#u=e):(b.push(e),Array.isArray(e)?b.#l=y.#v=e:"function"!=typeof e&&(b.#e=y.#b=e))}for(;;){let s=x,r=0,o=0,i=N,l=R,a=P,g=S,_=F,I=B,V=L,C=j,H=O,G=W,K=E,M=1/K,U=!1,$=c.sepL==V&&c.sepA==K&&c.sepS==I?c.sepW:f(c,V,K,I);const z=T?!!(36>>T&1):2*q<p,{scale:D=1,letterSpacing:Q=0,curve:Y=0}=n;w||=1!=D||0!=Q||0!=Y;let J=K+Y,X=I+Q;for(Y&&(M=1/J);s<b.length;){const e=b[s++];if("number"==typeof e){const t=b[s++];switch(e){case 1:if(A+=t,v=-1,A>p-($-(k?.get(c.sep.codePointAt()+1114112*v)??0))*d||!z)break;x=s-2,o=0,U=!0,q=A,N=i,R=l,P=a,S=g,F=_,B=I,L=V,E=K,j=C,O=H,W=G;break;case 2:i=t;break;case 3:l=t,d=t*g*D;break;case 4:a=t;break;case 5:g=t,d=t*l*D;break;case 6:_=t;break;case 7:I=t,X=t+Q;break;case 8:J=t+Y,M=1/J,K=t}}else if("string"==typeof e)if(r=0,k)for(const t of e){const e=t.codePointAt(),n=k.get(~e)??k._default;if(r+=t.length,H&&(G+=t.length),!n)continue;const f=(k.get(e+1114112*v)??0)*min(d,m);m=d,v=e;const h=(n._xadv+X)*d+f;A+=J&&asin(h*J)*M||h,A<=p-($-(k.get(c.sep.codePointAt()+1114112*e)??0))*d&&z&&(U=!0,x=s-1,o=r,q=A,N=i,R=l,P=a,S=g,F=_,B=I,L=V,E=K,j=C,O=H,W=G)}else H&&(G+=e.length);else if(Array.isArray(e))C=e;else if("boolean"==typeof e)H=e;else{if("function"==typeof e)continue;(V=e)?(k=e,$=c.sepL==e&&c.sepA==K&&c.sepS==I?c.sepW:f(c,e,K,I)):(k=null,$=0)}}if(!q||A<=p||!x||3==T)break;if(s=x,r=o,i=N,l=R,a=P,g=S,_=F,I=B,V=L,C=j,H=O,K=E,G=W,6==T||7==T&&p-q>=A-p){const e=(p-q)/(A-q),t=b.length;for(b.splice(s,0,5,e*g),s+=2;s<t;){const t=b[s++];"number"==typeof t&&(5==t&&(b[s]*=e),s++)}b.push(5,g);break}A=q;const Z=new h,ee=new e(Z),te=b.length;ee.#y=i,ee.#g=l,ee.#w=a,ee.#_=g,ee.#k=_,ee.#d=I,ee.#v=C,ee.#m=K,ee.#A=H;let se=s+=!!r,ne=V;const re=4!=T&&5!=T;if(r){ee.#b=ne,ee.#x(Z);const e=b[s-1];b[s-1]=e.slice(0,r),Z.push(e.slice(r)),re?ne=null:Z.push(ee.#b=Z.#e=null)}else{e:for(;se<te;){const e=b[se++];if("number"==typeof e){const t=b[se++];switch(e){case 1:if(re){se-=2;break e}break;case 2:ee.#y=t;break;case 3:ee.#g=t;break;case 4:ee.#w=t;break;case 5:ee.#_=t;break;case 6:ee.#k=t;break;case 7:ee.#d=t;break;case 8:ee.#m=t}}else{if("string"==typeof e||"function"==typeof e){se--;break}"boolean"==typeof e?ee.#A=e:Array.isArray(e)?ee.#v=e:ne=e}}ee.#x(Z)}if(re)for(ne&&Z.push(ee.#b=Z.#e=ne);se<te;)Z.push(b[se++]);else for(;se<te;){const e=b[se++];"number"==typeof e?Z.push(e,b[se++]):("object"!=typeof e||Array.isArray(e))&&Z.push(e)}Z.#a=b.#a-G,b.#a=G,b.#f=w?NaN:A,w=!1,ee.#y=Z.#t=y.#y,ee.#g=Z.#s=y.#g,ee.#w=Z.#n=y.#w,ee.#_=Z.#r=y.#_,ee.#k=Z.#o=y.#k,ee.#d=Z.#i=y.#d,ee.#m=Z.#c=y.#m,ee.#A=Z.#u=y.#A,ee.#v=Z.#l=y.#v,b.length=s,!re&&ne&&Z.push(ee.#b=Z.#e=ne),U&&(b.#u&&b.push(b.#u=!1),b.push(c.sep)),u.push(y),y=ee,b=Z,p="number"==typeof t?t:"function"==typeof t?t(u.length,n):t[min(u.length,t.length-1)],x=o=q=A=W=0}8&T&&(u.push(y),b.#f=w?NaN:A,w=!1,A=0,y=y.sub(),y.#p=b=new h,p="number"==typeof t?t:"function"==typeof t?t(u.length,n):t[min(u.length,t.length-1)],y.#x(b))}for(;g<r.length;){const e=r[g++];if(b.push(e),"number"==typeof e){const t=r[g++];switch(b.push(t),e){case 2:y.#y=b.#t=t;break;case 3:y.#g=b.#s=t;break;case 4:y.#w=b.#n=t;break;case 5:y.#_=b.#r=t;break;case 6:y.#k=b.#o=t;break;case 7:y.#d=b.#i=t;break;case 8:y.#m=b.#c=t}}else Array.isArray(e)?y.#v=b.#l=e:"object"==typeof e?y.#b=b.#e=e:"boolean"==typeof e&&(y.#A=b.#u=e)}return b.#f=w?NaN:A,u.push(y),u}toString(){let e="",t=!0,s=0;const n=this.#p,r=n.length;for(;s<r;){const r=n[s++];"number"!=typeof r?"boolean"==typeof r?t=r:"string"==typeof r&&t&&(e+=r):s++}return e}static ctor=(t=null)=>{const s=new h;if(!t)return s.#h=new e(s);const n=new e(s);return n.#b=t,n}}}e.RichText=h.public.ctor;const u=Texture(4,6,1,0,Formats.RGBA4).pasteData(Uint8Array.fromHex("ffff ffff ffff ffffffff 0000 0000 ffffffff 0000 0000 ffffffff 0000 0000 ffffffff 0000 0000 ffffffff ffff ffff ffff"));class p extends Map{rangeFactor=0;ascend=0;#q=[];_default={x:.05,y:-.0625,w:.5,h:.75,_xadv:.6,_tex:u};get then(){return this.#q?this.#N:void 0}#N(e,t){this.#q?.push(e,t)}done(){const e=this.#q;if(this.#q=null,e)for(let t=0;t<e.length;t+=2)e[t]?.(this)}error(e){const t=this.#q;if(this.#q=null,t)for(let s=1;s<t.length;s+=2)t[s]?.(e)}set(e=-1,t=0,s=null,n=0,r=0,o=0,i=0){if("string"==typeof e&&(e=e.codePointAt()),e<0){const e=this._default;s||t?(e.x=+n,e.y=+r,e.w=+o,e.h=+i,e._xadv=+t,e._tex=s):(e.x=e.y=e.w=e.h=e._xadv=0,e._tex=null)}else{if(!s&&!t)return super.delete(~e);super.set(~e,{x:+n,y:+r,w:+o,h:+i,_xadv:+t,_tex:s})}}getAdvance(e=-1){return"string"==typeof e&&(e=e.codePointAt()),(e<0?this._default:this.get(~e)??this._default)._xadv}setKerning(e,t,s=0){let n=0;if("string"==typeof e){const r=e.codePointAt();n=1114112*r,"number"==typeof t?(s=t,n+=e.codePointAt(1+(r>65535))):n+=t.codePointAt()}else n=1114112*e+t;s?super.set(n,s):super.delete(n)}getKerning(e,t){let s=0;if("string"==typeof e){const n=e.codePointAt();s=1114112*n,s+="string"==typeof t?t.codePointAt():void 0!==t?16777215&t:e.codePointAt(1+(n>65535))}else s=1114112*(16777215&e)+(16777215&t);return this.get(s)??0}chlumsky(t,s="atlas.png"){return t.endsWith("/")&&(t+="index.json"),fetch(t).then(e=>(t=e.url,e.json())).then(n=>{const{atlas:{type:r,distanceRange:o,size:i,width:c,height:l},metrics:{ascender:a,descender:f},glyphs:h,kerning:u}=n;this.rangeFactor=o/i;const p=e.Texture.from(new URL(s,t).href,e.SMOOTH,r.toLowerCase().endsWith("msdf")?e.Formats.RGB:e.Formats.RGBA4);this.ascend=a/(a-f);for(const{unicode1:e,unicode2:t,advance:s}of u)super.set(t+1114112*e,s);for(const{unicode:e,advance:t,planeBounds:s,atlasBounds:n}of h)super.set(~e,s?{x:+s.left,y:+s.bottom,w:s.right-s.left,h:s.top-s.bottom,_xadv:t,_tex:p.sub(n.left/c,n.bottom/l,(n.right-n.left)/c,(n.top-n.bottom)/l)}:{x:0,y:0,w:0,h:0,_xadv:t,_tex:null});this.done()},this.error.bind(this)),this}bmfont(t,s=0){return fetch(t).then(e=>(t=e.url,e.json())).then(n=>{const{chars:r,distanceField:o,pages:i,common:{base:c,lineHeight:l,scaleW:a,scaleH:f},kernings:h}=n,u=1/n.info.size;this.rangeFactor=o.distanceRange/l;const p=this.ascend=c/l,b=i.map(s=>e.Texture.from(new URL(s,t).href,e.SMOOTH,o.fieldType.toLowerCase().endsWith("msdf")?e.Formats.RGB:e.Formats.RGBA4));for(const{first:e,second:t,amount:s}of h)super.set(t+1114112*e,s/u);for(const{id:e,x:t,y:n,width:o,height:i,xoffset:c,yoffset:l,xadvance:h,page:y}of r)super.set(e,{x:c*u,y:p-(l-s+i)*u,w:o*u,h:i*u,_xadv:h*u,_tex:o&&i?b[y].sub(t/a,1-(n+i)/f,o/a,i/f):null});this.done()},this.error.bind(this)),this}draw(e,t,s=[],n=0,r=-1,o=0,i=-1){if(!this.#q){o*=.5,n/=this.rangeFactor,r=r<0?2*e.pixelRatio()*this.rangeFactor:.5*this.rangeFactor/r;for(const l of t){const t=l.codePointAt(),a=this.get(~t)??this._default;if(!a)continue;const f=this.get(t+1114112*i)??0;i=t;const h=a._xadv+o+o+f;a._tex&&(c.x=n,c.y=r,e.drawRect(a.x+o+f,a.y,a.w,a.h,a._tex,c,...s)),e.translate(h,0)}return i}}measure(e,t=0,s=-1){if(this.#q)return;let n=0;for(const r of e){const e=r.codePointAt(),o=this.get(e)??this._default;if(!o)continue;const i=this.get(e+1114112*s)??0;s=e,n+=o._xadv+t+i}return n}}e.Font=()=>new p,e.Font.bmfont=(e,t)=>(new p).bmfont(e,t),e.Font.chlumsky=(e,t)=>(new p).chlumsky(e,t)};