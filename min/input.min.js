globalThis.BitField??=class t extends Array{constructor(t){if(super(),Array.isArray(t))for(let e=0;e<t.length;e++)this.push(t[e]);else if(t instanceof Uint8Array)for(let e=0;e<t.length;e+=4)this.push(t[e]|t[1|e]<<8|t[2|e]<<16|t[3|e]<<24);else if(t)for(const e of t)this.set(e)}static parse(e){return Array.isArray(e)?Object.setPrototypeOf(e,t.prototype):new t}static decode(e,s=new t){s.length=0;let i=e.v32();for(;i--;)s.push(e.i32())}static encode(t,e){const s=e.length;t.v32(s);for(let e=0;e<s;e++)t.i32(this[e])}static of(...e){const s=new t;for(const t of e)s.set(t);return s}set(t=0){const e=t>>>5;for(;e>=this.length;)this.push(0);this[e]|=1<<(31&t)}unset(t=0){let e=this.length;const s=t>>>5;if(!(s>=e))for(this[s]&=~(1<<(31&t));e&&!this[--e];)super.pop()}setRange(t=0,e=0){if(t>e)return;let s=t>>>5,i=e>>>5,n=e+31>>>5;for(;n>=this.length;)this.push(0);if(s!=i){for(this[s]|=-1<<(31&t);++s<i;)this[s]=-1;(n=31&e)&&(this[i]|=~(-1<<n))}else this[s]|=-1<<(31&t)&~(-1<<(31&e))}unsetRange(t=0,e){if(void 0===e){let e=t+31>>>5;for(;e>0&&!this[e-1];)e--;return this.length=e,void(e&&31&t&&(this[e-1]&=~(-1<<(31&t))))}if(t>e)return;let s=t>>>5,i=e>>>5;if(s>=this.length)return;if(s==i)return void(this[s]&=~(-1<<(31&t))|-1<<(31&e));let n=this.length;for(i<n&&(this[i]&=-1<<(31&e),n=i),this[s]&=~(-1<<(31&t));++s<n;)this[s]=0;if(n==this.length)for(;n&&!this[--n];)super.pop()}anyIn(t=0,e){let s=t>>>5;if(s>=this.length)return!1;if(void 0===e){if(31&t){if(this[s]&-1<<(31&t))return!0;s++}for(;s<this.length;)if(this[s++])return!0;return!1}let i=e>>>5;if(s==i)return!!(this[s]&-1<<(31&t)&~(-1<<(31&e)));if(31&t){if(this[s]&-1<<(31&t))return!0;s++}let n=this.length;if(i<n){if(this[i]&~(-1<<(31&e)))return!0;n=i}for(;++s<n;)if(this[s])return!0;return!1}allIn(t=0,e=0){let s=t>>>5;if(s>=this.length)return!1;let i=e>>>5;if(s==i)return-1==(this[s]|~(-1<<(31&t))|-1<<(31&e));if(31&t){if(~this[s]&-1<<(31&t))return!1;s++}let n=this.length;if(i<n){if(~(this[i]|-1<<(31&e)))return!1;n=i}for(;s<n;)if(~this[s++])return!1;return!0}toggle(t=0){let e=this.length;const s=t>>>5;for(;s>=e;)this.push(0),e++;for(this[s]^=1<<(31&t);e&&!this[--e];)super.pop()}has(t=0){const e=t>>>5;return!(e>=this.length)&&!!(this[e]&1<<(31&t))}pop(t=0){let e=t>>>5;if(e>=this.length)return!1;let s=this[e];if(s^=this[e]=s&~(1<<(31&t)),e==this.length-1)for(;e>=0&&!this[e--];)super.pop();return!!s}put(t=0){let e=t>>>5;for(;e>=this.length;)this.push(0);return!!(this[e]^(this[e]|=1<<(31&t)))}xor(t){let e=this.length;if(e==t.length)for(;e&&this[--e]==t[e];)super.pop();else{let s=e;for(e--;s<t.length;)this.push(t[s++])}for(let s=e;s>=0;s--)this[s]^=t[s]}and(t){let e=this.length;for(this.length>t.length&&(e=this.length=t.length);e&&!(this[--e]&t[e]);)super.pop();for(;e>0;)this[--e]&=t[e]}or(t){let e=this.length-1,s=e;for(;++s<t.length;)this.push(t[s]);for(let s=e;s>=0;s--)this[s]|=t[s]}firstUnset(){let t=-1;for(;++t<this.length;){const e=~this[t];if(e)return t<<5|31-clz32(e&-e)}return t<<5}firstSet(){let t=-1;for(;++t<this.length;)if(this[t])return t<<5|31-clz32(this[t]&-this[t]);return-1}lastSet(){let t=this.length;for(;--t>=0;)if(this[t])return t<<5|31-clz32(this[t]);return-1}popFirst(){let t=-1;for(;++t<this.length;)if(this[t]){let e=31-clz32(this[t]&-this[t]);for(this[t]&=~(1<<e),e|=t<<5,t=this.length;t&&!this[--t];)super.pop();return e}return-1}putFirst(){let t=-1;for(;++t<this.length;){const e=~this[t];if(!e)continue;const s=31-clz32(e&-e);return this[t]|=1<<s,t<<5|s}return this.push(1),t<<5}popLast(){let t=this.length;for(;--t>=0;)if(this[t]){let e=31-Math.clz32(this[t]);for(this[t]&=~(1<<e),e|=t<<5,t=this.length;t&&!this[--t];)super.pop();return e}return-1}clear(){this.length=0}[Symbol.iterator](){const t={value:0,done:!1};let e=0,s=-1;return{[Symbol.iterator](){return this},next:()=>{for(;e<this.length;e++,s=-1){const i=this[e]&s,n=31-clz32(i&-i);if(!(n<0))return s=-2<<n,t.value=e<<5|n,t}return e=1/0,t.done=!0,t}}}iter(t,e=0){let s=-1<<(31&e);for(let i=e>>>5;i<this.length;i++){for(;;){const e=this[i]&s,n=31-clz32(e&-e);if(n<0)break;s=-2<<n,t(i<<5|n)}s=-1}}toUint8Array(){let t=this.length-1,e=this[t],s=0;const i=new Uint8Array(t=(t<<2)+(39-clz32(e)>>3));for(;s<t;s+=4){const t=this[s>>2];i[s]=t,i[1|s]=t>>8,i[2|s]=i>>16,i[3|s]=i>>24}for(s-=4;s<t;)i[s++]=e,e>>=8;return i}};{const t=function(t=1,e=1,s=1,i=1,n=1){this.playEffect?.("dual-rumble",{duration:1e3*n,strongMagnitude:.5*(e+i),weakMagnitude:.5*(t+s)})??this.pulse?.(.25*(t+e+s+i),1e3*n)};function pollGamepads(){e=!1;const s=new Set;let i=document.activeElement?._ictx;if(i instanceof a)for(const t of i._pointers)t<0&&s.add(~t);else i=null;const n=navigator.getGamepads();let r=[];for(const t of n)"standard"==t?.mapping&&r.push(t);const o=r.length;for(const l of r.length?r:n){if(!l)continue;const n=new c,r=l.vibrationActuator??l.hapticActuators?.[0];n.vibrate=r?t.bind(r):null;for(let t=0;t<l.buttons.length;t++)l.buttons[t].pressed&&n.set(t);for(let t=0;t<l.axes.length;t+=2)n._axes.push({x:l.axes[t],y:o?-l.axes[t+1]:l.axes[t+1]});i&&(i.setGamepad(l.index,n),s.delete(l.index)),e=!0}if(i)for(const t of s)i.setGamepad(t,0);e&&requestAnimationFrame(pollGamepads)}let e=!0;requestAnimationFrame(pollGamepads),window.addEventListener("gamepadconnected",()=>{e||(requestAnimationFrame(pollGamepads),e=!0)});const s={__proto__:null,ContextMenu:93,Help:26,Semicolon:186,Quote:222,BracketLeft:219,BracketRight:221,Backquote:192,Backslash:220,Minus:189,EQUAL:187,IntlRo:193,IntlYen:255,MetaLeft:91,MetaRight:91,PrintScreen:44,ScrollLock:145,Pause:19,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,F20:131,F21:132,F22:133,F23:134,F24:135,NumLock:144,Clear:10,NumpadComma:110,NumpadDecimal:110,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105},i=Object.freeze({LEFT:0,RIGHT:2,MIDDLE:1,BACK:3,FORWARD:4}),n=Object.freeze({A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,can:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUM_0:48,NUM_1:49,NUM_2:50,NUM_3:51,NUM_4:52,NUM_5:53,NUM_6:54,NUM_7:55,NUM_8:56,NUM_9:57,SPACE:32,BACKTICK:192,TAB:9,BACK:8,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,META:91,METARIGHT:93,CAPSLOCK:20,UP:38,RIGHT:39,DOWN:40,LEFT:37,MOD:navigator.platform.startsWith("Mac")?91:17,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,MINUS:189,EQUAL:187,BR_LEFT:219,BR_RIGHT:221,SEMICOLON:186,APOS:222,BACKSLASH:220,COMMA:188,DOT:190,SLASH:191,PAUSE:19,PAD_ENTER:12,CLEAR:10,HOME:36,END:35,PAGE_UP:33,PAGE_DOWN:34,INS:45,DEL:46,CTX_MENU:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,PAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,PAD_DIV:111,PAD_MULT:106,PAD_SUB:109,PAD_ADD:107,PAD_DOT:110,NUM_LOCK:144,SCROLL_LOCK:145,HELP:26,RO:193,YEN:255,SYSRQ:44,PRINT_SCREEN:44}),r=Object.freeze({A:0,B:1,X:2,Y:3,LB:4,RB:5,LT:6,RT:7,UP:12,DOWN:13,LEFT:14,RIGHT:15,MENU:16,LEFT_STICK:0,RIGHT_STICK:1,SELECT:8,START:9}),o=Object.freeze({MOUSE_BUTTONS:1,MOUSE_WHEEL:2,MOUSE_POINTER:4,OTHER_POINTERS:8,KEYBOARD:16,GAMEPADS:32,MOUSE:7,ALL_POINTERS:12,ALL:-1});class l{static DEFAULT=0;static HIDDEN=1;constructor(t=null){t?(this.x=+t.x,this.y=+t.y,this.tiltX=+t.tiltX,this.tiltY=+t.tiltY,this.pressure=+t.pressure,this.twist=+t.twist,this.buttons=0|t.buttons,this.setHint=t.setHint):(this.x=0,this.y=0,this.tiltX=0,this.tiltY=0,this.pressure=0,this.twist=0,this.buttons=0,this.setHint=null)}update(t){this.x=+t.x,this.y=+t.y,this.buttons=0|t.buttons,this.tiltX=+t.tiltX,this.tiltY=+t.tiltY,this.pressure=+t.pressure,this.twist=+t.twist,this.setHint=t.setHint}has(t){return!!(this.buttons>>t&1)}anyIn(t=0,e){return!!(this.buttons>>t&("number"==typeof e?~(-1<<e-t):-1))}allIn(t=0,e=0){return-1==(this.buttons>>t|-1<<e-t)}firstUnset(){const t=~this.buttons;return 31-clz32(t&-t)}firstSet(){const t=this.buttons;return 31-clz32(t&-t)}lastSet(){return 31-clz32(this.buttons)}[Symbol.iterator](){const t={value:-1,done:!1};return{[Symbol.iterator](){return this},next:()=>{if(t.done)return t;const e=this.buttons&-1<<t.value+1,s=31-clz32(e&-e);return s>=0?(t.value=s,t):(t.value=-1,t.done=!0,t)}}}iter(t,e=0){for(;;){const s=this.buttons&-1<<e,i=31-clz32(s&-s);if(i<0)break;e=i+1,t(i)}}get pressed(){return!!(1&this.buttons)}}const h=["","none","context-menu","help","pointer","progress","wait","cell","crosshair","text","vertical-text","alias","copy","move","no-drop","not-allowed","grab","grabbing","e-resize","n-resize","ne-resize","nw-resize","s-resize","se-resize","sw-resize","w-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","col-resize","row-resize","all-scroll","zoom-in","zoom-out"];for(let u=2;u<h.length;u++)l[h[u].toUpperCase().replace("-","_")]=u;class c extends BitField{_subscribed=[];constructor(t=null){super(t),t?(this._axes=t._axes.slice(),this.vibrate=t.vibrate):(this._axes=[],this.vibrate=null)}update(t){const e=min(this.length,t.length);for(let s=0;s<e;s++){let e=t[s],i=e^this[s];for(this[s]=e;i;){const t=31-clz32(i&-i);for(const i of this._subscribed)i._fireGamepadButtonUpdate(s<<5|t,!!(e>>t&1));i&=-2<<t}}if(e<t.length)for(let s=e;s<t.length;s++){let e=t[s];for(this.push(e);e;){const t=31-clz32(e&-e);for(const e of this._subscribed)e._fireGamepadButtonUpdate(s<<5|t,!0);e&=-2<<t}}else if(e<this.length){for(let t=e;t<this.length;t++){let e=this[t];for(;e;){const s=31-clz32(e&-e);for(const e of this._subscribed)e._fireGamepadButtonUpdate(t<<5|s,!1);e&=-2<<s}}this.length=e}const s=t._axes,i=this._axes,n=min(s.length,i.length);for(let t=0;t<n;t++){const e=s[t],n=i[t];if(e.x!==n.x||e.y!==n.y){n.x=e.x,n.y=e.y;for(const s of this._subscribed)s._fireGamepadAxisUpdate(t,e.x,e.y)}}if(n<s.length)for(let t=n;t<s.length;t++){const e=s[t];if(i.push(e),0!==e.x||0!==e.y)for(const s of this._subscribed)s._fireGamepadAxisUpdate(t,e.x,e.y)}else if(n<i.length){for(let t=n;t<i.length;t++){const e=i[t];if(0!==e.x||0!==e.y)for(const e of this._subscribed)e._fireGamepadAxisUpdate(t,0,0)}i.length=n}this.vibrate=t.vibrate}axis(t){return this._axes[65535&t]??null}}class a extends BitField{next=null;wheel={x:0,y:0};mouse={x:0,y:0};cursor=null;gamepad=null;_pointers=new Map;pointer(t){return(t|=0)>=0?this._pointers.get(t)??null:null}iterPointers(t){for(const{0:e,1:s}of this._pointers)e>=0&&t(e,s)}gamepad(t){return(t=~t)<0?this._pointers.get(t)??null:null}iterGamepads(t){for(const{0:e,1:s}of this._pointers)e<0&&t(~e,s)}_wcbs=[];_mcbs=[];_rpcbs=[];_rgcbs=[];_rkcbs=[];_npcbs=[];_ngcbs=[];_dpcbs=[];_dgcbs=[];_kcbs=new Map;reset(t=-1){const e=17&t;if(e)if(17==e)this._kcbs.clear();else for(const e of this._kcbs.keys())e>7^t>>3&1&&this._kcbs.delete(e);2&t&&(this._wcbs.length=0),4&t&&(this._mcbs.length=0),8&t&&(this._npcbs.length=this._dpcbs.length=this._rpcbs.length=0),32&t&&(this._ngcbs.length=this._dgcbs.length=this._rgcbs.length=0)}clear(t=-1){this.reset(t);const e=17&t;17==e?this.clear():e&&(1&t&&this.unsetRange(0,7),16&t&&this.unsetRange(8)),2&t&&(this.wheel.x=this.wheel.y=0),4&t&&(this.mouse.x=this.mouse.y=0);let s=40&t;if(40==s)this._pointers.clear();else if(s){s=-(32==s);for(const t of this._pointers.keys())t>>31==s&&this._pointers.delete(t)}}onWheel(t){this._wcbs.push(t)}onMouseMove(t){this._mcbs.push(t)}onPointerUpdate(t){this._rpcbs.push(t)}onGamepadUpdate(t){this._rgcbs.push(t)}onNewPointer(t){this._npcbs.push(t)}onDelPointer(t){this._dpcbs.push(t)}onNewGamepad(t){this._ngcbs.push(t)}onDelGamepad(t){this._dgcbs.push(t)}onKey(t,e){if(Array.isArray(t)){for(const s of t)this.onKey(s,e);return}const s=this._kcbs.get(t&=65535);s?s.push(e):this._kcbs.set(t,[e])}onGamepadButton(t,e){if(Array.isArray(t)){for(const s of t)this.onGamepadButton(s,e);return}const s=this._kcbs.get(t=~(65535&t));s?s.push(e):this._kcbs.set(t,[e])}onGamepadAxis(t,e){if(Array.isArray(t)){for(const s of t)this.onGamepadButton(s,e);return}const s=this._kcbs.get(t=~(65535&t|65536));s?s.push(e):this._kcbs.set(t,[e])}onKeyPress(t,e,s=!1){let i=!1;this.onKey(t,(t,n)=>(i==s&(i=t)===!s&&e(n),s))}onGamepadButtonPress(t,e,s=!1){let i=!1;this.onGamepadButton(t,(t,n)=>(i==s&(i=t)===!s&&e(n),s))}onKeyUpdate(t){this._rkcbs.push(t)}setKey(t,e=!1,s=!1){t&=65535;let i=this;for(;i;){if(e?i.put(t):i.pop(t)){const s=i._kcbs.get(t);if(s)for(const n of s)try{const s=n(e,t,i);"boolean"==typeof s&&(e=s)}catch(t){Promise.reject(t)}}else if(!s){i=i.next;continue}for(const s of i._rkcbs)try{const n=s(t,e,i);"boolean"==typeof n&&(e=n)}catch(t){Promise.reject(t)}i=i.next}return e}refireKey(t){this.setKey(t,this.has(t),!0)}_fireGamepadButtonUpdate(t=0,e=!1){const s=this._kcbs.get(~t);if(s)for(const i of s)try{const s=i(e,t,this);"boolean"==typeof s&&(e=s)}catch(t){Promise.reject(t)}}_fireGamepadAxisUpdate(t=0,e=0,s=0){const i=this._kcbs.get(~(65536|t));if(i)for(const t of i)try{const i=t(e,s,this);"object"==typeof i&&(i?(e=+i.x,s=+i.y):e=s=0)}catch(t){Promise.reject(t)}}setPointer(t,e=null,s=!1){if((t|=0)<0)return;let i=this;for(;i;){let n=i._pointers.get(t)??null;if(n)if(e)n.update(e);else{i._pointers.delete(t),t||(i.cursor=null);for(const s of i._dpcbs)try{const r=s(t,e,n,i);"object"==typeof r&&(e=r)}catch(t){Promise.reject(t)}}else if(e){n=new l(e),t||(i.cursor=n),i._pointers.set(t,n);for(const s of i._npcbs)try{const n=s(t,e,null,i);"object"==typeof n&&(e=n)}catch(t){Promise.reject(t)}}else if(!s){i=i.next;continue}for(const s of i._rpcbs)try{const n=s(t,e,i);"object"==typeof n&&(e=n)}catch(t){Promise.reject(t)}i=i.next}return e}#t(t){this.gamepad=t,t.iter(t=>this._fireGamepadButtonUpdate(t,!0));const e=t._axes;for(let t=0;t<e.length;t++){const s=e[t];0!==s.x&&0!==s.y&&this._fireGamepadAxisUpdate(t,s.x,s.y)}t._subscribed.push(this)}refirePointer(t){this.setPointer(t,this._pointers.get(t)??null,!0)}setGamepad(t,e=null,s=!1){if((t=~t)>=0)return;let i=this;for(;i;){let n=i._pointers.get(t)??null;if(n)if(e)n.update(e);else{if(i._pointers.delete(t),n==this.gamepad){this.gamepad=null;const t=n._subscribed;let e=t.indexOf(this);if(e>=0){for(;e<t.length;)t[e]=t[++e];t.pop()}n.iter(t=>this._fireGamepadButtonUpdate(t,!1));const s=n._axes;for(let t=0;t<s.length;t++){const e=s[t];0!==e.x&&0!==e.y&&this._fireGamepadAxisUpdate(t,0,0)}for(const{0:t,1:e}of this._pointers)if(t<0){this.#t(n);break}}for(const s of i._dgcbs)try{const r=s(t,e,n,i);"object"==typeof r&&(e=r)}catch(t){Promise.reject(t)}}else if(e){n=new c(e),this.gamepad||this.#t(n),i._pointers.set(t,n);for(const s of i._ngcbs)try{const n=s(t,e,null,i);"object"==typeof n&&(e=n)}catch(t){Promise.reject(t)}}else if(!s){i=i.next;continue}for(const s of i._rgcbs)try{const n=s(t,e,i);"object"==typeof n&&(e=n)}catch(t){Promise.reject(t)}i=i.next}return e}refireGamepad(t){this.setGamepad(t,this._pointers.get(~t)??null,!0)}fireWheelUpdate(t=0,e=0){"object"==typeof t&&(e=+t.y,t=+t.x);let s=this;for(;s;){this.wheel.x+=t,this.wheel.y+=e;for(const i of this._wcbs)try{const n=i(t,e,s);"object"==typeof n&&(n?(t=+n.x,e=+n.y):t=e=0)}catch(t){Promise.reject(t)}s=s.next}return{x:t,y:e}}fireMouseUpdate(t=0,e=0){"object"==typeof t&&(e=+t.y,t=+t.x);let s=this;for(;s;){this.mouse.x+=t,this.mouse.y+=e;for(const i of this._mcbs)try{const n=i(t,e,s);"object"==typeof n&&(n?(t=+n.x,e=+n.y):t=e=0)}catch(t){Promise.reject(t)}s=s.next}return{x:t,y:e}}clearDeltas(){this.mouse.x=this.mouse.y=this.wheel.x=this.wheel.y=0}}Gamma.input=(t,e=t.canvas)=>{if(e._ictx)return;t.MOUSE=i,t.KEY=n,t.GAMEPAD=r,t.PointerState=l,t.GamepadState=c;const u="undefined"!=typeof ApplePaySession&&!("letterSpacing"in CanvasRenderingContext2D.prototype),f=navigator.platform.startsWith("Linux")||"undefined"!=typeof netscape||u?void 0:{unadjustedMovement:!0};Object.defineProperty(t,"pointerLock",{get:()=>document.pointerLockElement==e,set:t=>{t?document.pointerLockElement!==e&&e.requestPointerLock(f)?.catch(t=>null):document.pointerLockElement===e&&document.exitPointerLock()}}),Object.defineProperty(t,"fullscreen",{get:()=>document.fullscreenElement==e,set:t=>{t?document.fullscreenElement!==e&&e.requestFullscreen()?.catch(t=>null):document.fullscreenElement===e&&document.exitFullscreen()}}),t.Inputs=o;const p=t.ictx=e._ictx=new a;t.InputContext=()=>new a,e.style.outline="none",e.style.touchAction="none",e.style.setProperty("-webkit-tap-highlight-color","transparent"),e.tabIndex=0;let d=!1;e.addEventListener("mousedown",t=>{document.activeElement?._ictx!=p&&e.focus(),t.preventDefault(),p.setKey(t.button,!0)}),e.addEventListener("mouseup",t=>{t.preventDefault(),p.setKey(t.button,!1)}),e.addEventListener("contextmenu",t=>t.preventDefault()),e.addEventListener("wheel",t=>{t.preventDefault(),p.fireWheelUpdate(t.wheelDeltaX,t.wheelDeltaY)},{passive:!1});let _=NaN,m=NaN;e.addEventListener("mousemove",t=>{t.preventDefault();let s=0,i=0;try{if(document.pointerLockElement==e)if(s=t.movementX,i=t.movementY,u){const{width:t,height:n}=e.getBoundingClientRect();s*=devicePixelRatio*e.offsetWidth/t,i*=devicePixelRatio*e.offsetHeight/n}else f||(s*=devicePixelRatio,i*=devicePixelRatio);else{if(_!=_)return;s=t.offsetX-_,i=t.offsetY-m}}finally{_=t.offsetX,m=t.offsetY}p.fireMouseUpdate(s,-i)});let g=0,b=0;t.onFlush(()=>{g!==b&&(e.style.cursor="number"==typeof g?h[g]:`url(${CSS.escape(g)})`,b=g)});let y=null,x=0;const A=t=>{t.repeat||(y=null,t.returnValue=p.setKey(s[t.code]??t.keyCode,!0),y&&document.activeElement!=y&&(d=!0,y.focus(),d=!1,t.returnValue=!0))},E=t=>{y=null,p.setKey(s[t.code]??t.keyCode,!1)},P=t=>{if(!d){p.iter(t=>p.setKey(t,!1));for(const t of p._pointers.keys())t<0&&p.setGamepad(~t,null)}},U=t=>{t._ictx=p,t.addEventListener("keydown",A),t.addEventListener("keyup",E),t.addEventListener("blur",P)};U(e),t.captureKeyEvent=(t,e=0,s=!1)=>{(e|=0)<0||(t._ictx||U(t),y=t,x=e^-s)},t.setFocused=(t=null)=>{t?t._ictx||U(t):t=e,d=!0,t.focus(),d=!1};const v=t=>{g=t},L=t=>{if(t.pointerId<0)return;const s=new l;s.x=t.offsetX/e.offsetWidth,s.y=1-t.offsetY/e.offsetHeight,s.buttons=t.buttons,s.pressure=t.pressure,s.tiltX=.017453292519943295*t.tiltX,s.tiltY=.017453292519943295*t.tiltY,s.twist=.017453292519943295*t.twist,"mouse"==t.pointerType&&(s.setHint=v),p.setPointer("mouse"==t.pointerType?0:t.pointerId,s)};e.addEventListener("pointerover",L),e.addEventListener("pointerdown",L),e.addEventListener("pointermove",L),e.addEventListener("pointerup",L),e.addEventListener("pointerleave",t=>{t.pointerId<0||p.setPointer("mouse"==t.pointerType?0:t.pointerId,null)})}}