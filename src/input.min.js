globalThis.BitField??=class t extends Array{constructor(t){if(super(),Array.isArray(t))for(let e=0;e<t.length;e++)this.push(t[e]);else if(t instanceof Uint8Array)for(let e=0;e<t.length;e+=4)this.push(t[e]|t[1|e]<<8|t[2|e]<<16|t[3|e]<<24);else if(t)for(const e of t)this.set(e)}static parse(e){return Array.isArray(e)?Object.setPrototypeOf(e,t.prototype):new t}static decode(e,r=new t){r.length=0;let s=e.v32();for(;s--;)r.push(e.i32())}static encode(t,e){const r=e.length;t.v32(r);for(let e=0;e<r;e++)t.i32(this[e])}static of(...e){const r=new t;for(const t of e)r.set(t);return r}set(t){const e=t>>>5;for(;e>=this.length;)this.push(0);this[e]|=1<<(31&t)}unset(t){let e=this.length;const r=t>>>5;if(!(r>=e))for(this[r]&=~(1<<(31&t));e&&!this[--e];)super.pop()}toggle(t){let e=this.length;const r=t>>>5;for(;r>=e;)this.push(0),e++;for(this[r]^=1<<(31&t);e&&!this[--e];)super.pop()}has(t){const e=t>>>5;return!(e>=this.length)&&!!(this[e]&1<<(31&t))}pop(t){let e=t>>>5;if(e>=this.length)return!1;let r=this[e];if(r^=this[e]=r&~(1<<(31&t)),e==this.length-1)for(;e>=0&&!this[e--];)super.pop();return!!r}put(t){let e=t>>>5;for(;e>=this.length;)this.push(0);return!!(this[e]^(this[e]|=1<<(31&t)))}xor(t){let e=this.length;if(e==t.length)for(;e&&this[--e]==t[e];)super.pop();else{let r=e;for(e--;r<t.length;)this.push(t[r++])}for(let r=e;r>=0;r--)this[r]^=t[r]}and(t){let e=this.length;for(this.length>t.length&&(e=this.length=t.length);e&&!(this[--e]&t[e]);)super.pop();for(;e>0;)this[--e]&=t[e]}or(t){let e=this.length-1,r=e;for(;++r<t.length;)this.push(t[r]);for(let r=e;r>=0;r--)this[r]|=t[r]}firstUnset(){let t=-1;for(;++t<this.length;){const e=~this[t];if(e)return t<<5|31-clz32(e&-e)}return t<<5}firstSet(){let t=-1;for(;++t<this.length;)if(this[t])return t<<5|31-clz32(this[t]&-this[t]);return-1}lastSet(){let t=this.length;for(;--t>=0;)if(this[t])return t<<5|31-clz32(this[t]);return-1}popFirst(){let t=-1;for(;++t<this.length;)if(this[t]){let e=31-clz32(this[t]&-this[t]);for(this[t]&=~(1<<e),e|=t<<5,t=this.length;t&&!this[--t];)super.pop();return e}return-1}putFirst(){let t=-1;for(;++t<this.length;){const e=~this[t];if(!e)continue;const r=31-clz32(e&-e);return this[t]|=1<<r,t<<5|r}return this.push(1),t<<5}popLast(){let t=this.length;for(;--t>=0;)if(this[t]){let e=31-Math.clz32(this[t]);for(this[t]&=~(1<<e),e|=t<<5,t=this.length;t&&!this[--t];)super.pop();return e}return-1}clear(){this.length=0}[Symbol.iterator](){const t={value:0,done:!1};let e=0,r=-1;return{[Symbol.iterator](){return this},next:()=>{for(;e<this.length;e++,r=-1){const s=this[e]&r,o=31-clz32(s&-s);if(!(o<0))return r=-2<<o,t.value=e<<5|o,t}return e=1/0,t.done=!0,t}}}iter(t){for(let e=0;e<this.length;e++){let r=-1;for(;;){const s=this[e]&r,o=31-clz32(s&-s);if(o<0)break;r=-2<<o,t(e<<5|o)}}}[Symbol.for("nodejs.util.inspect.custom")](){let t="",e=0;for(let r=0;r<this.length;r++){let s=-1;for(;;){const o=this[r]&s,n=31-clz32(o&-o);if(n<0)break;s=-2<<n,t+=" "+(r<<5|n),e++}}return`BitField(${e}) {[33m${t} [m}`}toUint8Array(){let t=this.length-1,e=this[t],r=0;const s=new Uint8Array(t=(t<<2)+(39-clz32(e)>>3));for(;r<t;r+=4){const t=this[r>>2];s[r]=t,s[1|r]=t>>8,s[2|r]=s>>16,s[3|r]=s>>24}for(r-=4;r<t;)s[r++]=e,e>>=8;return s}},"remove"in[]||Object.defineProperty(Array.prototype,"remove",{value(t){let e=this.indexOf(t);if(e>-1){for(;e<b.length;)b[e]=b[++e];b.pop()}return e},enumerable:!1,configurable:!0});{let t=null,e=null;Gamma.input=(r,s=r.canvas)=>{const o=r.keys=new BitField;r.MOUSE=Object.freeze({LEFT:0,RIGHT:2,MIDDLE:1,BACK:3,FORWARD:4}),r.KEY=Object.freeze({A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUM_0:48,NUM_1:49,NUM_2:50,NUM_3:51,NUM_4:52,NUM_5:53,NUM_6:54,NUM_7:55,NUM_8:56,NUM_9:57,SPACE:32,SECTION:192,BACKTICK:223,TAB:9,BACK:8,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,META:91,METARIGHT:93,CAPSLOCK:20,UP:38,RIGHT:39,DOWN:40,LEFT:37,MOD:navigator.platform.startsWith("Mac")?91:17,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,MINUS:189,PLUS:187,OPENBR:219,CLOSEBR:221,SEMICOLON:186,APOS_HASH:222,BACKSLASH:220,COMMA:188,DOT:190,SLASH:191,PAUSE:19,CLEAR:12,HOME:36,END:35,PAGE_UP:33,PAGE_DOWN:34,INS:45,DEL:46,CTX_MENU:93,PAD_0:96,PAD_1:97,PAD_2:98,PAD_3:99,PAD_4:100,PAD_5:101,PAD_6:102,PAD_7:103,PAD_8:104,PAD_9:105,AT:192,PAD_DIV:111,PAD_MULT:106,PAD_SUB:109,PAD_ADD:107,PAD_DOT:110,NUM_LOCK:144,SCROLL_LOCK:145}),r.GAMEPAD=Object.freeze({A:256,B:257,X:258,Y:259,LB:260,RB:261,LT:262,RT:263,UP:268,DOWN:269,LEFT:270,RIGHT:271,MENU:300}),r.cursor=r.vec2(),r.mouse=r.vec2(),r.wheel=r.vec2();const n=new Map;(r.onKey=(t,e)=>{if(Array.isArray(t)){for(const s of t)r.onKey(s,e);return}const s=n.get(t&=65535);s?s.push(e):n.set(t,[e])}).remove=(t,e)=>{if(Array.isArray(t)){for(const s of t)r.onKey.remove(s,e);return}const s=n.get(t&=65535);s&&(s.remove(e),!s.length)&&n.delete(t)},(r.onKeyRelease=(t,e)=>{if(Array.isArray(t)){for(const s of t)r.onKeyRelease(s,e);return}const s=n.get(t=~(65535&t));s?s.push(e):n.set(t,[e])}).remove=(t,e)=>{if(Array.isArray(t)){for(const s of t)r.onKeyRelease.remove(s,e);return}const s=n.get(t=~(65535&t));s&&(s.remove(e),!s.length)&&n.delete(t)};const i=[],h=[];(r.onWheel=t=>{i.push(t)}).remove=t=>{i.remove(t)},(r.onMouse=t=>{h.push(t)}).remove=t=>{h.remove(t)},s.addEventListener("mouseover",(()=>{t||(t=o,e=n)})),s.addEventListener("mouseout",(()=>{if(t!=o)return;const r=new BitField(o);o.clear(),r.iter((t=>{const e=n.get(~t);if(e)for(const r of e)try{r(t)}catch(t){Promise.reject(t)}})),o.clear(),t=e=null})),s.addEventListener("mousedown",(t=>{t.preventDefault();const e=t.button;o.set(e);const r=n.get(e);if(r)for(const s of r)try{s(e)}catch(t){Promise.reject(t)}})),s.addEventListener("mouseup",(t=>{t.preventDefault();const e=t.button;if(!o.pop(e))return;const r=n.get(~e);if(r)for(const s of r)try{s(e)}catch(t){Promise.reject(t)}})),s.addEventListener("contextmenu",(t=>t.preventDefault())),s.addEventListener("wheel",(t=>{t.preventDefault(),wheel.x+=t.deltaX,wheel.y+=t.deltaY;for(const e of i)e(t.deltaX,t.deltaY)}),{passive:!1}),s.addEventListener("mousemove",(t=>{t.preventDefault(),mouse.x+=t.movementX,mouse.y+=t.movementY,cursor.x=t.offsetX/t.target.offsetWidth,cursor.y=1-t.offsetY/t.target.offsetHeight;for(const e of i)e(t.movementX,t.movementY)}))},document.addEventListener("keydown",(r=>{if(!t)return;if(r.preventDefault(),r.repeat)return;const s=r.keyCode;t.set(s);const o=e.get(s);if(o)for(const t of o)try{t(s)}catch(r){Promise.reject(r)}})),document.addEventListener("keyup",(r=>{if(!t)return;r.preventDefault();const s=r.keyCode;if(!t.pop(s))return;const o=e.get(~s);if(o)for(const t of o)try{t(s)}catch(r){Promise.reject(r)}}))}