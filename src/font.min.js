Gamma.font=s=>{const t=s.Shader.MSDF=s.Shader("\nvoid main(){\n\tvec3 c = arg0().rgb;\n\tfloat sd = (uni0 < 0. ? c.r : max(min(c.r, c.g), min(max(c.r, c.g), c.b)))-.5+arg2*abs(uni0);\n\tfloat o = clamp(arg1*sd+.5,0.,1.);\n\tcolor = arg3*o;\n}",[COLOR,FLOAT,FLOAT,VEC4],[FLOAT],_,[_,1,0,vec4.one]);t.oldfv=0;const e=s.BreakToken=(s,t=0,e="",n)=>{if(s instanceof RegExp){let t=s.flags,e=t.indexOf("g");e>-1&&(t=t.slice(0,e)+t.slice(e+1)),t.includes("y")||(t+="y"),s=new RegExp(s.source,t)}else{let t="[";for(const e of s+""){const s=e.codePointAt();t+=s>=92&&s<=94||45==s?"\\"+e:e}s=new RegExp(t+"]","y")}return s.type=t,s.sep=e,s.next=n,s.sepW=s.sepA=s.sepS=0,s.sepL=null,s};e.NORMAL=0,e.NEVER_SPLIT=1,e.ALWAYS_SPLIT=2,e.OVERFLOW=3,e.VANISH=4,e.TRIM=5,e.SQUISH=6,e.SQUISH_SPLIT=7,e.BREAK_AFTER=8,e.BREAK_BEFORE=16,e.INVISIBLE=32;const n=[e(/\r\n?|\n/y,48,""),e(/[$£"+]?[\w'-]+[,.!?:;"^%€*]?/iy,0,"-"),e(/\s+/y,4)],i=e(/[^]/y),c=new Map,h=[],l=10,r=(s,t,e,n=0)=>{if(s.sepL=t,s.sepA=e,s.sepS=n,!t)return s.sepW=0;let i=0;const{map:c,kmap:h}=t,l=1/e;for(const t of s.sep){const s=t.codePointAt(),r=c.get(s);if(!r)continue;const a=r.xadv+n+(h.get(s+-1114112)??0);i+=e&&asin(a*e)*l||a}return t.then?.((()=>s.sepL==t&&(s.sepL=null,s.sepW=0))),s.sepW=i};class a extends Array{#s=null;#t=t;#e=1;#n=0;#i=1;#c=0;#h=0;#l=0;#r=null;#a=null;#o=null;#f=0;#u=NaN;#b=null;#g=-1;get width(){return this.#u}get length(){return this.#f}static#p=class e{constructor(s){this.#k=s}sub(){const s=new e(this.#k);return s.#y=this.#y,s.#m=this.#m,s.#_=this.#_,s.#d=this.#d,s.#w=this.#w,s.#v=this.#v,s.#q=this.#q,s.#A=this.#A,s}reset(s=null){this.#y="object"==typeof s?s:null,this.#m=t,this.#_=1,this.#d=0,this.#w=0,this.#v=0,this.#A=null,this.#q=0,this.#k.#b==this&&(this.#k.#b=null)}#k;#y=null;get font(){return this.#y}set font(s){"object"==typeof s&&(this.#y=s),this.#k.#b==this&&(this.#k.#b=null)}#m=t;get shader(){return this.#m}set shader(s){"function"==typeof s&&(this.#m=s),this.#k.#b==this&&(this.#k.#b=null)}#_=1;get scale(){return this.#_}set scale(s){this.#_=+s,this.#k.#b==this&&(this.#k.#b=null)}scaleBy(s=1,t=!0,e=!0){if(1==s)return;const n=this.#k,i=n.length;let c=0,h=0;for(;c<i;){const i=n[c++];if("number"==typeof i){if(i<0)continue;c++,3==i||4==i&&e?(h||(h=1),n[c-1]*=s):1==i&&t&&(n[c-1]*=s)}else"string"==typeof i&&(h||(h=2))}1!=h&&n.unshift(3,s),this.#_*=s,e&&(this.#x*=s),n.#u=NaN}#x=0;get yOffset(){return this.#x}set yOffset(s){this.#x=+s,this.#k.#b==this&&(this.#k.#b=null)}offsetBy(s=0){if(!s)return;const t=this.#k,e=t.length;let n=0,i=0;for(;n<e;){const e=t[n++];if("number"==typeof e){if(e<0)continue;n++,4==e&&(i||(i=1),t[n-1]+=s)}else"string"==typeof e&&(i||(i=2))}1!=i&&t.unshift(4,s),this.#x+=s}#d=1;get stretch(){return this.#d}set stretch(s){this.#d=+s,this.#k.#b==this&&(this.#k.#b=null)}stretchBy(s=1,t=!0,e=!1){if(1==s)return;const n=this.#k,i=n.length;let c=0,h=0;for(;c<i;){const i=n[c++];if("number"==typeof i){if(i<0)continue;c++,5==i||6==i&&e?(h||(h=1),n[c-1]*=s):1==i&&t&&(n[c-1]*=s)}else"string"==typeof i&&(h||(h=2))}1!=h&&(e?n.unshift(6,s,5,s):n.unshift(5,s)),this.#d*=s,e&&(this.#w*=s),n.#u=NaN}get letterWidth(){return this.#_*this.stretch}set letterWidth(s){this.stretch=s/this.#_}#w=0;get skew(){return this.#w}set skew(s){this.#w=+s,this.#k.#b==this&&(this.#k.#b=null)}skewBy(s=0){if(!s)return;const t=this.#k,e=t.length;let n=0,i=0;for(;n<e;){const e=t[n++];if("number"==typeof e){if(e<0)continue;n++,6==e&&(i||(i=1),t[n-1]+=s)}else"string"==typeof e&&(i||(i=2))}1!=i&&t.unshift(6,s),this.#w+=s}#v=0;get letterSpacing(){return this.#v}set letterSpacing(s){this.#v=+s,this.#k.#b==this&&(this.#k.#b=null)}spaceBy(s=0){if(!s)return;const t=this.#k,e=t.length;let n=0,i=0;for(;n<e;){const e=t[n++];if("number"==typeof e){if(e<0)continue;n++,7==e&&(i||(i=1),t[n-1]+=s)}else"string"==typeof e&&(i||(i=2))}1!=i&&t.unshift(7,s),this.#v+=s,t.#u=NaN}#q=0;get curve(){return this.#q}set curve(s){this.#q=+s,this.#k.#b==this&&(this.#k.#b=null)}curveBy(s=0){if(!s)return;const t=this.#k,e=t.length;let n=0,i=0;for(;n<e;){const e=t[n++];if("number"==typeof e){if(e<0)continue;n++,8==e?(i||(i=1),t[n-1]+=s):1!=e||i||(i=2)}else"string"==typeof e&&(i||(i=2))}1!=i&&t.unshift(8,s),this.#q+=s,t.#u=NaN}#A=null;get values(){return this.#A}set values(s){this.#A=s?.length?s:null,this.#k.#b==this&&(this.#k.#b=null)}#R=null;get backLines(){return this.#R}set backLines(s){this.#R=s?.length?s:null,this.#k.#b==this&&(this.#k.#b=null)}#N=null;get frontLines(){return this.#N}set frontLines(s){this.#N=s?.length?s:null,this.#k.#b==this&&(this.#k.#b=null)}drawOnly(){this.#k.push(this.#k._m=-3)}indexOnly(){this.#k.push(this.#k._m=-2)}drawAndIndex(){this.#k.push(this.#k._m=-1)}advance(s=0){const t=this.#k;t.l!=this&&this.#S(t),t.push(1,+s),t.w=NaN}#S(s){this.#y!=s.#s&&s.push(s.#s=this.#y),this.#m!=s.#t&&s.push(2,s.#t=this.#m),this.#_!=s.#e&&s.push(3,s.#e=this.#_),this.#x!=s.#n&&s.push(4,s.#n=this.#x),this.#d!=s.#i&&s.push(5,s.#i=this.#d),this.#w!=s.#c&&s.push(6,s.#c=this.#w),this.#v!=s.#h&&s.push(7,s.#h=this.#v),this.#q!=s.#l&&s.push(8,s.#l=this.#q),this.#A!=s.#r&&(s.push(this.#A??h),s.#r=this.#A),this.#R!=s.#a&&(s.push(9,this.#R??h),s.#a=this.#R),this.#N!=s.#o&&(s.push(l,this.#N??h),s.#o=this.#N),s.#b=this}slice(s=0,t=this.#k.#f){const n=this.#k,i=new a;s<0&&(s+=n.#f)<0&&(s=0),t<0&&(t+=n.#f)<0&&(t=0),t-=s;const c=new e(i);let h=0,r="";for(;s>0&&h<n.length;){const e=n[h++];if("number"==typeof e){if(e<0){i.#g=e;continue}const s=n[h++];switch(e){case 2:c.#m=s;break;case 3:c.#_=s;break;case 4:c.#x=s;break;case 5:c.#d=s;break;case 6:c.#w=s;break;case 7:c.#v=s;break;case 8:c.#q=s;break;case 9:c.#R=s;break;case l:c.#N=s}}else if("string"==typeof e){if(!(2&i.#g))continue;if((s-=e.length)<0){r=e.slice(s,(t+=s)+e.length);break}}else Array.isArray(e)?c.#A=e:c.#y=e}for(c.#S(i),-1!=i.#g&&i.push(i.#g),r&&(i.push(r),i.#f+=r.length);t>0&&h<n.length;){const s=n[h++];if(i.push(s),"number"==typeof s){if(s<0){i.#g=s;continue}const t=n[h++];switch(i.push(t),s){case 2:c.#m=t;break;case 3:c.#_=t;break;case 4:c.#x=t;break;case 5:c.#d=t;break;case 6:c.#w=t;break;case 7:c.#v=t;break;case 8:c.#q=t;break;case 9:c.#R=t;break;case l:c.#N=t}}else if("string"==typeof s){if(!(2&i.#g))continue;t-=s.length,i.#f+=s.length,t<0?(i[i.length-1]=s.slice(0,t),i.#f+=s.length+t):i.#f+=s.length}else Array.isArray(s)?c.#A=s:c.#y=s}return c}trim(s=0){const e=this.#k;if(s<0&&(s+=e.#f)<0&&(s=0),s>=e.#f)return;e.#f=s<0?0:s;let n=0;for(e.#s=null,e.#t=t,e.#e=1,e.#i=1,e.#n=0,e.#c=0,e.#h=0,e.#g=-1,e.#l=0,e.#r=null;s>0&&n<e.length;){const t=e[n++];if("number"==typeof t){if(t<0){e.#g=t;continue}const s=e[n++];switch(t){case 2:e.#t=s;break;case 3:e.#e=s;break;case 4:e.#n=s;break;case 5:e.#i=s;break;case 6:e.#c=s;break;case 7:e.#h=s;break;case 8:e.#l=s;break;case 9:e.#a=s;break;case l:e.#o=s}}else if("string"==typeof t){if(!(2&mask))continue;if((s-=t.length)<0){e[n-1]=t.slice(0,s);break}}else Array.isArray(t)?e.#r=t:e.#s=t}this.#y=e.#s,this.#m=e.#t,this.#_=e.#e,this.#x=e.#n,this.#d=e.#i,this.#w=e.#c,this.#v=e.#h,this.#q=e.#l,this.#A=e.#r,this.#R=e.#a,this.#N=e.#o,e.length=n,e.#u=NaN}concat(s){const e=this.#k,n=s.#k;e.#f+=n.#f;let i=0;this.#y=null,this.#m=t,this.#_=1,this.#x=0,this.#d=1,this.#w=0,this.#v=0,this.#q=0,this.#A=null;const c=n.length;let h=-1,r="";for(;i<c;){const s=n[i++];if("number"==typeof s){if(s<0){h=s;continue}const t=e[i++];switch(s){case 1:e.push(s,t);break;case 2:this.#m=t;break;case 3:this.#_=t;break;case 4:this.#x=t;break;case 5:this.#d=t;break;case 6:this.#w=t;break;case 7:this.#v=t;break;case 8:this.#q=t;break;case 9:this.#R=t;break;case l:this.#N=t}}else if("string"==typeof s){if(2&h){r=s;break}}else Array.isArray(s)?this.#A=s:this.#y=s}for(this.#S(e),h!=e.#g&&e.push(e.#g=h),r&&e.push(r);i<c;){const s=n[i++];if(e.push(s),"number"==typeof s){if(s<0){e.#g=s;continue}const t=n[i++];switch(e.push(t),s){case 2:this.#m=t;break;case 3:this.#_=t;break;case 4:this.#x=t;break;case 5:this.#d=t;break;case 6:this.#w=t;break;case 7:this.#v=t;break;case 8:this.#q=t;break;case 9:this.#R=t;break;case l:this.#N=t}}else if("string"==typeof s){if(!(2&e.#g))continue;j-=s.length,e.#f+=s.length,j<0?(e[e.length-1]=s.slice(0,j),e.#f+=s.length+j):e.#f+=s.length}else Array.isArray(s)?this.#A=s:this.#y=s}e.#u=NaN}get length(){return this.#k.#f}set length(s){this.trim(s)}get width(){let s=this.#k.#u;if(s==s)return s;s=0;const t=this.#k;let e=c,n=c,i=0,h=1,l=1,r=0,a=-1,o=0,f=0,u=1,b=-1,g=1;for(;i<t.length;){let p=t[i++];if("number"==typeof p){if(p<0){a=p;continue}const e=t[i++];switch(p){case 1:s+=u*e;break;case 3:u=(h=e)*l;break;case 5:u=(l=e)*h;break;case 7:r=e;break;case 8:f=1/e,o=e}}else if("string"==typeof p){if(1&a)for(const t of p){const i=t.codePointAt(),c=e.get(i);if(!c)continue;const h=(n.get(i+1114112*b)??0)*min(u,g);b=i,g=u;const l=(c.xadv+r)*u+h;s+=o&&asin(l*o)*f||l,c.tex?.waiting&&c.tex.load()}}else if("object"==typeof p){if(!p){e=n=c;continue}if(Array.isArray(p))continue;e=p.map,n=p.kmap,p.then?.((()=>t.#u=NaN))}}return t.#u=s}add(s){const t=this.#k;t.#b!=this&&this.#S(t),2&t.#g&&(t.#f+=(s+="").length),t.push(s),t.#u=NaN}indexAt(s=0){const t=this.#k;let e=c,n=c,i=0,h=1,l=1,r=0,a=-1,o=0,f=0,u=1,b=-1,g=1,p=0;for(;i<t.length;){let k=t[i++];if("number"==typeof k){if(k<0){a=k;continue}const s=t[i++];switch(k){case 1:w+=u*s;break;case 3:u=(h=s)*l;break;case 5:u=(l=s)*h;break;case 7:r=s;break;case 8:f=1/s,o=s}}else if("string"==typeof k)if(1&a)for(const t of k){const i=t.codePointAt(),c=e.get(i);if(!c){2&a&&(p+=t.length);continue}const h=(n.get(i+1114112*b)??0)*min(u,g);b=i,g=u;const l=(c.xadv+r)*u+h,k=o&&asin(l*o)*f||l;if(s-=k,2&a){if(s<=-.5*k)return p;p+=t.length}}else 2&a&&(p+=k.length);else if("object"==typeof k){if(!k){e=n=c;continue}if(Array.isArray(k))continue;e=k.map,n=k.kmap}}}draw(s,e=null){const n=this.#k;let i=c,h=c,r=0,a=0,o=0,f=1,u=1,b=1,g=0,p=0,k=0,y=0,m=0,_=-1,d=null,w=null,v=s.shader=t,q=null,A=null,x=-1,R=1;const N=s.pixelRatio();let S=1,L=0;s:for(;r<n.length;){let t=n[r++];if("number"==typeof t){if(t<0){_=t;continue s}const e=n[r++];switch(t){case 1:if(m){p&&s.skew(-p,0);const t=.5/m,n=e*m*2;s.rotate(L),s.translate(sin(n)*t,(1-cos(n))*t),s.rotate(-n),L=0,p&&s.skew(p,0)}else s.translate(e,0);continue s;case 3:const n=e*u;u=1/e,s.scale(n),k*=f*=u,y*=f,R*=n,m*=n,f=e,A&&(S=N*A.normDistRange*f);continue s;case 4:k=e*u,y=k*p;continue s;case 2:s.shader=v=t;break;case 5:b=e;continue s;case 6:s.skew(e-p,0),p=e,y=k*e;continue s;case 7:g=.5*e;continue s;case 8:m=e*f;continue s;case 9:d=e;continue s;case l:w=e;continue s;default:continue s}}else{if("string"==typeof t){if(1&_)for(const n of t){const t=n.codePointAt(),c=i.get(t);if(e&&2&_){for(;a>=e[o];){const t=e[o++]=s.sub();p&&t.skew(-p,0),L&&t.rotate(L)}a+=n.length}if(!c)continue;const l=(h.get(t+1114112*x)??0)*min(R,b);x=t,R=b;const r=(c.xadv+g+g)*b+l,f=l-y;if(m&&(p&&s.skew(-p,0),s.rotate(L+(L=-asin(r*m)||0)),p&&s.skew(p,0)),d)for(let t=0;t<d.length;t+=2){const e=d[t],n=m*r*e;q?s.drawRect(f+n,e,r-n-n,d[t+1],vec4.one,S,...q):s.drawRect(f+n,e,r-n-n,d[t+1],vec4.one,S)}if(c.tex&&(q?s.drawRect((c.x+g)*b+f,c.y+k,c.w*b,c.h,c.tex,S,...q):s.drawRect((c.x+g)*b+f,c.y+k,c.w*b,c.h,c.tex,S)),w)for(let t=0;t<w.length;t+=2){const e=m*r*w[t];q?s.drawRect(f+e,w[t],r-e-e,w[t+1],vec4.one,S,...q):s.drawRect(f+e,w[t],r-e-e,w[t+1],vec4.one,S)}s.translate(r,0)}else if(ret&&2&_){for(;a>=e[ret.length];){const t=e[o++]=s.sub();p&&t.skew(-p,0),L&&t.rotate(L)}a+=t.length}continue}if(!t){i=h=c;continue}if(Array.isArray(t)){q=t.length?t:null;continue}A=t,i=t.map,h=t.kmap,S=N*A.normDistRange*f}if(A){const s=(1&A._flags?.5:-.5)/A.normDistRange;s!=v.oldfv&&v.uniforms(v.oldfv=s)}}p&&s.skew(-p,0),L&&s.rotate(L),1!=f&&s.scale(u)}break(s=1/0,t=n,h={scale:1,letterSpacing:0,curve:0}){const o=this.#k,f=this.toString(),u=[];let b="number"==typeof s?s:"function"==typeof s?s(u.length,h):s[min(u.length,s.length-1)],g=new a,p=g.l=new e(g),k=0,y=0,m="",_=c,d=c,w=1,v=1,q=-1,A=0,x=!1;for(;k<f.length;){let n,R=0,N=g.length,S=0,L=A,O=p.#m,B=p.#_,F=p.#x,I=p.#d,E=p.#w,P=p.#v,T=p.#y,W=p.#q,M=p.#A,j=g.#g,D=g.#f,H=p.#R,V=p.#N;s:{if(t)for(n of t){n.lastIndex=k;const s=n.exec(f);if(s){k+=R=s[0].length,t=n.next??t;break s}}k+=R=1,n=i}const C=n.type;16&C&&(u.push(p),g.#u=x?NaN:A,x=!1,p=p.sub(),p.#k=g=new a,b="number"==typeof s?s:"function"==typeof s?s(u.length,h):s[min(u.length,s.length-1)],N=L=A=D=0,-1!=j&&g.push(g.#g=j),p.#S(g));const G=32&C&&-2!=g.#g;if(m){let s=m;R<m.length?(s=m.slice(0,R),m=m.slice(R),R=0):(R-=m.length,m=""),G&&g.push(-2),s&&g.push(s),2&g.#g&&(g.#f+=s.length),G&&g.push(g.#g)}let U=!1;for(;R>0;){const s=o[y++];if("number"==typeof s){if(s<0){g.#g=s,g.push(s);continue}const t=o[y++];switch(U=!0,s){case 1:g.push(s,t);break;case 2:p.#m=t;break;case 3:p.#_=t,p.#d;break;case 4:p.#x=t;break;case 5:p.#d=t,p.#_;break;case 6:p.#w=t;break;case 7:p.#v=t;break;case 8:p.#q=t;break;case 9:p.#R=t;break;case l:p.#N=t}}else if("string"==typeof s){if(!(2&g.#g)){g.push(s);continue}R-=s.length;let t=s;R<0?(t=s.slice(0,R),m=s.slice(R)):m="",U&&p.#S(g),G&&g.push(-2),g.push(t),g.#f+=t.length,G&&g.push(g.#g)}else Array.isArray(s)?(p.#A=s,U=!0):(p.#y=s,U=!0)}for(U&&p.#S(g);;){let t=N,i=S,o=O,f=B,k=F,y=I,m=E,R=P,G=T,U=M,z=j,K=D,Q=W,Y=H,$=V,J=1/Q,X=!1,Z=!1,ss=n.sepL==G&&n.sepA==Q&&n.sepS==R?n.sepW:r(n,G,Q,R);const ts=C?0!=(36>>C&1):2*L<b,{scale:es=1,letterSpacing:ns=0,curve:is=0}=h;x||=1!=es||0!=ns||0!=is;let cs=Q+is,hs=R+ns;for(is&&(J=1/cs);t<g.length;){const s=g[t++];if("number"==typeof s){if(s<0){z=s;continue}const e=g[t++];switch(s){case 1:if(A+=e,X||!ts)break;const s=A-(b-(ss-(d.get(n.sep.codePointAt()+1114112*q)??0))*w);(X=s>0)?(N=t-1,S=U-s):(N=t,S=0),Z=!0,L=A,O=o,B=f,F=k,I=y,E=m,P=R,T=G,W=Q,M=U,H=Y,V=$,j=z,D=K;break;case 2:o=e;break;case 3:f=e,w=e*y*es;break;case 4:k=e;break;case 5:y=e,w=e*f*es;break;case 6:m=e;break;case 7:R=e,hs=e+ns;break;case 8:cs=e+is,J=1/cs,Q=e;break;case 9:Y=e;break;case l:$=e}}else if("string"==typeof s){if(1&z)for(const e of s){const s=e.codePointAt(),c=_.get(s);if(i+=e.length,!c)continue;const h=(d.get(s+1114112*q)??0)*min(w,v);v=w,q=s;const l=(c.xadv+hs)*w+h;A+=cs&&asin(l*cs)*J||l,!(X=A>b-(ss-(d.get(n.sep.codePointAt()+1114112*s)??0))*w)&&ts&&(Z=!0,N=t-1,S=i,L=A,O=o,B=f,F=k,I=y,E=m,P=R,T=G,W=Q,M=U,H=Y,V=$,j=z,D=K)}}else Array.isArray(s)?U=s:(G=s)?(_=s.map,d=s.kmap,ss=n.sepL==s&&n.sepA==Q&&n.sepS==R?n.sepW:r(n,s,Q,R)):(_=d=c,ss=0)}if(!L||A<=b||!N||3==C)break;if(t=N,i=S,o=O,f=B,k=F,y=I,m=E,R=P,G=T,U=M,Y=H,$=V,z=j,Q=W,K=D,6==C||7==C&&b-L>=A-b){const s=(b-L)/(A-L),e=g.length;for(g.splice(t,0,5,s*y),t+=2;t<e;){const e=g[t++];"number"!=typeof e||e<0||(5==e?g[t++]*=s:t++)}g.push(5,y);break}A=L;const ls=g[t],rs=new a,as=new e(rs),os=g.length;as.#m=o,as.#_=f,as.#x=k,as.#d=y,as.#w=m,as.#v=R,as.#R=Y,as.#N=$,as.#y=G,as.#A=U,as.#q=Q,rs.#g=z;let fs=t+=!!i;const us=4!=C&&5!=C;s:for(;fs<os;){const s=g[fs++];if("number"==typeof s){if(s<0){rs.#g=s;continue}const t=g[fs++];switch(s){case 1:if(us){fs--;break s}break;case 2:as.#m=t;break;case 3:as.#_=t;break;case 4:as.#x=t;break;case 5:as.#d=t;break;case 6:as.#w=t;break;case 7:as.#v=t;break;case 8:as.#q=t;break;case 9:as.#R=t;break;case l:as.#N=t}}else if("string"==typeof s){if(us){fs--;break}}else Array.isArray(s)?as.#A=s:as.#y=s}for(as.#S(rs);fs<os;)rs.push(g[fs++]);rs.#f=g.#f-K,g.#f=us?K:0,g.#u=x?NaN:A,x=!1,-1!=rs.#g&&rs.push(rs.#g),as.#m=rs.#t=p.#m,as.#_=rs.#e=p.#_,as.#x=rs.#n=p.#x,as.#d=rs.#i=p.#d,as.#w=rs.#c=p.#w,as.#v=rs.#h=p.#v,as.#R=rs.#a=p.#R,as.#N=rs.#o=p.#N,as.#q=rs.#l=p.#q,rs.#g=g.#g,g.length=t,i&&("number"==typeof ls?(g[t-1]=i,us&&rs.push(1,ls-i)):(g[t-1]=ls.slice(0,i),us&&rs.push(ls.slice(i)))),Z&&(-3!=g.#g&&g.push(g.#g=-3),g.push(n.sep)),u.push(p),p=as,g=rs,b="number"==typeof s?s:"function"==typeof s?s(u.length,h):s[min(u.length,s.length-1)],N=S=L=A=D=0}if(8&C){u.push(p),g.#u=x?NaN:A,x=!1;const t=g.#g;A=0,p=p.sub(),p.#k=g=new a,b="number"==typeof s?s:"function"==typeof s?s(u.length,h):s[min(u.length,s.length-1)],-1!=t&&g.push(g.#g=t),p.#S(g)}}return g.#u=x?NaN:A,u.push(p),u}toString(){let s="",t=!0,e=0;const n=this.#k,i=n.length;for(;e<i;){const i=n[e++];"number"==typeof i&&(i<0?t=!!(2&i):e++),"string"==typeof i&&t&&(s+=i)}return s}static#p=s.RichText=s=>s?new e(s):(s=new a).#b=new e(s)}}class o{_flags=0;normDistRange=0;#L=[];map=new Map;ascend=0;kmap=new Map;get then(){return this.#L?this.#O:void 0}#O(s,t){this.#L?.push(s,t)}get isMsdf(){return!!(1&this._flags)}set isMsdf(s){this._flags=-2&this._flags|s}done(){const s=this.#L;if(this.#L=null,s)for(let t=0;t<s.length;t+=2)s[t]?.(this)}error(s){const t=this.#L;if(this.#L=null,t)for(let e=1;e<t.length;e+=2)t[e]?.(s)}chlumsky(s,t){return fetch(s).then((t=>(s=t.url,t.json()))).then((s=>{const{atlas:{type:e,distanceRange:n,size:i,width:c,height:h},metrics:{ascender:l,descender:r},glyphs:a,kerning:o}=s,f=(this.isMsdf=e.toLowerCase().endsWith("msdf"))?Formats.RGB:Formats.R,u=Img(t,SMOOTH,f);this.normDistRange=n/i*2,this.ascend=l/(l-r);for(const{unicode1:s,unicode2:t,advance:e}of o)this.kmap.set(t+1114112*s,e);for(const{unicode:s,advance:t,planeBounds:e,atlasBounds:n}of a)this.map.set(s,e?{x:e.left,y:e.bottom,w:e.right-e.left,h:e.top-e.bottom,xadv:t,tex:u.sub(n.left/c,n.bottom/h,(n.right-n.left)/c,(n.top-n.bottom)/h)}:{x:0,y:0,w:0,h:0,xadv:t,tex:null});this.done()}),this.error.bind(this)),this}bmfont(s,t=0){return fetch(s).then((t=>(s=t.url,t.json()))).then((e=>{const{chars:n,distanceField:i,pages:c,info:{size:h},common:{base:l,lineHeight:r,scaleW:a,scaleH:o},kernings:f}=e,u=(this.isMsdf=i.fieldType.toLowerCase().endsWith("msdf"))?Formats.RGB:Formats.R;this.normDistRange=i.distanceRange/r*2;const b=this.ascend=l/r,g=c.map((t=>Img(new URL(t,s).href,SMOOTH,u)));for(const{first:s,second:t,amount:e}of f)this.kmap.set(t+1114112*s,e/h);for(const{id:s,x:e,y:i,width:c,height:l,xoffset:r,yoffset:f,xadvance:u,page:p}of n)this.map.set(s,{x:r/h,y:b-(f-t+l)/h,w:c/h,h:l/h,xadv:u/h,tex:c&&l?g[p].sub(e/a,1-(i+l)/o,c/a,l/o):null});this.done()}),this.error.bind(this)),this}draw(s,e,n=0,i=0,c=0,h=-1,...l){if(this.#L)return;c*=.5;let r=s.pixelRatio()*this.normDistRange,a=s.shader;void 0===a.oldfv&&(a=s.shader=t);const o=(1&this._flags?.5:-.5)/this.normDistRange;o!=a.oldfv&&a.uniforms(a.oldfv=o);let f=0;const{map:u,kmap:b}=this;i&&s.skew(i,0);for(const t of e){const e=t.codePointAt(),a=u.get(e);if(!a)continue;const o=b.get(e+1114112*h)??0;h=e;const g=a.xadv+c+c+o;n&&(i&&s.skew(-i,0),s.rotate(f+(f=-asin(g*n)||0)),i&&s.skew(i,0)),a.tex&&s.drawRect(a.x+c+o,a.y,a.w,a.h,a.tex,r,...l),s.translate(g,0)}return i&&s.skew(-i,0),f&&s.rotate(f),h}measure(s,t=0,e=0,n=-1){if(this.#L)return;const i=1/t;let c=0;const{map:h,kmap:l}=this;for(const r of s){const s=r.codePointAt(),a=h.get(s);if(!a)continue;const o=l.get(s+1114112*n)??0;n=s;const f=a.xadv+e+o;c+=t&&asin(f*t)*i||f}return c}}s.Font=()=>new o,s.Font.bmfont=(s,t)=>(new o).bmfont(s,t),s.Font.chlumsky=(s,t)=>(new o).chlumsky(s,t)}