Gamma.font=t=>{const e=t.Shader.MSDF=t.Shader("\nvoid main(){\n\tvec3 c = arg0().rgb;\n\tfloat sd = (uni0 < 0. ? c.r : max(min(c.r, c.g), min(max(c.r, c.g), c.b)))-.5+arg3*abs(uni0);\n\tfloat o = clamp(arg1*sd+.5,0.,1.);\n\tcolor = arg2*o;\n}",[COLOR,FLOAT,VEC4,FLOAT],[_,1,vec4.one,0],[FLOAT]);e.oldfv=0;const s=t.BreakToken=(t,e=0,s="",n)=>{if(t instanceof RegExp){let e=t.flags,s=e.indexOf("g");s>-1&&(e=e.slice(0,s)+e.slice(s+1)),e.includes("y")||(e+="y"),t=new RegExp(t.source,e)}else{let e="[";for(const s of t+""){const t=s.codePointAt();e+=t>=92&&t<=94||45==t?"\\"+s:s}t=new RegExp(e+"]","y")}return t.type=e,t.sep=s,t.next=n,t.sepW=t.sepA=t.sepS=0,t.sepL=null,t};s.NORMAL=0,s.NEVER_SPLIT=1,s.ALWAYS_SPLIT=2,s.OVERFLOW=3,s.VANISH=4,s.TRIM=5,s.SQUISH=6,s.SQUISH_SPLIT=7,s.BREAK_AFTER=8,s.BREAK_BEFORE=16,s.INVISIBLE=32;const n=[s(/\r\n?|\n/y,48,""),s(/[$£"+]?[\w'-]+[,.!?:;"^%€*]?/iy,0,"-"),s(/\s+/y,4)],o=s(/[^]/y),r=new Map,c={0:null,1:0},l=[0,0,0,c],h=-2,a=(t,e,s,n=0)=>{if(t.sepL=e,t.sepA=s,t.sepS=n,!e)return t.sepW=0;let i=0;const{map:o,kmap:r}=e,c=1/s;for(const e of t.sep){const t=e.codePointAt(),l=o.get(t);if(!l)continue;const h=l.xadv+n+(r.get(t+-1114112)??0);i+=s&&asin(h*s)*c||h}return e.then?.((()=>t.sepL==e&&(t.sepL=null,t.sepW=0))),t.sepW=i};class f extends Array{#t=null;#e=e;#s=1;#n=0;#i=1;#o=0;#r=0;#c=0;#l=l;#h=0;#a=NaN;#f=null;#u=-1;static#p=class s{constructor(t){this.#b=t}sub(){const t=new s(this.#b);return t.#g=this.#g,t.#y=this.#y,t.#k=this.#k,t.#_=this.#_,t.#m=this.#m,t.#d=this.#d,t.#v=this.#v,t.#w=this.#w,t}reset(t=null){this.#g="object"==typeof t?t:null,this.#y=e,this.#k=1,this.#_=0,this.#m=0,this.#d=0,this.#w=null,this.#v=0,this.#b.#f==this&&(this.#b.#f=null)}#b;#g=null;get font(){return this.#g}set font(t){"object"==typeof t&&(this.#g=t),this.#b.#f==this&&(this.#b.#f=null)}#y=e;get shader(){return this.#y}set shader(t){"function"==typeof t&&(this.#y=t),this.#b.#f==this&&(this.#b.#f=null)}#k=1;get scale(){return this.#k}set scale(t){this.#k=+t,this.#b.#f==this&&(this.#b.#f=null)}scaleBy(t=1,e=!0,s=!0){if(1==t)return;const n=this.#b,i=n.length;let o=0,r=0;for(;o<i;){const i=n[o++];if("number"==typeof i){if(i<0)continue;o++,3==i||4==i&&s?(r||(r=1),n[o-1]*=t):1==i&&e&&(n[o-1]*=t)}else"string"!=typeof i&&"function"!=typeof i||r||(r=2)}1!=r&&n.unshift(3,t),n.#s*=t,s&&(n.#n*=t),n.#a=NaN,n.#f=null}#q=0;get yOffset(){return this.#q}set yOffset(t){this.#q=+t,this.#b.#f==this&&(this.#b.#f=null)}offsetBy(t=0){if(!t)return;const e=this.#b,s=e.length;let n=0,i=0;for(;n<s;){const s=e[n++];if("number"==typeof s){if(s<0)continue;n++,4==s&&(i||(i=1),e[n-1]+=t)}else"string"!=typeof s&&"function"!=typeof s||i||(i=2)}1!=i&&e.unshift(4,t),e.#n+=t,e.#f=null}#_=1;get stretch(){return this.#_}set stretch(t){this.#_=+t,this.#b.#f==this&&(this.#b.#f=null)}stretchBy(t=1,e=!0,s=!1){if(1==t)return;const n=this.#b,i=n.length;let o=0,r=0;for(;o<i;){const i=n[o++];if("number"==typeof i){if(i<0)continue;o++,5==i||6==i&&s?(r||(r=1),n[o-1]*=t):1==i&&e&&(n[o-1]*=t)}else"string"!=typeof i&&"function"!=typeof i||r||(r=2)}1!=r&&(s?n.unshift(6,t,5,t):n.unshift(5,t)),n.#i*=t,s&&(n.#o*=t),n.#a=NaN,n.#f=null}get letterWidth(){return this.#k*this.stretch}set letterWidth(t){this.stretch=t/this.#k}#m=0;get skew(){return this.#m}set skew(t){this.#m=+t,this.#b.#f==this&&(this.#b.#f=null)}skewBy(t=0){if(!t)return;const e=this.#b,s=e.length;let n=0,i=0;for(;n<s;){const s=e[n++];if("number"==typeof s){if(s<0)continue;n++,6==s&&(i||(i=1),e[n-1]+=t)}else"string"!=typeof s&&"function"!=typeof s||i||(i=2)}1!=i&&e.unshift(6,t),e.#o+=t,e.#f=null}#d=0;get letterSpacing(){return this.#d}set letterSpacing(t){this.#d=+t,this.#b.#f==this&&(this.#b.#f=null)}spaceBy(t=0){if(!t)return;const e=this.#b,s=e.length;let n=0,i=0;for(;n<s;){const s=e[n++];if("number"==typeof s){if(s<0)continue;n++,7==s&&(i||(i=1),e[n-1]+=t)}else"string"!=typeof s&&"function"!=typeof s||i||(i=2)}1!=i&&e.unshift(7,t),e.#r+=t,e.#a=NaN,e.#f=null}#v=0;get curve(){return this.#v}set curve(t){this.#v=+t,this.#b.#f==this&&(this.#b.#f=null)}curveBy(t=0){if(!t)return;const e=this.#b,s=e.length;let n=0,i=0;for(;n<s;){const s=e[n++];if("number"==typeof s){if(s<0)continue;n++,8==s?(i||(i=1),e[n-1]+=t):1!=s||i||(i=2)}else"string"!=typeof s&&"function"!=typeof s||i||(i=2)}1!=i&&e.unshift(8,t),e.#c+=t,e.#a=NaN,e.#f=null}#w=l;addTextPass(t,e,s,...n){const i=n.length?{0:null,1:0}:c;for(let t=0;t<n.length;t++)i[t+2]=n[t];const o=this.#w,r=this.#w=[];let l=0;for(;l<o.length;l+=4){if(!(o[l]<t)){o[l]==t&&(l+=4);break}r.push(o[l],o[l+1],o[l+2],o[l+3])}for(r.push(t,+e,+s,i);l<o.length;)r.push(o[l],o[l+1],o[l+2],o[l+3]),l+=4;this.#b.#f=null}addLinePass(t,e,s,...n){const i=n.length?{0:null,1:0}:c;for(let t=0;t<n.length;t++)i[t+2]=n[t];const o=this.#w,r=this.#w=[];let l=0;for(;l<o.length;l+=4){if(!(o[l]<t)){o[l]==t&&(l+=4);break}r.push(o[l],o[l+1],o[l+2],o[l+3])}for(r.push(t,i,+e,+s);l<o.length;)r.push(o[l],o[l+1],o[l+2],o[l+3]),l+=4;this.#b.#f=null}setValues(t,...e){const s=this.#w=this.#w.slice();for(let n=0;n<s.length;n+=4){if(s[n]==t){let t=s[n+=3];if("number"==typeof t&&(t=s[n-=2]),t!=c)for(let s=e.length-1;s>=0;s--){const n=e[s];void 0!==n&&(t[s+2]=n)}else if(e.length){const t=s[n]={0:null,1:0};for(let s=0;s<e.length;s++)t[s+2]=e[s]}break}if(s[n]>t)break}this.#b.#f=null}delPass(t){const e=this.#w,s=this.#w=[];for(let n=0;n<e.length;n+=4){if(!(e[n]<t)){e[n]==t&&(n+=4);break}s.push(e[n],e[n+1],e[n+2],e[n+3])}for(;i<e.length;)s.push(e[i],e[i+1],e[i+2],e[i+3]),i+=4;this.#b.#f=null}insertTextPass(t,e,s,...n){const i=n.length?{0:null,1:0}:c;for(let t=0;t<n.length;t++)i[t+2]=n[t];const o=this.#b,r=o.length;let l=0,h=0;for(;l<r;){let n=o[l++];if("number"==typeof n&&n>0)l++;else if("string"==typeof n||"function"==typeof n)h||(h=2);else if(Array.isArray(n)){h||(h=1);const r=o[l-1]=[];let c=0;for(;c<n.length;c+=4){if(!(n[c]<t)){n[c]==t&&(c+=4);break}r.push(n[c],n[c+1],n[c+2],n[c+3])}for(r.push(t,+e,+s,i);c<n.length;)r.push(n[c],n[c+1],n[c+2],n[c+3]),c+=4}}1!=h&&o.unshift([t,e,s,h]),o.#f=null}insertLinePass(t,e,s,...n){const i=n.length?{0:null,1:0}:c;for(let t=0;t<n.length;t++)i[t+2]=n[t];const o=this.#b,r=o.length;let l=0,h=0;for(;l<r;){let n=o[l++];if("number"==typeof n&&n>0)l++;else if("string"==typeof n||"function"==typeof n)h||(h=2);else if(Array.isArray(n)){h||(h=1);const r=o[l-1]=[];let c=0;for(;c<n.length;c+=4){if(!(n[c]<t)){n[c]==t&&(c+=4);break}r.push(n[c],n[c+1],n[c+2],n[c+3])}for(r.push(t,i,e,s);c<n.length;)r.push(n[c],n[c+1],n[c+2],n[c+3]),c+=4}}1!=h&&o.unshift([t,x,y,h]),o.#f=null}adjustValues(t,...e){const s=this.#b,n=s.length;let i=0,o=0;for(;i<n;){let n=s[i++];if("number"==typeof n&&n>0)i++;else if("string"==typeof n||"function"==typeof n)o||(o=2);else if(Array.isArray(n)){n==s.#l&&(n=s.#l=s[i-1]=n.slice());let o=0;for(;o<n.length;o+=4)if(n[o]==t){let t=n[o+=3];if("number"==typeof t&&(t=n[o-=2]),t!=c)for(let s=e.length-1;s>=0;s--){const n=e[s];void 0!==n&&(t[s+2]=n)}else if(e.length){const t=n[o]={0:null,1:0};for(let s=0;s<e.length;s++)t[s+2]=e[s]}break}}}s.#f=null}removePass(t){const e=this.#b,s=e.length;let n=0;t:for(;n<s;){let s=e[n++];if("number"==typeof s&&s>0)n++;else if(Array.isArray(s)){let e=0;for(;e<s.length;e+=4){if(s[e]>t)continue t;if(s[e]==t){for(e+=4;e<s.length;)s[e-4]=s[e],s[e-3]=s[e+1],s[e-2]=s[e+2],s[e-1]=s[e+3],e+=4;s.length-=4;break}}}}}get values(){return this.#w}set values(t){this.#w=t?.length?t:null,this.#b.#f==this&&(this.#b.#f=null)}drawOnly(){this.#b.push(this.#b._m=-3)}indexOnly(){this.#b.push(this.#b._m=h)}drawAndIndex(){this.#b.push(this.#b._m=-1)}advance(t=0){const e=this.#b;e.l!=this&&this.#A(e),e.push(1,+t),e.w=NaN}#A(t){this.#g!=t.#t&&t.push(t.#t=this.#g),this.#y!=t.#e&&t.push(2,t.#e=this.#y),this.#k!=t.#s&&t.push(3,t.#s=this.#k),this.#q!=t.#n&&t.push(4,t.#n=this.#q),this.#_!=t.#i&&t.push(5,t.#i=this.#_),this.#m!=t.#o&&t.push(6,t.#o=this.#m),this.#d!=t.#r&&t.push(7,t.#r=this.#d),this.#v!=t.#c&&t.push(8,t.#c=this.#v),this.#w!=t.#l&&(t.push(this.#w),t.#l=this.#w),t.#f=this}copy(){const t=this.#b,e=t.slice(),s=e.#f=this.sub();return s.#b=e,e.#t=t.#t,e.#e=t.#e,e.#s=t.#s,e.#n=t.#n,e.#i=t.#i,e.#o=t.#o,e.#r=t.#r,e.#c=t.#c,e.#l=t.#l,e.#u=t.#u,e.#h=t.#h,e.#a=t.#a,s}slice(t=0,e=this.#b.#h){const n=this.#b,i=new f;t<0&&(t+=n.#h)<0&&(t=0),e<0&&(e+=n.#h)<0&&(e=0);const o=new s(i);let r=0;if(e<=0){for(;r<n.length;){const t=n[r++];if("number"==typeof t){if(t<0){i.#u=t;continue}const e=n[r++];switch(t){case 1:r-=2;break;case 2:o.#y=e;break;case 3:o.#k=e;break;case 4:o.#q=e;break;case 5:o.#_=e;break;case 6:o.#m=e;break;case 7:o.#d=e;break;case 8:o.#v=e}}else{if("string"==typeof t||"function"==typeof t)break;Array.isArray(t)?o.#w=t:o.#g=t}}return-1!=i.#u&&i.push(i.#u),o.#A(i),o}e=e>=t?e-t:0;let c="";for(;t>0&&r<n.length;){const s=n[r++];if("number"==typeof s){if(s<0){i.#u=s;continue}const t=n[r++];switch(s){case 2:o.#y=t;break;case 3:o.#k=t;break;case 4:o.#q=t;break;case 5:o.#_=t;break;case 6:o.#m=t;break;case 7:o.#d=t;break;case 8:o.#v=t}}else if("string"==typeof s){if(!(2&i.#u))continue;if((t-=s.length)<0){c=s.slice(t,(e+=t)+s.length);break}}else Array.isArray(s)?o.#w=s:"object"==typeof s&&(o.#g=s)}for(o.#A(i),-1!=i.#u&&i.push(i.#u),c&&(i.push(c),i.#h+=c.length);e>0&&r<n.length;){const t=n[r++];if(i.push(t),"number"==typeof t){if(t<0){i.#u=t;continue}const e=n[r++];switch(i.push(e),t){case 2:o.#y=e;break;case 3:o.#k=e;break;case 4:o.#q=e;break;case 5:o.#_=e;break;case 6:o.#m=e;break;case 7:o.#d=e;break;case 8:o.#v=e}}else if("string"==typeof t){if(!(2&i.#u))continue;e-=t.length,i.#h+=t.length,e<0?(i[i.length-1]=t.slice(0,e),i.#h+=t.length+e):i.#h+=t.length}else Array.isArray(t)?o.#w=t:"object"==typeof t&&(o.#g=t)}return o}trim(t=0){const s=this.#b;if(t<0&&(t+=s.#h)<0&&(t=0),t>=s.#h)return;let n=0;if(s.#t=null,s.#e=e,s.#s=1,s.#i=1,s.#n=0,s.#o=0,s.#r=0,s.#u=-1,s.#c=0,s.#l=l,s.#h=t<0?0:t)for(;t>0&&n<s.length;){const e=s[n++];if("number"==typeof e){if(e<0){s.#u=e;continue}const t=s[n++];switch(e){case 2:s.#e=t;break;case 3:s.#s=t;break;case 4:s.#n=t;break;case 5:s.#i=t;break;case 6:s.#o=t;break;case 7:s.#r=t;break;case 8:s.#c=t}}else if("string"==typeof e){if(!(2&s.#u))continue;if((t-=e.length)<0){s[n-1]=e.slice(0,t);break}}else Array.isArray(e)?s.#l=e:"object"==typeof e&&(s.#t=e)}else for(;n<s.length;){const t=s[n++];if("number"==typeof t){if(t<0){s.#u=t;continue}const e=s[n++];switch(t){case 1:n-=2;break;case 2:s.#e=e;break;case 3:s.#s=e;break;case 4:s.#n=e;break;case 5:s.#i=e;break;case 6:s.#o=e;break;case 7:s.#r=e;break;case 8:s.#c=e}}else{if("string"==typeof t){n--;break}if(Array.isArray(t))s.#l=t;else{if("object"!=typeof t)break;s.#t=t}}}this.#g=s.#t,this.#y=s.#e,this.#k=s.#s,this.#q=s.#n,this.#_=s.#i,this.#m=s.#o,this.#d=s.#r,this.#v=s.#c,this.#w=s.#l,s.length=n,s.#a=NaN}concat(t){const s=this.#b,n=t.#b;s.#h+=n.#h;let i=0;this.#g=null,this.#y=e,this.#k=1,this.#q=0,this.#_=1,this.#m=0,this.#d=0,this.#v=0,this.#w=l;const o=n.length;let r=-1;t:for(;i<o;){const t=n[i++];if("number"==typeof t){if(t<0){r=t;continue}const e=n[i++];switch(t){case 1:i-=2;break t;case 2:this.#y=e;break;case 3:this.#k=e;break;case 4:this.#q=e;break;case 5:this.#_=e;break;case 6:this.#m=e;break;case 7:this.#d=e;break;case 8:this.#v=e}}else if("string"==typeof t){if(2&r){i--;break}}else if(Array.isArray(t))this.#w=t;else{if("object"!=typeof t){i--;break}this.#g=t}}for(this.#A(s),r!=s.#u&&s.push(s.#u=r);i<o;){const t=n[i++];if(s.push(t),"number"==typeof t){if(t<0){s.#u=t;continue}const e=n[i++];switch(s.push(e),t){case 2:this.#y=e;break;case 3:this.#k=e;break;case 4:this.#q=e;break;case 5:this.#_=e;break;case 6:this.#m=e;break;case 7:this.#d=e;break;case 8:this.#v=e}}else"string"==typeof t?2&s.#u&&(s.#h+=t.length):Array.isArray(t)?this.#w=t:"object"==typeof t&&(this.#g=t)}s.#a=NaN}get length(){return this.#b.#h}set length(t){this.trim(t)}get width(){const t=this.#b;let e=t.#a;if(e==e)return e;e=0;let s=r,n=r,i=0,o=1,c=1,l=0,h=-1,a=0,f=0,u=1,p=-1,b=1;for(;i<t.length;){let g=t[i++];if("number"==typeof g){if(g<0){h=g;continue}const s=t[i++];switch(g){case 1:e+=u*s,p=-1;break;case 3:u=(o=s)*c;break;case 5:u=(c=s)*o;break;case 7:l=s;break;case 8:f=1/s,a=s}}else if("string"==typeof g){if(1&h)for(const t of g){const i=t.codePointAt(),o=s.get(i);if(!o)continue;const r=(n.get(i+1114112*p)??0)*min(u,b);p=i,b=u;const c=(o.xadv+l)*u+r;e+=a&&asin(c*a)*f||c,o.tex?.waiting&&o.tex.load()}}else if("object"==typeof g){if(!g){s=n=r;continue}if(Array.isArray(g))continue;s=g.map,n=g.kmap,g.then?.((()=>t.#a=NaN))}}return t.#a=e}add(t){const e=this.#b;e.#f!=this&&this.#A(e),2&e.#u&&(e.#h+=(t+="").length),e.push(t),e.#a=NaN}addCb(t,e=NaN){const s=this.#b;s.#f!=this&&this.#A(s),e==e?s.push(t,1,e):s.push(t)}indexAt(t=0){const e=this.#b;let s=r,n=r,i=0,o=1,c=1,l=0,h=-1,a=0,f=0,u=1,p=-1,b=1,g=0;for(;i<e.length;){let y=e[i++];if("number"==typeof y){if(y<0){h=y;continue}const s=e[i++];switch(y){case 1:t-=u*s,p=-1;break;case 3:u=(o=s)*c;break;case 5:u=(c=s)*o;break;case 7:l=s;break;case 8:f=1/s,a=s}}else if("string"==typeof y)if(1&h)for(const e of y){const i=e.codePointAt(),o=s.get(i);if(!o){2&h&&(g+=e.length);continue}const r=(n.get(i+1114112*p)??0)*min(u,b);p=i,b=u;const c=(o.xadv+l)*u+r,y=a&&asin(c*a)*f||c;if(t-=y,2&h){if(t<=-.5*y)return g;g+=e.length}}else 2&h&&(g+=y.length);else if("object"==typeof y){if(!y){s=n=r;continue}if(Array.isArray(y))continue;s=y.map,n=y.kmap}}return g}draw(t,s=null){const n=this.#b;let i=r,o=r,c=0,h=0,a=0,f=1,u=1,p=1,b=0,g=0,y=0,k=0,_=0,m=-1,d=t.shader=e,v=l,w=3,q=null,A=0;v[3][1]=1;let x=-1,N=1;const R=t.pixelRatio();let S=1,L=0;t:for(;c<n.length;){let e=n[c++];if("number"==typeof e){if(e<0){m=e;continue t}const s=n[c++];switch(e){case 1:if(_){g&&t.skew(-g,0);const e=.5/_,n=s*_*2;t.rotate(L),t.translate(sin(n)*e,(1-cos(n))*e),t.rotate(-n),L=0,g&&t.skew(g,0)}else t.translate(s,0);x=-1;continue t;case 3:const n=s*u;u=1/s,t.scale(n),y*=f*=u,k*=f,N*=n,_*=n,f=s,q&&(S=R*q.normDistRange*f);for(let t=0;t<w;t+=4)("object"==typeof s[t+3]?s[t+3]:s[t+1])[1]=S;continue t;case 4:y=s*u,k=y*g;continue t;case 2:t.shader=d=e;break;case 5:p=s;continue t;case 6:t.skew(s-g,0),g=s,k=y*s;continue t;case 7:b=.5*s;continue t;case 8:_=s*f;continue t;default:continue t}}else{if("string"==typeof e){if(1&m)for(const n of e){const e=n.codePointAt(),r=i.get(e);if(s&&2&m){for(;h>=s[a];){const e=s[a++]=t.sub();g&&e.skew(-g,0),L&&e.rotate(L)}h+=n.length}if(!r)continue;const c=(o.get(e+1114112*x)??0)*min(N,p);x=e,N=p;const l=(r.xadv+b+b)*p+c,f=c-k;_&&(g&&t.skew(-g,0),t.rotate(L+(L=-asin(l*_)||0)),g&&t.skew(g,0));for(let e=0;e<w;e+=4){const s=v[e+1],n=v[e+2]+y,i=v[e+3];if("object"==typeof s){const e=_*l*(n+A);s[0]=vec4.one,t.drawRectv(f+e,n+A,l-e-e,i,s)}else r.tex&&(i[0]=r.tex,t.drawRectv((r.x+b)*p+s+f,r.y+n,r.w*p,r.h,i))}t.translate(l,0)}else if(ret&&2&m){for(;h>=s[ret.length];){const e=s[a++]=t.sub();g&&e.skew(-g,0),L&&e.rotate(L)}h+=e.length}continue}if("function"==typeof e){const s=t.sub();g&&s.skew(-g,0),L&&s.rotate(L),e(s,A)}else{if(!e){i=o=r;continue}if(Array.isArray(e)){w=(v=e).length;for(let t=0;t<w;t+=4)("object"==typeof v[t+3]?v[t+3]:v[t+1])[1]=S;continue}q=e,A=q.ascend-1,i=e.map,o=e.kmap,S=R*q.normDistRange*f;for(let t=0;t<w;t+=4)("object"==typeof v[t+3]?v[t+3]:v[t+1])[1]=S}}if(q){const t=(1&q._flags?.5:-.5)/q.normDistRange;t!=d.oldfv&&d.uniforms(d.oldfv=t)}}g&&t.skew(-g,0),L&&t.rotate(L),1!=f&&t.scale(u)}break(t=1/0,e=n,i={scale:1,letterSpacing:0,curve:0}){const c=this.#b,l=this.toString(),u=[];let p="number"==typeof t?t:"function"==typeof t?t(u.length,i):t[min(u.length,t.length-1)],b=new f,g=b.l=new s(b),y=0,k=0,_="",m=r,d=r,v=1,w=1,q=-1,A=0,x=!1;for(;y<l.length;){let n,N=0,R=b.length,S=0,L=A,P=g.#y,O=g.#k,j=g.#q,B=g.#_,F=g.#m,T=g.#d,I=g.#g,E=g.#v,W=g.#w,M=b.#u,D=b.#h;t:{if(e)for(n of e){n.lastIndex=y;const t=n.exec(l);if(t){y+=N=t[0].length,e=n.next??e;break t}}y+=N=1,n=o}const H=n.type;16&H&&(u.push(g),b.#a=x?NaN:A,x=!1,g=g.sub(),g.#b=b=new f,p="number"==typeof t?t:"function"==typeof t?t(u.length,i):t[min(u.length,t.length-1)],R=L=A=D=0,-1!=M&&b.push(b.#u=M),g.#A(b));const V=32&H&&b.#u!=h;if(_){let t=_;N<_.length?(t=_.slice(0,N),_=_.slice(N),N=0):(N-=_.length,_=""),V&&b.push(h),t&&b.push(t),2&b.#u&&(b.#h+=t.length),V&&b.push(b.#u)}let C=!1;for(;N>0;){const t=c[k++];if("number"==typeof t){if(t<0){b.#u=t,b.push(t);continue}const e=c[k++];switch(C=!0,t){case 1:b.push(t,e);break;case 2:g.#y=e;break;case 3:g.#k=e,g.#_;break;case 4:g.#q=e;break;case 5:g.#_=e,g.#k;break;case 6:g.#m=e;break;case 7:g.#d=e;break;case 8:g.#v=e}}else if("string"==typeof t){if(!(2&b.#u)){b.push(t);continue}N-=t.length;let e=t;N<0?(e=t.slice(0,N),_=t.slice(N)):_="",C&&g.#A(b),V&&b.push(h),b.push(e),b.#h+=e.length,V&&b.push(b.#u)}else Array.isArray(t)?(g.#w=t,C=!0):(g.#g=t,C=!0)}for(C&&g.#A(b);;){let e=R,o=S,c=P,l=O,y=j,k=B,_=F,N=T,V=I,C=W,G=M,U=D,z=E,K=1/z,Q=!1,Y=!1,$=n.sepL==V&&n.sepA==z&&n.sepS==N?n.sepW:a(n,V,z,N);const J=H?0!=(36>>H&1):2*L<p,{scale:X=1,letterSpacing:Z=0,curve:tt=0}=i;x||=1!=X||0!=Z||0!=tt;let et=z+tt,st=N+Z;for(tt&&(K=1/et);e<b.length;){const t=b[e++];if("number"==typeof t){if(t<0){G=t;continue}const s=b[e++];switch(t){case 1:if(A+=s,q=-1,(Q=A>p-($-(d.get(n.sep.codePointAt()+1114112*q)??0))*v)||!J)break;R=e-2,S=0,Y=!0,L=A,P=c,O=l,j=y,B=k,F=_,T=N,I=V,E=z,W=C,M=G,D=U;break;case 2:c=s;break;case 3:l=s,v=s*k*X;break;case 4:y=s;break;case 5:k=s,v=s*l*X;break;case 6:_=s;break;case 7:N=s,st=s+Z;break;case 8:et=s+tt,K=1/et,z=s}}else if("string"==typeof t){if(1&G)for(const s of t){const t=s.codePointAt(),i=m.get(t);if(o+=s.length,!i)continue;const r=(d.get(t+1114112*q)??0)*min(v,w);w=v,q=t;const h=(i.xadv+st)*v+r;A+=et&&asin(h*et)*K||h,!(Q=A>p-($-(d.get(n.sep.codePointAt()+1114112*t)??0))*v)&&J&&(Y=!0,R=e-1,S=o,L=A,P=c,O=l,j=y,B=k,F=_,T=N,I=V,E=z,W=C,M=G,D=U)}}else Array.isArray(t)?C=t:(V=t)?(m=t.map,d=t.kmap,$=n.sepL==t&&n.sepA==z&&n.sepS==N?n.sepW:a(n,t,z,N)):(m=d=r,$=0)}if(!L||A<=p||!R||3==H)break;if(e=R,o=S,c=P,l=O,y=j,k=B,_=F,N=T,V=I,C=W,G=M,z=E,U=D,6==H||7==H&&p-L>=A-p){const t=(p-L)/(A-L),s=b.length;for(b.splice(e,0,5,t*k),e+=2;e<s;){const s=b[e++];"number"!=typeof s||s<0||(5==s?b[e++]*=t:e++)}b.push(5,k);break}A=L;const nt=new f,it=new s(nt),ot=b.length;it.#y=c,it.#k=l,it.#q=y,it.#_=k,it.#m=_,it.#d=N,it.#g=V,it.#w=C,it.#v=z,nt.#u=G;let rt=e+=!!o;const ct=4!=H&&5!=H;t:for(;rt<ot;){const t=b[rt++];if("number"==typeof t){if(t<0){nt.#u=t;continue}const e=b[rt++];switch(t){case 1:if(ct){rt--;break t}break;case 2:it.#y=e;break;case 3:it.#k=e;break;case 4:it.#q=e;break;case 5:it.#_=e;break;case 6:it.#m=e;break;case 7:it.#d=e;break;case 8:it.#v=e}}else{if("string"==typeof t){rt--;break}Array.isArray(t)?it.#w=t:it.#g=t}}if(it.#A(nt),ct)for(-1!=nt.#u&&nt.push(nt.#u);rt<ot;)nt.push(b[rt++]);else for(nt.push(h);rt<ot;){const t=b[rt++];"number"!=typeof t?nt.push(t):t>0&&nt.push(t,b[rt++])}if(nt.#h=b.#h-U,b.#h=U,b.#a=x?NaN:A,x=!1,it.#y=nt.#e=g.#y,it.#k=nt.#s=g.#k,it.#q=nt.#n=g.#q,it.#_=nt.#i=g.#_,it.#m=nt.#o=g.#m,it.#d=nt.#r=g.#d,it.#v=nt.#c=g.#v,nt.#u=b.#u,b.length=e,o){const t=b[e-1];b[e-1]=t.slice(0,o),nt.push(t.slice(o))}ct||nt.#u==h||nt.push(nt.#u),Y&&(-3!=b.#u&&b.push(b.#u=-3),b.push(n.sep)),u.push(g),g=it,b=nt,p="number"==typeof t?t:"function"==typeof t?t(u.length,i):t[min(u.length,t.length-1)],R=S=L=A=D=0}if(8&H){u.push(g),b.#a=x?NaN:A,x=!1;const e=b.#u;A=0,g=g.sub(),g.#b=b=new f,p="number"==typeof t?t:"function"==typeof t?t(u.length,i):t[min(u.length,t.length-1)],-1!=e&&b.push(b.#u=e),g.#A(b)}}return b.#a=x?NaN:A,u.push(g),u}toString(){let t="",e=!0,s=0;const n=this.#b,i=n.length;for(;s<i;){const i=n[s++];"number"==typeof i&&(i<0?e=!!(2&i):s++),"string"==typeof i&&e&&(t+=i)}return t}static#p=t.RichText=(t=null)=>{const e=new f;if(!t)return e.#f=new s(e);const n=new s(e);return n.#g=t,n}}}class u{_flags=0;normDistRange=0;#x=[];map=new Map;ascend=0;kmap=new Map;get then(){return this.#x?this.#N:void 0}#N(t,e){this.#x?.push(t,e)}get isMsdf(){return!!(1&this._flags)}set isMsdf(t){this._flags=-2&this._flags|t}done(){const t=this.#x;if(this.#x=null,t)for(let e=0;e<t.length;e+=2)t[e]?.(this)}error(t){const e=this.#x;if(this.#x=null,e)for(let s=1;s<e.length;s+=2)e[s]?.(t)}chlumsky(t,e){return fetch(t).then((e=>(t=e.url,e.json()))).then((t=>{const{atlas:{type:s,distanceRange:n,size:i,width:o,height:r},metrics:{ascender:c,descender:l},glyphs:h,kerning:a}=t,f=(this.isMsdf=s.toLowerCase().endsWith("msdf"))?Formats.RGB:Formats.R,u=Img(e,SMOOTH,f);this.normDistRange=n/i*2,this.ascend=c/(c-l);for(const{unicode1:t,unicode2:e,advance:s}of a)this.kmap.set(e+1114112*t,s);for(const{unicode:t,advance:e,planeBounds:s,atlasBounds:n}of h)this.map.set(t,s?{x:s.left,y:s.bottom,w:s.right-s.left,h:s.top-s.bottom,xadv:e,tex:u.sub(n.left/o,n.bottom/r,(n.right-n.left)/o,(n.top-n.bottom)/r)}:{x:0,y:0,w:0,h:0,xadv:e,tex:null});this.done()}),this.error.bind(this)),this}bmfont(t,e=0){return fetch(t).then((e=>(t=e.url,e.json()))).then((s=>{const{chars:n,distanceField:i,pages:o,info:{size:r},common:{base:c,lineHeight:l,scaleW:h,scaleH:a},kernings:f}=s,u=(this.isMsdf=i.fieldType.toLowerCase().endsWith("msdf"))?Formats.RGB:Formats.R;this.normDistRange=i.distanceRange/l*2;const p=this.ascend=c/l,b=o.map((e=>Img(new URL(e,t).href,SMOOTH,u)));for(const{first:t,second:e,amount:s}of f)this.kmap.set(e+1114112*t,s/r);for(const{id:t,x:s,y:i,width:o,height:c,xoffset:l,yoffset:f,xadvance:u,page:g}of n)this.map.set(t,{x:l/r,y:p-(f-e+c)/r,w:o/r,h:c/r,xadv:u/r,tex:o&&c?b[g].sub(s/h,1-(i+c)/a,o/h,c/a):null});this.done()}),this.error.bind(this)),this}draw(t,s,n=-1,i=0,...o){if(this.#x)return;i*=.5;let r=t.pixelRatio()*this.normDistRange,c=t.shader;void 0===c.oldfv&&(c=t.shader=e);const l=(1&this._flags?.5:-.5)/this.normDistRange;l!=c.oldfv&&c.uniforms(c.oldfv=l);const{map:h,kmap:a}=this;for(const e of s){const s=e.codePointAt(),c=h.get(s);if(!c)continue;const l=a.get(s+1114112*n)??0;n=s;const f=c.xadv+i+i+l;c.tex&&t.drawRect(c.x+i+l,c.y,c.w,c.h,c.tex,r,...o),t.translate(f,0)}return n}measure(t,e=-1,s=0){if(this.#x)return;let n=0;const{map:i,kmap:o}=this;for(const r of t){const t=r.codePointAt(),c=i.get(t);if(!c)continue;const l=o.get(t+1114112*e)??0;e=t,n+=c.xadv+s+l}return n}}t.Font=()=>new u,t.Font.bmfont=(t,e)=>(new u).bmfont(t,e),t.Font.chlumsky=(t,e)=>(new u).chlumsky(t,e)};